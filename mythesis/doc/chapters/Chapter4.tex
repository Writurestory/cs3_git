\chapter{研究方案}

%%pyhook引用，rasprint引用，SD卡引用附录兼容表，termios引用man手册

\section{问题研究}

\begin{itemize}
\item 该研究主要是：研究酒店行业WIFI解决方案，咖啡店行业WIFI解决方案，餐饮行业WIFI解决方案等。
\item 重点解决的问题是：
  \begin{description}
  \item[Raspberry Pi自动监听] 使用unix posix标准的termios\cite{termio}监听刷卡输入信号。
  \item[基于Raspberry Pi的网络用户身份认证功能] 使用Raspberry Pi集成的刷卡功能获取卡号来判
    断用户身份，判断用户合法性等。
  \item[基于Raspberry Pi的刷卡打印功能] 使用Raspberry Pi控制刷卡打印模块的工作。
  \item[程序模块的设计] 读卡模块、打印模块、ROS控制模块、监听模块、检验模块、主模块的设计与编码。
  \item[系统集成] 集成Raspberry Pi+刷卡器+打印机+ROS，程序模块调用各个设备工作。
  \end{description}
\item 预期的结果是：提供一套完善的WIFI解决方案，不需要人工干预，完全集成于开发板，部署配置方便，自动化处理
，更加安全稳定。，在认证界面投放广告，给商家带来宣传的媒介和商业利益。
\end{itemize}


\section{思路做法}

前期进行市场调查，查看国内的WIFI解决方案现状，将来的趋势和市场的需要。决定产品的设计方案和
研发进度。搜集技术信息，设计网络拓扑图，配置ROS\cite{ros}实现hotspot认证，采用Python实现刷
卡打印认证功能，使用wxpython\cite{wxpython}实现用户接口，管理员能够通过该界面管理ROS，测试
成功无误后在7天酒店试运行，几个月来运行稳定。后来又在芭堤酒店部署了另外一套，运行了一段时间
后，由于管理员反馈GUI界面需要人工干预，操作麻烦，窗口需要在最前端运行才可以刷卡，给酒店的其
他工作带来不便，于是设想出了第二套方案，使用pyhook（见附录\ref{sec:pyhook}）函数调用windows自
动监听键盘接收刷卡字符串，这样的话GUI界面就不用每次在窗口最前运行了，也不会影响到酒店电脑的
其他工作了，回来之后花了几个星期开始编码实现该功能。完成后在芭堤连锁酒店环城北路店投入使用，
当时正好在做令一个关于Raspberry Pi的公交系统的项目，于是突发奇想，不如把程序移植
到Raspberry Pi上实现相同的刷卡认证功能，并且让该系统实现自动化认证，去掉原来的GUI管理界面，
使该系统完全集成在Raspberry Pi的开发板上，与酒店的管理系统分隔开来，这样的话就会更稳定也更
方便。第三个版本设想完成后就开始了移植的工作，由于是基于Raspberry Pi的移植，因此就得重新设
计刷卡器的读取方式，重新设计采用uinux posix 标准的termio\cite{termio}信号来实现自动读取功能，
然后再用rasprint模块实现pos打印机的打印驱动功能，然后重新进行python编码，删除
了wxpython的GUI界面，界面的功能函数设置成监听触发，设置了一个持续监听的功能，并且上了锁(防
止用户操作)，将刷卡器，打印机和Raspberry Pi集成起来，几个月后第三个版本就完成了，之后投入到
芭堤连锁酒店南亚风情点使用，部署时间大概半小时就可以完成，接下来的几个星期，由于路由器硬件
的故障以及SD卡的不兼容，出现了几次问题，但是在后期的维护中都找出了这些问题，并且修复了这些
问题，现在这套系统已经很稳定了，酒店管理员也很满意并且替换了芭堤酒店环城北路店的系统，使用
到现在为止没出现过问题。特别要感谢我的指导老师孙永科一直指导我，我从售前到研发再到售后整个
产品研发流程当中学会了不少东西，从而做出了这套产品，然后做成熟。

\section{创新点}

\begin{itemize}
\item 首次基于Raspberry pi集成，之前几个版本都是基于windows下的软件实现认证，现在转到了基
  于Raspberry Pi的linux系统下来进行用户认证，把刷卡打印功能都移植到了linux环境下，并且长期
  使用下来很稳定。出问题或者坏掉只需跟换SD卡即可，更安全稳定。
\item 对比国内的认证方法，还没有使用刷卡打印来进行hotspot认证，该方法更是很酒店、咖啡厅、
  商场等商业场所，使用下来用户体验不错。
\item 自动化操作，不需要人工操作和干预，给酒店网络管理人员减轻了很大工作量，过去酒店的工作
  人员都需要手工添加用户来给用户使用，要么就是给一个固定密码，这样的话很容易被蹭网。反而不
  安全了。自动化操作的功能使得工作人员可以不用关心给用户认证，只需要刷卡就可以自动认证。
\item 配置方便快捷，每次部署只需要连接好设备，配置好ROS网关和路由器密码，把Raspberry Pi$+$刷卡器
  $+$打印机接入内网即可工作。
\item 不依赖操作系统，PYTHON程序$+$打印机$+$刷卡器集成到了Raspberry Pi上，整套设备一起工作，不依赖于
  酒店的设备和其他系统。
\item 独立操作，不影响酒店其他设备，同时也不会受其他设备影响。即使Raspberry Pi断电了，酒店
  网络不受影响，只是暂时不能刷卡，恢复供电后又可以刷卡了。经过多次断电插电试验，系统很稳
  定。
\item 操作简单易于理解
  \begin{itemize}
  \item 用户入住酒店刷卡，打印机打印上网纸条，用户凭纸条上网。
  \item 用户退房刷卡，自动注销，打印机不打印纸条。
  \item 根据刷卡是否处置即可判断是入住还是退房。
  \item 开关式的上线下线。
  \end{itemize}
\end{itemize}


%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../thesis"
%%% End: 
