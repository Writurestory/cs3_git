<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Chapter 7</title>
<link rel="stylesheet" type="text/css" href="docsafari.css">
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body><table width="100%" border="1" bgcolor="#EBEBFF"><tr><td width="5%" align="left" valign="middle"><a href="_chapter 6.htm"><img src="Larrow.gif" width="17" height="19" border="0"></a></td><td align="center" valign="middle"><a class="docLink" href="Front matter.htm">CONTENTS</a></td><td width="5%" align="right" valign="middle"><a href="_chapter 8.htm"><img src="Rarrow.gif" width="17" height="19" border="0"></a></td></tr></table>


<h2 class="docChapterTitle">Chapter 7. The <span class="docEmphasis">awk</span> 
Utility: <span class="docEmphasis">awk</span> Programming</h2><ul><li>&nbsp;<a class="docLink" href="#ch07lev1sec1">7.1 Variables</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec2">7.2 Redirection and Pipes</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec3">7.3 Pipes</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec4">7.4 Closing Files and Pipes</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec5">7.5 Review</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec6">UNIX TOOLS LAB EXERCISE</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec7">7.6 Conditional Statements</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec8">7.7 Loops</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec9">7.8 Program Control Statements</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec10">7.9 Arrays</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec11">7.10 <span class="docEmphasis">awk</span> Built-In Functions</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec12">7.11 Built-In Arithmetic Functions</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec13">7.12 User-Defined Functions<span class="docEmphasis">(nawk)</span></a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec14">7.13 Review</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec15">UNIX TOOLS LAB EXERCISE</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec16">7.14 Odds and Ends</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec17">7.15 Review</a></li>
<li>&nbsp;<a class="docLink" href="#ch07lev1sec18">UNIX TOOLS LAB EXERCISE</a></li>
</ul>
<p class="docText">
<img alt="graphics/ch07.gif" src="ch07.gif" border="0" width="500" height="553"></p>
<h3 class="docSection1Title" id="ch07lev1sec1">7.1 Variables</h3>
<h4 class="docSection2Title" id="ch07lev2sec1">7.1.1 Numeric and String Constants</h4>
<p class="docText">Numeric constants can be represented as integers, such as 
243, floating point numbers, such as 3.14, or numbers using scientific notation, 
such as .723E-1 or 3.4e7. Strings, such as <span class="docEmphasis">Hello 
world,</span> are enclosed in double quotes.</p>
<p class="docText"><b>Initialization and Type Coercion.</b> Just mentioning a 
variable in your <span class="docEmphasis">awk</span> program causes it to 
exist. A variable can be a string, a number, or both. When it is set, it becomes 
the type of the expression on the right-hand side of the equal sign.</p>
<p class="docText">Uninitialized variables have the value zero or the value &quot; &quot;, 
depending on the context in which they are used.</p>
<pre>name = &quot;Nancy&quot; <span class="docEmphasis">name is a string</span>

x++            <span class="docEmphBoldItalic">x</span> <span class="docEmphasis">is a number;</span>
               <span class="docEmphBoldItalic">x</span> <span class="docEmphasis">is initialized to zero and incremented by 1</span>

number = 35    <span class="docEmphasis">number is a number</span>
</pre>
<p class="docText">To coerce a string to be a number:</p>
<pre>name + 0
</pre>
<p class="docText">To coerce a number to be a string:</p>
<pre>number &quot; &quot;
</pre>
<p class="docText">All fields and array elements created by the
<span class="docEmphasis">split</span> function are considered strings, unless 
they contain only a numeric value. If a field or array element is null, it has 
the string value of null. An empty line is also considered to be a null string.</p>
<h4 class="docSection2Title" id="ch07lev2sec2">7.1.2 User-Defined Variables</h4>
<p class="docText">User-defined variables consist of letters, digits, and 
underscores, and cannot begin with a digit. Variables in
<span class="docEmphasis">awk</span> are not declared. <span class="docEmphasis">
Awk</span> infers data type by the context of the variable in the expression. If 
the variable is not initialized, <span class="docEmphasis">awk</span> 
initializes string variables to null and numeric variables to zero. If 
necessary, <span class="docEmphasis">awk</span> will convert a string variable 
to a numeric variable, and vice versa. Variables are assigned values with
<span class="docEmphasis">awk</span>'s assignment operators. See
<a class="docLink" href="#ch07table01">Table 7.1</a>.</p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch07table01" class="docTableTitle">Table 7.1. Assignment Operators</h5>
  </caption>
  <colgroup span="3" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="center"><span class="docEmphBoldItalic">
    Operator</span> </th>
    <th class="docTableHeader" vAlign="center"><span class="docEmphBoldItalic">
    Meaning</span> </th>
    <th class="docTableHeader" vAlign="center"><span class="docEmphBoldItalic">
    Equivalence</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = 5</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">+=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = a + 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a += 5</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">-=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = a - 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a -= 5</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">*=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = a * 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a *= 5</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = a / 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a /= 5</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">%=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = a % 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a %= 5</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">^=</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a = a ^ 5</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a ^= 5</span>
    </td>
  </tr>
</table>
<p class="docText">The simplest assignment takes the result of an expression and 
assigns it to a variable.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>variable = expression
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list01" class="docExampleTitle">Example 7.1 </h5>
<pre>% <span class="docEmphStrong">nawk '$1 ~  /Tom/ {wage = $2 * $3; print wage}'  filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText"><span class="docEmphasis">Awk</span> will scan the first 
    field for <span class="docEmphasis">Tom</span> and when there is a match, it 
    will multiply the value of the second field by the value of the third field 
    and assign the result to the user-defined variable <span class="docEmphasis">
    wage.</span> Since the multiplication operation is arithmetic,
    <span class="docEmphasis">awk</span> assigns <span class="docEmphasis">wage</span> 
    an initial value of zero. (The <span class="docEmphasis">%</span> is the 
    UNIX prompt and <span class="docEmphasis">filename</span> is an input file.)</td>
  </tr>
</table>
<p class="docText"><b>Increment and Decrement Operators.</b> To add one to an 
operand, the <span class="docEmphasis">increment operator</span> is used. The 
expression <span class="docEmphasis">x++</span> is equivalent to
<span class="docEmphasis">x = x + 1.</span> Similarly, the
<span class="docEmphasis">decrement operator</span> subtracts one from its 
operand. The expression <span class="docEmphasis">x- -</span> is equivalent to
<span class="docEmphasis">x = x - 1.</span> This notation is useful in looping 
operations when you simply want to increment or decrement a counter. You can use 
the increment and decrement operators either preceding the operator, as in
<span class="docEmphasis">++</span>x, or after the operator, as in
<span class="docEmphasis">x++.</span> If these expressions are used in 
assignment statements, their placement will make a difference in the result of 
the operation.</p>
<pre>{x = 1;  y = x++ ; print x, y}
</pre>
<p class="docText">The <span class="docEmphasis">++</span> here is called a
<span class="docEmphasis">post-increment operator;</span>
<span class="docEmphasis">y</span> is assigned the value of one, and then
<span class="docEmphasis">x</span> is increased by one, so that when all is said 
and done, <span class="docEmphStrong">y</span> <span class="docEmphBoldItalic">
will equal one, and</span> <span class="docEmphStrong">x</span>
<span class="docEmphBoldItalic">will equal two.</span></p>
<pre>{x = 1; y = ++x;  print x, y}
</pre>
<p class="docText">The <span class="docEmphasis">++</span> here is called a
<span class="docEmphasis">pre-increment operator;</span>
<span class="docEmphasis">x</span> is incremented first, and the value of two is 
assigned to <span class="docEmphasis">y,</span> so that when this statement is 
finished, <span class="docEmphStrong">y</span> <span class="docEmphBoldItalic">
will equal two, and</span> <span class="docEmphStrong">x</span>
<span class="docEmphBoldItalic">will equal two.</span></p>
<p class="docText"><b>User-Defined Variables at the Command Line.</b> A variable 
can be assigned a value at the command line and passed into an
<span class="docEmphasis">awk</span> script. For more on processing arguments, 
see &quot;<a class="docLink" href="#ch07lev2sec25">Processing 
Command Arguments (nawk)</a>&quot;, <span class="docEmphasis">ARGV,</span> the array 
of command line arguments.</p>
<h5 id="ch07list02" class="docExampleTitle">Example 7.2 </h5>
<pre><span class="docEmphStrong">nawk –F: –f awkscript    month=4  year=2001 filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The user-defined variables <span class="docEmphasis">
    month</span> and <span class="docEmphasis">year</span> are assigned the 
    values <span class="docEmphasis">4</span> and <span class="docEmphasis">
    2001,</span> respectively. In the <span class="docEmphasis">awk</span> 
    script, these variables may be used as though they were created in the 
    script. Note: If <span class="docEmphasis">filename</span> precedes the 
    arguments, the variables will not be available in the
    <span class="docEmphasis">BEGIN</span> statements. (See &quot;<a class="docLink" href="#ch07lev2sec3">BEGIN 
    Patterns</a>&quot;.)</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">–v</span> 
Option <span class="docEmphasis">(nawk)</span>.</span> The
<span class="docEmphasis">–v</span> option provided by <span class="docEmphasis">
nawk</span> allows command line arguments to be processed within a
<span class="docEmphasis">BEGIN</span> statement. For each argument passed at 
the command line, there must be a <span class="docEmphasis">–v</span> option 
preceding it.</p>
<p class="docText"><b>Field Variables.</b> Field variables can be used like 
user-defined variables, except they reference fields. New fields can be created 
by assignment. A field value that is referenced and has no value will be 
assigned the null string. If a field value is changed, the
<span class="docEmphasis">$0</span> variable is recomputed using the current 
value of <span class="docEmphasis">OFS</span> as a field separator. The number 
of fields allowed is usually limited to 100.</p>
<h5 id="ch07list03" class="docExampleTitle">Example 7.3 </h5>
<pre>% <span class="docEmphStrong">nawk ' { $5 = 1000 * $3 / $2;  print } '  filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If <span class="docEmphasis">$5</span> does not exist,
    <span class="docEmphasis">awk</span> will create it and assign the result of 
    the expression <span class="docEmphasis">1000 * $3 / $2</span> to the fifth 
    field (<span class="docEmphasis">$5</span>). If the fifth field exists, the 
    result will be assigned to it, overwriting what is there.</td>
  </tr>
</table>
<h5 id="ch07list04" class="docExampleTitle">Example 7.4 </h5>
<pre>% <span class="docEmphStrong">nawk ' $4 == &quot;CA&quot; { $4  = &quot;California&quot;; print}'  filename</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the fourth field (<span class="docEmphasis">$4</span>) 
    is equal to the string <span class="docEmphasis">CA,</span>
    <span class="docEmphasis">awk</span> will reassign the fourth field to
    <span class="docEmphasis">California.</span> The double quotes are 
    essential. Without them, the strings become user-defined variables with an 
    initial value of null.</td>
  </tr>
</table>
<p class="docText"><b>Built-In Variables.</b> Built-in variables have uppercase 
names. They can be used in expressions and can be reset. See
<a class="docLink" href="#ch07table02">Table 7.2</a> for a list of built-in 
variables.</p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch07table02" class="docTableTitle">Table 7.2. Built-In Variables</h5>
  </caption>
  <colgroup span="2" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Variable Name</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Variable Contents</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">ARGC</span>
    </td>
    <td class="docTableCell" vAlign="top">Number of command line argument. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">ARGV</span>
    </td>
    <td class="docTableCell" vAlign="top">Array of command line arguments. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">FILENAME</span>
    </td>
    <td class="docTableCell" vAlign="top">Name of current input file. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">FNR</span>
    </td>
    <td class="docTableCell" vAlign="top">Record number in current file. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">FS</span>
    </td>
    <td class="docTableCell" vAlign="top">The input field separator, by default 
    a space. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">NF</span>
    </td>
    <td class="docTableCell" vAlign="top">Number of fields in current record.
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">NR</span>
    </td>
    <td class="docTableCell" vAlign="top">Number of records so far. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">OFMT</span>
    </td>
    <td class="docTableCell" vAlign="top">Output format for numbers. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">OFS</span>
    </td>
    <td class="docTableCell" vAlign="top">Output field separator. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">ORS</span>
    </td>
    <td class="docTableCell" vAlign="top">Output record separator. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">RLENGTH</span>
    </td>
    <td class="docTableCell" vAlign="top">Length of string matched by
    <span class="docEmphasis">match</span> function. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">RS</span>
    </td>
    <td class="docTableCell" vAlign="top">Input record separator. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">RSTART</span>
    </td>
    <td class="docTableCell" vAlign="top">Offset of string matched by
    <span class="docEmphasis">match</span> function. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">SUBSEP</span>
    </td>
    <td class="docTableCell" vAlign="top">Subscript separator. </td>
  </tr>
</table>
<h5 id="ch07list05" class="docExampleTitle">Example 7.5 </h5>
<pre>(The Employees Database)
% <span class="docEmphStrong">cat employees2</span>
Tom Jones:4423:5/12/66:543354
Mary Adams:5346:11/4/63:28765
Sally Chang:1654:7/22/54:650000
Mary Black:1683:9/23/44:336500

(The Command Line)
% <span class="docEmphStrong">nawk  –F:  '$1 == &quot;Mary Adams&quot;{print NR, $1, $2, $NF}' employees2</span>

(The Output)
<span class="docEmphasis">2  Mary Adams 5346  28765</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">–F</span> option sets the 
    field separator to a colon. The <span class="docEmphasis">print</span> 
    function prints the record number, the first field, the second field, and 
    the last field (<span class="docEmphasis">$NF</span>).</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec3">7.1.3 <span class="docEmphasis">BEGIN</span> 
Patterns</h4>
<p class="docText">The <span class="docEmphasis">BEGIN</span> pattern is 
followed by an action block that is executed <span class="docEmphasis">before</span>
<span class="docEmphasis">awk</span> processes any lines from the input file. In 
fact, a <span class="docEmphasis">BEGIN</span> block can be tested without any 
input file, since <span class="docEmphasis">awk</span> does not start reading 
input until the <span class="docEmphasis">BEGIN</span> action block has 
completed. The <span class="docEmphasis">BEGIN</span> action is often used to 
change the value of the built-in variables, <span class="docEmphasis">OFS, RS, 
FS,</span> and so forth, to assign initial values to user-defined variables and 
to print headers or titles as part of the output.</p>
<h5 id="ch07list06" class="docExampleTitle">Example 7.6 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{FS=&quot;:&quot;; OFS=&quot;\t&quot;; ORS=&quot;\n\n&quot;}{print $1,$2,$3}' file</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Before the input file is processed, the field separator (<span class="docEmphasis">FS</span>) 
    is set to a colon, the output field separator (<span class="docEmphasis">OFS</span>) 
    to a tab, and the output record separator (<span class="docEmphasis">ORS</span>) 
    to two newlines. If there are two or more statements in the action block, 
    they should be separated with semicolons or placed on separate lines (use a 
    backslash to escape the newline character if at the shell prompt).</td>
  </tr>
</table>
<h5 id="ch07list07" class="docExampleTitle">Example 7.7 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{print &quot;MAKE YEAR&quot;}'</span>
<span class="docEmphasis">make year</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText"><span class="docEmphasis">Awk</span> will display
    <span class="docEmphasis">MAKE YEAR.</span> The <span class="docEmphasis">
    print</span> function is executed before <span class="docEmphasis">awk</span> 
    opens the input file, and even though the input file has not been assigned,
    <span class="docEmphasis">awk</span> will still print
    <span class="docEmphasis">MAKE</span> and <span class="docEmphasis">YEAR.</span> 
    When debugging <span class="docEmphasis">awk</span> scripts, you can test 
    the <span class="docEmphasis">BEGIN</span> block actions before writing the 
    rest of the program.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec4">7.1.4 <span class="docEmphasis">END</span> Patterns</h4>
<p class="docText"><span class="docEmphasis">END</span> patterns do not match 
any input lines, but execute any actions that are associated with the
<span class="docEmphasis">END</span> pattern. <span class="docEmphasis">END</span> 
patterns are handled <span class="docEmphasis">after</span> all lines of input 
have been processed.</p>
<h5 id="ch07list08" class="docExampleTitle">Example 7.8 </h5>
<pre>% <span class="docEmphStrong">nawk 'END{print &quot;The number of records is &quot; NR }' filename</span>
<span class="docEmphasis">The number of records is 4</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">END</span> block is 
    executed after <span class="docEmphasis">awk</span> has finished processing 
    the file. The value of <span class="docEmphasis">NR</span> is the number of 
    the last record read.</td>
  </tr>
</table>
<h5 id="ch07list09" class="docExampleTitle">Example 7.9 </h5>
<pre>% <span class="docEmphStrong">nawk '/Mary/{count++}END{print &quot;Mary was found &quot; count &quot; times.&quot;}'\</span>
  <span class="docEmphStrong">employees</span>
<span class="docEmphasis">Mary was found 2 times.</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">For every line that contains the pattern
    <span class="docEmphasis">sun,</span> the value of the
    <span class="docEmphasis">count</span> variable is incremented by one. After
    <span class="docEmphasis">awk</span> has processed the entire file, the
    <span class="docEmphasis">END</span> block prints the string
    <span class="docEmphasis">Sun was found,</span> the value of
    <span class="docEmphasis">count,</span> and the string
    <span class="docEmphasis">times.</span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec2">7.2 Redirection and Pipes</h3>
<h4 class="docSection2Title" id="ch07lev2sec5">7.2.1 Output Redirection</h4>
<p class="docText">When redirecting output from within <span class="docEmphasis">
awk</span> to a UNIX file, the shell redirection operators are used. The 
filename must be enclosed in double quotes. When the &gt; symbol is used, the file 
is opened and truncated. Once the file is opened, it remains open until 
explicitly closed or the <span class="docEmphasis">awk</span> program 
terminates. Output from subsequent <span class="docEmphasis">print</span> 
statements to that file will be appended to the file.</p>
<p class="docText">The <span class="docEmphasis">&gt;&gt;</span> symbol is used to 
open the file, but does not clear it out; instead it simply appends to it.</p>
<h5 id="ch07list10" class="docExampleTitle">Example 7.10 </h5>
<pre>% <span class="docEmphStrong">nawk '$4 &gt;= 70 {print $1, $2  &gt; &quot;passing_file&quot; }' filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the value of the fourth field is greater than or equal 
    to <span class="docEmphasis">70,</span> the first and second fields will be 
    printed to the file <span class="docEmphasis">passing_ file.</span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec6">7.2.2 Input Redirection <span class="docEmphasis">(getline)</span></h4>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
getline</span> Function.</span> The <span class="docEmphasis">getline</span> 
function is used to read input from the standard input, a pipe, or a file other 
than the current file being processed. It gets the next line of input and sets 
the <span class="docEmphasis">NF, NR,</span> and the <span class="docEmphasis">
FNR</span> built-in variables. The <span class="docEmphasis">getline</span> 
function returns one if a record is found and zero if EOF (end of file) is 
reached. If there is an error, such as failure to open a file, the
<span class="docEmphasis">getline</span> function returns a value of
<span class="docEmphasis">-1.</span></p>
<h5 id="ch07list11" class="docExampleTitle">Example 7.11 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{ &quot;date&quot; | getline d; print d}' filename</span>
<span class="docEmphasis">Thu Jan 14 11:24:24 PST 2001</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Will execute the UNIX <span class="docEmphasis">date</span> 
    command, pipe the output to <span class="docEmphasis">getline,</span> assign 
    it to the user-defined variable <span class="docEmphasis">d,</span> and then 
    print <span class="docEmphasis">d.</span></td>
  </tr>
</table>
<h5 id="ch07list12" class="docExampleTitle">Example 7.12 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{ &quot;date &quot; | getline d; split( d, mon) ; print mon[2]}'\</span>
  <span class="docEmphStrong">filename</span>
<span class="docEmphasis">Jan</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Will execute the <span class="docEmphasis">date</span> 
    command and pipe the output to <span class="docEmphasis">getline.</span> The
    <span class="docEmphasis">getline</span> function will read from the pipe 
    and store the input in a user-defined variable, <span class="docEmphasis">d.</span> 
    The <span class="docEmphasis">split</span> function will create an array 
    called <span class="docEmphasis">mon</span> out of variable
    <span class="docEmphasis">d</span> and then the second element of the array
    <span class="docEmphasis">mon</span> will be printed.</td>
  </tr>
</table>
<h5 id="ch07list13" class="docExampleTitle">Example 7.13 </h5>
<pre><span class="docEmphasis">%</span> <span class="docEmphStrong">nawk 'BEGIN{while(&quot;ls&quot; | getline) print}'</span>
<span class="docEmphasis">a.out</span>
<span class="docEmphasis">db</span>
<span class="docEmphasis">dbook</span>
<span class="docEmphasis">getdir</span>
<span class="docEmphasis">file</span>
<span class="docEmphasis">sortedf</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Will send the output of the <span class="docEmphasis">ls</span> 
    command to <span class="docEmphasis">getline;</span> for each iteration of 
    the loop, <span class="docEmphasis">getline</span> will read one more line 
    of the output from <span class="docEmphasis">ls</span> and then print it to 
    the screen. An input file is not necessary, since the
    <span class="docEmphasis">BEGIN</span> block is processed before
    <span class="docEmphasis">awk</span> attempts to open input.</td>
  </tr>
</table>
<h5 id="ch07list14" class="docExampleTitle">Example 7.14 </h5>
<pre>(The Command Line)
1  % <span class="docEmphStrong">nawk 'BEGIN{ printf &quot;What is your name?&quot; ;\</span>
     <span class="docEmphStrong">getline name &lt; &quot;/dev/tty&quot;}\</span>
2  <span class="docEmphStrong">$1 ~ name {print &quot;Found &quot; name &quot; on line &quot;, NR &quot;.&quot;}\</span>
3  <span class="docEmphStrong">END{print &quot;See ya, &quot; name &quot;.&quot;}' filename</span>

(The Output)
<span class="docEmphasis">What is your name?</span>  <span class="docEmphBoldItalic">Ellie</span>     <span class="docEmphasis">&lt; Waits for input from user &gt;</span>
<span class="docEmphasis">Found Ellie on line 5.</span>
<span class="docEmphasis">See ya, Ellie.</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Will print to the screen <span class="docEmphasis">What 
      is your name?</span> and wait for user response; the
      <span class="docEmphasis">getline</span> function will accept input from 
      the terminal (<span class="docEmphasis">/dev/tty</span>) until a newline 
      is entered, and then store the input in the user-defined variable
      <span class="docEmphasis">name.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the first field matches the value assigned to
      <span class="docEmphasis">name,</span> the <span class="docEmphasis">print</span> 
      function is executed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">END</span> statement 
      prints out <span class="docEmphasis">See ya,</span> and then the value
      <span class="docEmphasis">Ellie,</span> stored in variable
      <span class="docEmphasis">name,</span> is displayed, followed by a period<span class="docEmphasis">.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h5 id="ch07list15" class="docExampleTitle">Example 7.15 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">nawk 'BEGIN{while (getline &lt; &quot;/etc/passwd&quot;  &gt; 0 )lc++; print lc}'\</span>
  <span class="docEmphStrong">file</span>

(The Output)
<span class="docEmphasis">16</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText"><span class="docEmphasis">Awk</span> will read each line 
    from the <span class="docEmphasis">/etc/passwd</span> file, increment
    <span class="docEmphasis">lc</span> until EOF is reached, then print the 
    value of <span class="docEmphasis">lc,</span> which is the number of lines 
    in the <span class="docEmphasis">passwd</span> file.</p>
    <div class="docNote">
      <p class="docNoteTitle">Note</p>
      <p class="docText">The value returned by <span class="docEmphasis">getline</span> 
      is negative one if the file does not exist. If the end of file is reached, 
      the return value is zero, and if a line was read, the return value is one. 
      Therefore, the command</p>
      <pre>while ( getline &lt; &quot;/etc/junk&quot;)
</pre>
      <p class="docText">would start an infinite loop if the file
      <span class="docEmphasis">/etc/junk</span> did not exist, since the return 
      value of negative one yields a true condition.</div>
    </td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec3">7.3 Pipes</h3>
<p class="docText">If you open a pipe in an <span class="docEmphasis">awk</span> 
program, you must close it before opening another one. The command on the 
right-hand side of the pipe symbol is enclosed in double quotes. Only one pipe 
can be open at a time.</p>
<h5 id="ch07list16" class="docExampleTitle">Example 7.16 </h5>
<pre>(The Database)
% <span class="docEmphStrong">cat names</span>
<span class="docEmphasis">john smith</span>
<span class="docEmphasis">alice cheba</span>
<span class="docEmphasis">george goldberg</span>
<span class="docEmphasis">susan goldberg</span>
<span class="docEmphasis">tony tram</span>
<span class="docEmphasis">barbara nguyen</span>
<span class="docEmphasis">elizabeth lone</span>
<span class="docEmphasis">dan savage</span>
<span class="docEmphasis">eliza goldberg</span>
<span class="docEmphasis">john goldenrod</span>

(The Command Line)
% <span class="docEmphStrong">nawk '{print $1, $2 | &quot;sort –r +1 –2 +0 –1 &quot;}' names</span>
(The Output)
<span class="docEmphasis">tony tram</span>
<span class="docEmphasis">john smith</span>
<span class="docEmphasis">dan savage</span>
<span class="docEmphasis">barbara nguyen</span>
<span class="docEmphasis">elizabeth lone</span>
<span class="docEmphasis">john goldenrod</span>
<span class="docEmphasis">susan goldberg</span>
<span class="docEmphasis">george goldberg</span>
<span class="docEmphasis">eliza goldberg</span>
<span class="docEmphasis">alice cheba</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText"><span class="docEmphasis">Awk</span> will pipe the output 
    of the <span class="docEmphasis">print</span> statement as input to the UNIX
    <span class="docEmphasis">sort</span> command, which does a reversed sort 
    using the second field as the primary key and the first field as the 
    secondary key. The UNIX command must be enclosed in double quotes. (See &quot;<a class="docLink" href="Appendix A.htm#app01lev1sec76">sort</a>&quot; 
    in <a class="docLink" href="Appendix A.htm">Appendix A</a>.)</td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec4">7.4 Closing Files and Pipes</h3>
<p class="docText">If you plan to use a file or pipe in an
<span class="docEmphasis">awk</span> program again for reading or writing, you 
may want to close it first, since it remains open until the script ends. Once 
opened, the pipe remains open until <span class="docEmphasis">awk</span> exits. 
Therefore, statements in the <span class="docEmphasis">END</span> block will 
also be affected by the pipe. The first line in the <span class="docEmphasis">
END</span> block closes the pipe.</p>
<h5 id="ch07list17" class="docExampleTitle">Example 7.17 </h5>
<pre>(In Script)
1   <span class="docEmphStrong">{ print $1, $2, $3 | &quot; sort -r +1 -2 +0 -1&quot;}</span>
    END{
2   <span class="docEmphStrong">close(&quot;sort –r +1 –2 +0 –1&quot;)</span>
     &lt;rest of statements&gt;  }</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList"><span class="docEmphasis">Awk</span> pipes each line 
      from the input file to the UNIX <span class="docEmphasis">sort</span> 
      utility.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">When the <span class="docEmphasis">END</span> block is 
      reached, the pipe is closed. The string enclosed in double quotes must be 
      identical to the pipe string where the pipe was initially opened.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
system</span> Function.</span> The built-in <span class="docEmphasis">system</span> 
function takes a UNIX system command as its argument, executes the command, and 
returns the exit status to the <span class="docEmphasis">awk</span> program. It 
is similar to the C standard library function, also called
<span class="docEmphasis">system().</span> The UNIX command must be enclosed in 
double quotes.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>system( &quot;UNIX Command&quot;)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list18" class="docExampleTitle">Example 7.18 </h5>
<pre>(In Script)
    <span class="docEmphStrong">{</span>
1   <span class="docEmphStrong">system ( &quot;cat&quot; $1 )</span>
2   <span class="docEmphStrong">system ( &quot;clear&quot; )</span>
    <span class="docEmphStrong">}</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">system</span> function 
      takes the UNIX <span class="docEmphasis">cat</span> command and the value 
      of the first field in the input file as its arguments. The
      <span class="docEmphasis">cat</span> command takes the value of the first 
      field, a filename, as its argument. The UNIX shell causes the
      <span class="docEmphasis">cat</span> command to be executed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">system</span> function 
      takes the UNIX <span class="docEmphasis">clear</span> command as its 
      argument. The shell executes the command, causing the screen to be 
      cleared.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec5">7.5 Review</h3>
<h4 class="docSection2Title" id="ch07lev2sec7">7.5.1 Increment and Decrement Operators</h4>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW    Joel Craig        3.0    .98    3     4</span>
<span class="docEmphasis">western            WE    Sharon Kelly      5.3    .97    5     23</span>
<span class="docEmphasis">southwest          SW    Chris Foster      2.7    .8     2     18</span>
<span class="docEmphasis">southern           SO    May Chin          5.1    .95    4     15</span>
<span class="docEmphasis">southeast          SE    Derek Johnson     4.0    .7     4     17</span>
<span class="docEmphasis">eastern            EA    Susan Beal        4.4    .84    5     20</span>
<span class="docEmphasis">northeast          NE    TJ Nichols        5.1    .94    3     13</span>
<span class="docEmphasis">north              NO    Val Shultz        4.5    .89    5     9</span>
<span class="docEmphasis">central            CT    Sheri Watson      5.7    .94    5     13</span>
</pre>
<h5 id="ch07list19" class="docExampleTitle">Example 7.19 </h5>
<pre>% <span class="docEmphStrong">nawk '/^north/{count += 1; print count}' datafile</span>
<span class="docEmphasis">1</span>
<span class="docEmphasis">2</span>
<span class="docEmphasis">3</span>
</pre>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW    Joel Craig        3.0    .98    3     4</span>
<span class="docEmphasis">western            WE    Sharon Kelly      5.3    .97    5     23</span>
<span class="docEmphasis">southwest          SW    Chris Foster      2.7    .8     2     18</span>
<span class="docEmphasis">southern           SO    May Chin          5.1    .95    4     15</span>
<span class="docEmphasis">southeast          SE    Derek Johnson     4.0    .7     4     17</span>
<span class="docEmphasis">eastern            EA    Susan Beal        4.4    .84    5     20</span>
<span class="docEmphasis">northeast          NE    TJ Nichols        5.1    .94    3     13</span>
<span class="docEmphasis">north              NO    Val Shultz        4.5    .89    5     9</span>
<span class="docEmphasis">central            CT    Sheri Watson      5.7    .94    5     13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the record begins with the regular expression
    <span class="docEmphasis">north,</span> a user-defined variable,
    <span class="docEmphasis">count,</span> is created;
    <span class="docEmphasis">count</span> is incremented by 1 and its value is 
    printed.</td>
  </tr>
</table>
<h5 id="ch07list20" class="docExampleTitle">Example 7.20 </h5>
<pre>% <span class="docEmphStrong">nawk '/^north/{count++; print count}' datafile</span>
<span class="docEmphasis">1</span>
<span class="docEmphasis">2</span>
<span class="docEmphasis">3</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The auto-increment operator increments the user-defined 
    variable <span class="docEmphasis">count</span> by 1. The value of
    <span class="docEmphasis">count</span> is printed.</td>
  </tr>
</table>
<h5 id="ch07list21" class="docExampleTitle">Example 7.21 </h5>
<pre>% <span class="docEmphStrong">nawk '{x = $7--; print &quot;x = &quot;x &quot;, $7 = &quot;$7}' datafile</span>
<span class="docEmphasis">x = 3, $7 = 2</span>
<span class="docEmphasis">x = 5, $7 = 4</span>
<span class="docEmphasis">x = 2, $7 = 1</span>
<span class="docEmphasis">x = 4, $7 = 3</span>
<span class="docEmphasis">x = 4, $7 = 3</span>
<span class="docEmphasis">x = 5, $7 = 4</span>
<span class="docEmphasis">x = 3, $7 = 2</span>
<span class="docEmphasis">x = 5, $7 = 4</span>
<span class="docEmphasis">x = 5, $7 = 4</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">After the value of the seventh field (<span class="docEmphasis">$7</span>) 
    is assigned to the user-defined variable <span class="docEmphasis">x,</span> 
    the auto-decrement operator decrements the seventh field by one. The value 
    of <span class="docEmphasis">x</span> and the seventh field are printed.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec8">7.5.2 Built-In Variables</h4>
<pre>EXAMPLE 7.22
% <span class="docEmphStrong">nawk '/^north/{print &quot;The record number is &quot; NR}' datafile</span>
<span class="docEmphasis">The record number is 1</span>
<span class="docEmphasis">The record number is 7</span>
<span class="docEmphasis">The record number is 8</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the record begins with the regular expression
    <span class="docEmphasis">north,</span> the string <span class="docEmphasis">
    The record number is</span> and the value of <span class="docEmphasis">NR</span> 
    (record number) are printed.</td>
  </tr>
</table>
<h5 id="ch07list23" class="docExampleTitle">Example 7.23 </h5>
<pre>% <span class="docEmphStrong">nawk '{print NR, $0}' datafile</span>
<span class="docEmphasis">1 northwest   NW     Joel Craig          3.0  .98  3    4</span>
<span class="docEmphasis">2 western     WE     Sharon Kelly        5.3  .97  5    23</span>
<span class="docEmphasis">3 southwest   SW     Chris Foster        2.7  .8   2    18</span>
<span class="docEmphasis">4 southern    SO     May Chin            5.1  .95  4    15</span>
<span class="docEmphasis">5 southeast   SE     Derek Johnson       4.0  .7   4    17</span>
<span class="docEmphasis">6 eastern     EA     Susan Beal          4.4  .84  5    20</span>
<span class="docEmphasis">7 northeast   NE     TJ Nichols          5.1  .94  3    13</span>
<span class="docEmphasis">8 north       NO     Val Shultz          4.5  .89  5    9</span>
<span class="docEmphasis">9 central     CT     Sheri Watson        5.7  .94  5    13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The value of <span class="docEmphasis">NR,</span> the 
    number of the current record, and the value of <span class="docEmphasis">$0,</span> 
    the entire record, are printed.</td>
  </tr>
</table>
<h5 id="ch07list24" class="docExampleTitle">Example 7.24 </h5>
<pre>% <span class="docEmphStrong">nawk 'NR==2,NR==5{print NR, $0}' datafile</span>
<span class="docEmphasis">2 western     WE      Sharon Kelly       5.3  97   5    23</span>
<span class="docEmphasis">3 southwest   SW      Chris Foster       2.7   8   2    18</span>
<span class="docEmphasis">4 southern    SO      May Chin           5.1  95   4    15</span>
<span class="docEmphasis">5 southeast   SE      Derek Johnson      4.0   7   4    17</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the value of <span class="docEmphasis">NR</span> is in 
    the <span class="docEmphasis">range</span> between <span class="docEmphasis">
    2</span> and <span class="docEmphasis">5</span> (record numbers 2–5), the 
    number of the record (<span class="docEmphasis">NR</span>) and the record (<span class="docEmphasis">$0</span>) 
    are printed.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list25" class="docExampleTitle">Example 7.25 </h5>
<pre>% <span class="docEmphStrong">nawk '/^north/{print NR, $1, $2, $NF, RS}' datafile</span>
<span class="docEmphasis">1 northwest NW 4</span>

<span class="docEmphasis">7 northeast NE 13</span>

<span class="docEmphasis">8 north NO 9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the record begins with the regular expression
    <span class="docEmphasis">north,</span> the number of the record (<span class="docEmphasis">NR</span>), 
    followed by the first field, the second field, the value of the last record 
    (<span class="docEmphasis">NF</span> preceded by a dollar sign) and the 
    value of <span class="docEmphasis">RS</span> (a newline) are printed. Since 
    the <span class="docEmphasis">print</span> function generates a newline by 
    default, <span class="docEmphasis">RS</span> will generate another newline, 
    resulting in double spacing between records.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile2</span>
Joel Craig:northwest:NW:3.0:.98:3:4
Sharon Kelly:western:WE:5.3:.97:5:23
Chris Foster:southwest:SW:2.7:.8:2:18
May Chin:southern:SO:5.1:.95:4:15
Derek Johnson:southeast:SE:4.0:.7:4:17
Susan Beal:eastern:EA:4.4:.84:5:20
TJ Nichols:northeast:NE:5.1:.94:3:13
Val Shultz:north:NO:4.5:.89:5:9
Sheri Watson:central:CT:5.7:.94:5:131.
</pre>
<h5 id="ch07list26" class="docExampleTitle">Example 7.26 </h5>
<pre>% <span class="docEmphStrong">nawk -F: 'NR == 5{print NF}' datafile2</span>
<span class="docEmphasis">7</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The field separator is set to a colon at the command line 
    with the <span class="docEmphasis">–F</span> option. If the number of the 
    record (<span class="docEmphasis">NR</span>) is <span class="docEmphasis">5,</span> 
    the number of fields (<span class="docEmphasis">NF</span>) is printed.</td>
  </tr>
</table>
<h5 id="ch07list27" class="docExampleTitle">Example 7.27 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{OFMT=&quot;%.2f&quot;;print 1.2456789,12E-2}' datafile2</span>
<span class="docEmphasis">1.25 0.12</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">OFMT,</span> output format 
    variable for the <span class="docEmphasis">print</span> function, is set so 
    that floating point numbers will be printed with a decimal-point precision 
    of two digits. The numbers <span class="docEmphasis">1.23456789</span> and
    <span class="docEmphasis">12E-2</span> are printed in the new format.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98     3     4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97     5     23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8      2     18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95     4     15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7      4     17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84     5     20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94     3     13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89     5     9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94     5     13</span>
</pre>
<h5 id="ch07list28" class="docExampleTitle">Example 7.28 </h5>
<pre>% <span class="docEmphStrong">nawk '{$9 = $6 * $7; print $9}' datafile</span>
<span class="docEmphasis">2.94</span>
<span class="docEmphasis">4.85</span>
<span class="docEmphasis">1.6</span>
<span class="docEmphasis">3.8</span>
<span class="docEmphasis">2.8</span>
<span class="docEmphasis">4.2</span>
<span class="docEmphasis">2.82</span>
<span class="docEmphasis">4.45</span>
<span class="docEmphasis">4.7</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The result of multiplying the sixth field (<span class="docEmphasis">$6</span>) 
    and the seventh field (<span class="docEmphasis">$7</span>) is stored in a 
    new field, <span class="docEmphasis">$9,</span> and printed. There were 
    eight fields; now there are nine.</td>
  </tr>
</table>
<h5 id="ch07list29" class="docExampleTitle">Example 7.29 </h5>
<pre>% <span class="docEmphStrong">nawk '{$10 = 100; print NF, $9, $0}' datafile</span>
<span class="docEmphasis">10  northwest NW     Joel Craig         3.0  .98  3    4    100</span>
<span class="docEmphasis">10  western   WE     Sharon Kelly</span>       <span class="docEmphasis">5.3  .97  5    23   100</span>
<span class="docEmphasis">10  southwest SW     Chris Foster</span>       <span class="docEmphasis">2.7  .8   2    18   100</span>
<span class="docEmphasis">10  southern  SO     May Chin</span>           <span class="docEmphasis">5.1  .95  4    15   100</span>
<span class="docEmphasis">10  southeast SE     Derek Johnson</span>      <span class="docEmphasis">4.0  .7   4    17   100</span>
<span class="docEmphasis">10  eastern   EA     Susan Beal</span>         <span class="docEmphasis">4.4  .84  5    20   100</span>
<span class="docEmphasis">10  northeast NE     TJ Nichols</span>         <span class="docEmphasis">5.1  .94  3    13   100</span>
<span class="docEmphasis">10  north     NO     Val Shultz</span>         <span class="docEmphasis">4.5  .89  5    9    100</span>
<span class="docEmphasis">10  central   CT     Sheri Watson</span>       <span class="docEmphasis">5.7  .94  5    13   100</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The tenth field (<span class="docEmphasis">$10</span>) is 
    assigned <span class="docEmphasis">100</span> for each record. This is a new 
    field. The ninth field (<span class="docEmphasis">$9</span>) does not exist, 
    so it will be considered a null field. The number of fields is printed (<span class="docEmphasis">NF</span>), 
    followed by the value of <span class="docEmphasis">$9,</span> the null 
    field, and the entire record (<span class="docEmphasis">$0</span>). The 
    value of the tenth field is <span class="docEmphasis">100.</span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec9">7.5.3 <span class="docEmphasis">BEGIN</span> 
Patterns</h4>
<h5 id="ch07list30" class="docExampleTitle">Example 7.30 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{print &quot;---------EMPLOYEES---------&quot;}'</span>
<span class="docEmphasis">---------EMPLOYEES---------</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">BEGIN</span> pattern is 
    followed by an action block. The action is to print out the string
    <span class="docEmphasis">---------EMPLOYEES---------</span> before opening 
    the input file. Note that an input file has not been provided and
    <span class="docEmphasis">awk</span> does not complain.</td>
  </tr>
</table>
<h5 id="ch07list31" class="docExampleTitle">Example 7.31 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{print &quot;\t\t---------EMPLOYEES-------\n&quot;}\</span>
  <span class="docEmphStrong">{print $0}' datafile</span>
                     ---------<span class="docEmphasis">EMPLOYEES-------</span>
<span class="docEmphasis">northwest     NW    Joel Craig          3.0   .98  3    4</span>
<span class="docEmphasis">western       WE    Sharon Kelly        5.3   .97  5    23</span>
<span class="docEmphasis">southwest     SW    Chris Foster        2.7   .8   2    18</span>
<span class="docEmphasis">southern      SO    May Chin            5.1   .95  4    15</span>
<span class="docEmphasis">southeast     SE    Derek Johnson</span>       <span class="docEmphasis">4.0   .7   4    17</span>
<span class="docEmphasis">eastern       EA    Susan Beal          4.4   .84  5    20</span>
<span class="docEmphasis">northeast     NE    TJ Nichols          5.1   .94  3    13</span>
<span class="docEmphasis">north         NO    Val Shultz          4.5   .89  5    9</span>
<span class="docEmphasis">central       CT    Sheri Watson        5.7   .94  5    13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">BEGIN</span> action block 
    is executed first. The title <span class="docEmphasis">
    ---------EMPLOYEES-------</span> is printed. The second action block prints 
    each record in the input file. When breaking lines, the backslash is used to 
    suppress the carriage return. Lines can be broken at a semicolon or a curly 
    brace.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile2</span>
Joel Craig:northwest:NW:3.0:.98:3:4
Sharon Kelly:western:WE:5.3:.97:5:23
Chris Foster:southwest:SW:2.7:.8:2:18
May Chin:southern:SO:5.1:.95:4:15
Derek Johnson:southeast:SE:4.0:.7:4:17
Susan Beal:eastern:EA:4.4:.84:5:20
TJ Nichols:northeast:NE:5.1:.94:3:13
Val Shultz:north:NO:4.5:.89:5:9
Sheri Watson:central:CT:5.7:.94:5:131.
</pre>
<h5 id="ch07list32" class="docExampleTitle">Example 7.32 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{ FS=&quot;:&quot;;OFS=&quot;\t&quot;};/^Sharon/{print $1, $2, $8 }'\</span>
  <span class="docEmphStrong">datafile2</span>
<span class="docEmphasis">Sharon Kelly      western     28</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">BEGIN</span> action block 
    is used to initialize variables. The <span class="docEmphasis">FS</span> 
    variable (field separator) is assigned a colon. The
    <span class="docEmphasis">OFS</span> variable (output field separator) is 
    assigned a tab (<span class="docEmphasis">\t</span>). If a record begins 
    with the regular expression <span class="docEmphasis">Sharon,</span> the 
    first, second, and eighth fields (<span class="docEmphasis">$1,</span>
    <span class="docEmphasis">$2,</span> <span class="docEmphasis">$8</span>) 
    are printed. Each field in the output is separated by a tab.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec10">7.5.4 <span class="docEmphasis">END</span> Patterns</h4>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list33" class="docExampleTitle">Example 7.33 </h5>
<pre>% <span class="docEmphStrong">nawk 'END{print &quot;The total number of records is &quot; NR}' datafile</span>
<span class="docEmphasis">The total number of records is 9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">After <span class="docEmphasis">awk</span> has finished 
    processing the input file, the statements in the <span class="docEmphasis">
    END</span> block are executed. The string <span class="docEmphasis">The 
    total number of records is</span> is printed, followed by the value of
    <span class="docEmphasis">NR,</span> the number of the last record.</td>
  </tr>
</table>
<h5 id="ch07list34" class="docExampleTitle">Example 7.34 </h5>
<pre>% <span class="docEmphStrong">nawk '/^north/{count++}END{print count}' datafile</span>
<span class="docEmphasis">3</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the record begins with the regular expression
    <span class="docEmphasis">north,</span> the user-defined variable
    <span class="docEmphasis">count</span> is incremented by one. When
    <span class="docEmphasis">awk</span> has finished processing the input file, 
    the value stored in the variable <span class="docEmphasis">count</span> is 
    printed.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec11">7.5.5 <span class="docEmphasis">awk</span> Script 
with <span class="docEmphasis">BEGIN</span> and <span class="docEmphasis">END</span></h4>
<h5 id="ch07list35" class="docExampleTitle">Example 7.35 </h5>
<pre>    <span class="docEmphasis"># Second awk script-- awk.sc2</span>
1   <span class="docEmphStrong">BEGIN{</span> FS=&quot;:&quot;; OFS=&quot;\t&quot;
       print &quot;  NAME\t\tDISTRICT\tQUANTITY&quot;
       print &quot;___________________________________________\n&quot;
    }

2      {print $1&quot;\t  &quot; $3&quot;\t\t&quot; $7}
       {total+=$7}
       /north/{count++}

3   <span class="docEmphStrong">END</span>{
       print &quot;---------------------------------------------&quot;
       print &quot;The total quantity is &quot; total
       print &quot;The number of northern salespersons is &quot; count &quot;.&quot;
    }
(The Output)
4  % <span class="docEmphStrong">nawk -f awk.sc2 datafile2</span>
     <span class="docEmphasis">NAME      DISTRICT  QUANTITY</span>
   <span class="docEmphasis">___________________________________________</span>
   <span class="docEmphasis">Joel Craig        NW       4</span>
   <span class="docEmphasis">Sharon Kelly      WE       23</span>
   <span class="docEmphasis">Chris Foster      SW       18</span>
   <span class="docEmphasis">May Chin          SO       15</span>
   <span class="docEmphasis">Derek Johnson     SE       17</span>
   <span class="docEmphasis">Susan Beal        EA       20</span>
   <span class="docEmphasis">TJ Nichols        NE       13</span>
   <span class="docEmphasis">Val Shultz        NO       9</span>
   <span class="docEmphasis">Sheri Watson      CT       13</span>
   <span class="docEmphasis">---------------------------------------------</span>
   <span class="docEmphasis">The total quantity is 132</span>
   <span class="docEmphasis">The number of northern salespersons is 3.</span>
</pre>
<pre>% <span class="docEmphStrong">cat datafile2</span>
Joel Craig:northwest:NW:3.0:.98:3:4
Sharon Kelly:western:WE:5.3:.97:5:23
Chris Foster:southwest:SW:2.7:.8:2:18
May Chin:southern:SO:5.1:.95:4:15
Derek Johnson:southeast:SE:4.0:.7:4:17
Susan Beal:eastern:EA:4.4:.84:5:20
TJ Nichols:northeast:NE:5.1:.94:3:13
Val Shultz:north:NO:4.5:.89:5:9
Sheri Watson:central:CT:5.7:.94:5:131.
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">BEGIN</span> block is 
      executed first. The field separator (FS) and the output field separator 
      (OFS) are set. Header output is printed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The body of the <span class="docEmphasis">awk</span> 
      script contains statements that are executed for each line of input coming 
      from <span class="docEmphasis">datafile2.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Statements in the <span class="docEmphasis">END</span> 
      block are executed after the input file has been closed, i.e., before
      <span class="docEmphasis">awk</span> exits.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">At the command line, the <span class="docEmphasis">nawk</span> 
      program is executed. The <span class="docEmphasis">–f</span> option is 
      followed by the script name, <span class="docEmphasis">awk.sc2,</span> and 
      then by the input file, <span class="docEmphasis">datafile2.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec12">7.5.6 The <span class="docEmphasis">printf</span> 
Function</h4>
<h5 id="ch07list36" class="docExampleTitle">Example 7.36 </h5>
<pre>% <span class="docEmphStrong">nawk '{printf &quot;$%6.2f\n&quot;,$6 * 100}' datafile</span>
<span class="docEmphasis">$ 98.00</span>
<span class="docEmphasis">$ 97.00</span>
<span class="docEmphasis">$ 80.00</span>
<span class="docEmphasis">$ 95.00</span>
<span class="docEmphasis">$ 70.00</span>
<span class="docEmphasis">$ 84.00</span>
<span class="docEmphasis">$ 94.00</span>
<span class="docEmphasis">$ 89.00</span>
<span class="docEmphasis">$ 94.00</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">printf</span> function 
    formats a floating point number to be right-justified (the default) with a 
    total of <span class="docEmphasis">6</span> digits, one for the decimal 
    point, and two for the decimal numbers to the right of the period. The 
    number will be rounded up and printed.</td>
  </tr>
</table>
<h5 id="ch07list37" class="docExampleTitle">Example 7.37 </h5>
<pre>% <span class="docEmphStrong">nawk '{printf &quot;|%-15s|\n&quot;,$4}' datafile</span>
<span class="docEmphasis">|Craig        |</span>
<span class="docEmphasis">|Kelly        |</span>
<span class="docEmphasis">|Foster       |</span>
<span class="docEmphasis">|Chin         |</span>
<span class="docEmphasis">|Johnson      |</span>
<span class="docEmphasis">|Beal         |</span>
<span class="docEmphasis">|Nichols      |</span>
<span class="docEmphasis">|Shultz       |</span>
<span class="docEmphasis">|Watson       |</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">A left-justified, <span class="docEmphasis">15</span>-space 
    string is printed. The fourth field (<span class="docEmphasis">$4</span>) is 
    printed enclosed in vertical bars to illustrate the spacing.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h4 class="docSection2Title" id="ch07lev2sec13">7.5.7 Redirection and Pipes</h4>
<h5 id="ch07list38" class="docExampleTitle">Example 7.38 </h5>
<pre>% <span class="docEmphStrong">nawk '/north/{print $1, $3, $4 &gt; &quot;districts&quot;}' datafile</span>
% <span class="docEmphStrong">cat districts</span>
<span class="docEmphasis">northwest Joel Craig</span>
<span class="docEmphasis">northeast TJ Nichols</span>
<span class="docEmphasis">north Val Shultz</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the record contains the regular expression
    <span class="docEmphasis">north,</span> the first, third, and fourth fields 
    (<span class="docEmphasis">$1,</span> <span class="docEmphasis">$3,</span>
    <span class="docEmphasis">$4</span>) are printed to an output file called
    <span class="docEmphasis">districts.</span> Once the file is opened, it 
    remains open until closed or the program terminates. The filename &quot;<span class="docEmphasis">districts</span>&quot; 
    must be enclosed in double quotes.</td>
  </tr>
</table>
<h5 id="ch07list39" class="docExampleTitle">Example 7.39 </h5>
<pre>% <span class="docEmphStrong">nawk '/south/{print $1, $2, $3 &gt;&gt; &quot;districts&quot;}' datafile</span>
% <span class="docEmphStrong">cat districts</span>
<span class="docEmphasis">northwest Joel Craig</span>
<span class="docEmphasis">northeast TJ Nichols</span>
<span class="docEmphasis">north Val Shultz</span>
<span class="docEmphasis">southwest SW Chris</span>
<span class="docEmphasis">southern SO May</span>
<span class="docEmphasis">southeast SE Derek</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the record contains the pattern
    <span class="docEmphasis">south,</span> the first, second, and third fields 
    (<span class="docEmphasis">$1,</span> <span class="docEmphasis">$2,</span>
    <span class="docEmphasis">$3</span>) are appended to the output file
    <span class="docEmphasis">districts.</span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec14">7.5.8 Opening and Closing a Pipe</h4>
<h5 id="ch07list40" class="docExampleTitle">Example 7.40 </h5>
<pre><span class="docEmphasis"># awk script using pipes -- awk.sc3</span>
1  BEGIN{
2     printf &quot; %-22s%s\n&quot;, &quot;NAME&quot;, &quot;DISTRICT&quot;
      print &quot;--------------------------------------&quot;
3   }
4   /west/{count++}
5   {<span class="docEmphStrong">printf &quot;%s %s\t\t%-15s\n&quot;, $3, $4, $1| &quot;sort +1&quot;</span> }
6   END{
7       <span class="docEmphStrong">close &quot;sort +1&quot;</span>
        printf &quot;The number of sales persons in the western &quot;
        printf &quot;region is &quot; count &quot;.&quot;}

<span class="docEmphStrong">(The Output)</span>
   % <span class="docEmphStrong">nawk -f awk.sc3 datafile</span>
1  <span class="docEmphasis">NAME                        DISTRICT</span>
2  <span class="docEmphasis">--------------------------------------------------</span>
3  <span class="docEmphasis">Susan Beal                  eastern</span>
   <span class="docEmphasis">May Chin                    southern</span>
   <span class="docEmphasis">Joel Craig                  northwest</span>
   <span class="docEmphasis">Chris Foster                southwest</span>
   <span class="docEmphasis">Derek Johnson               southeast</span>
   <span class="docEmphasis">Sharon Kelly                western</span>
   <span class="docEmphasis">TJ Nichols                  northeast</span>
   <span class="docEmphasis">Val Shultz                  north</span>
   <span class="docEmphasis">Sheri Watson                central</span>
   <span class="docEmphasis">The number of sales persons in the western region is 3.</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The special <span class="docEmphasis">BEGIN</span> 
      pattern is followed by an action block. The statements in this block are 
      executed first, before <span class="docEmphasis">awk</span> processes the 
      input file.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">printf</span> function 
      displays the string <span class="docEmphasis">NAME</span> as a
      <span class="docEmphasis">22</span>-character, left-justified string, 
      followed by the string <span class="docEmphasis">DISTRICT,</span> which is 
      right-justified.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">BEGIN</span> block ends.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Now <span class="docEmphasis">awk</span> will process 
      the input file, one line at a time. If the pattern
      <span class="docEmphasis">west</span> is found, the action block is 
      executed, i.e., the user-defined variable <span class="docEmphasis">count</span> 
      is incremented by one. The first time <span class="docEmphasis">awk</span> 
      encounters the <span class="docEmphasis">count</span> variable, it will be 
      created and given an initial value of zero.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">print</span> function 
      formats and sends its output to a pipe. After all of the output has been 
      collected, it will be sent to the <span class="docEmphasis">sort</span> 
      command</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">END</span> block is 
      started.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The pipe (<span class="docEmphasis">sort +1</span>) 
      must be closed with exactly the same command that opened it; in this 
      example, &quot;<span class="docEmphasis">sort +1</span>&quot;. Otherwise, the
      <span class="docEmphasis">END</span> statements will be sorted with the 
      rest of the output.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec6">UNIX TOOLS LAB EXERCISE</h3>
<h4 class="docSection2Title" id="ch07lev2sec15">Lab 5: <span class="docEmphasis">nawk</span> 
Exercise</h4>
<p class="docText">Mike Harrington:(510) 548-1278:250:100:175</p>
<p class="docText">Christian Dobbins:(408) 538-2358:155:90:201</p>
<p class="docText">Susan Dalsass:(206) 654-6279:250:60:50</p>
<p class="docText">Archie McNichol:(206) 548-1348:250:100:175</p>
<p class="docText">Jody Savage:(206) 548-1278:15:188:150</p>
<p class="docText">Guy Quigley:(916) 343-6410:250:100:175</p>
<p class="docText">Dan Savage:(406) 298-7744:450:300:275</p>
<p class="docText">Nancy McNeil:(206) 548-1278:250:80:75</p>
<p class="docText">John Goldenrod:(916) 348-4278:250:100:175</p>
<p class="docText">Chet Main:(510) 548-5258:50:95:135</p>
<p class="docText">Tom Savage:(408) 926-3456:250:168:200</p>
<p class="docText">Elizabeth Stachelin:(916) 440-1763:175:75:300</p>
<p class="docText">(Refer to the database called <span class="docEmphasis">
lab5.data</span> on the CD.)</p>
<p class="docText">The database above contains the names, phone numbers, and 
money contributions to the party campaign for the past three months.</p>
<p class="docText">Write a <span class="docEmphasis">nawk</span> script to 
produce the following output:</p>
<pre>% <span class="docEmphStrong">nawk -f nawk.sc db</span>
                    ***CAMPAIGN 1998 CONTRIBUTIONS***
----------------------------------------------------------------------
NAME                 PHONE            Jan  |  Feb  |  Mar | Total Donated
----------------------------------------------------------------------
Mike Harrington     (510) 548-1278    250.00   100.00  175.00   525.00
Christian Dobbins   (408) 538-2358    155.00    90.00  201.00   446.00
Susan Dalsass       (206) 654-6279    250.00    60.00   50.00   360.00
Archie McNichol     (206) 548-1348    250.00   100.00  175.00   525.00
Jody Savage         (206) 548-1278     15.00   188.00  150.00   353.00
Guy Quigley         (916) 343-6410    250.00   100.00  175.00   525.00
Dan Savage          (406) 298-7744    450.00   300.00  275.00  1025.00
Nancy McNeil        (206) 548-1278    250.00    80.00   75.00   405.00
John Goldenrod      (916) 348-4278    250.00   100.00  175.00   525.00
Chet Main           (510) 548-5258     50.00    95.00  135.00   280.00
Tom Savage          (408) 926-3456    250.00   168.00  200.00   618.00
Elizabeth Stacheli  (916) 440-1763    175.00    75.00  300.00   550.00
----------------------------------------------------------------------
                              SUMMARY
----------------------------------------------------------------------
The campaign received a total of $6137.00 for this quarter.
The average donation for the 12 contributors was $511.42.
The highest contribution was $300.00.
The lowest contribution was $15.00.</pre>

<h3 class="docSection1Title" id="ch07lev1sec7">7.6 Conditional Statements</h3>
<p class="docText">The conditional statements in <span class="docEmphasis">awk</span> 
were borrowed from the C language. They are used to control the flow of the 
program in making decisions.</p>
<h4 class="docSection2Title" id="ch07lev2sec16">7.6.1 <span class="docEmphasis">if</span> 
Statements</h4>
<p class="docText">Statements beginning with the <span class="docEmphasis">if</span> 
construct are action statements. With <span class="docEmphasis">conditional 
patterns,</span> the <span class="docEmphasis">if</span> is implied; with a 
conditional <span class="docEmphasis">action</span> statement, the
<span class="docEmphasis">if</span> is explicitly stated, and followed by an 
expression enclosed in parentheses. If the expression evaluates true (nonzero or 
non-null), the statement or block of statements following the expression is 
executed. If there is more than one statement following the conditional 
expression, the statements are separated either by semicolons or a newline, and 
the group of statements must be enclosed in curly braces so that the statements 
are executed as a block.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>if (expression) {
    statement; statement; ...
    }
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list41" class="docExampleTitle">Example 7.41 </h5>
<pre>1   % <span class="docEmphStrong">nawk '{if ( $6 &gt; 50 ) print $1 &quot;Too high&quot;}' filename</span>

2   % <span class="docEmphStrong">nawk '{if ($6 &gt; 20 &amp;&amp; $6  &lt;= 50){safe++; print &quot;OK&quot;}}' filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">if</span> action 
      block, the expression is tested. If the value of the sixth field is 
      greater than <span class="docEmphasis">50,</span> the
      <span class="docEmphasis">print</span> statement is executed. Since the 
      statement following the expression is a single statement, curly braces are 
      not required. (<span class="docEmphasis">filename</span> represents the 
      input file.)</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">if</span> action 
      block, the expression is tested. If the sixth field is greater than
      <span class="docEmphasis">20</span> <span class="docEmphasis">and</span> 
      the sixth field is less than or equal to <span class="docEmphasis">50,</span> 
      the statements following the expression are executed as a block and must 
      be enclosed in curly braces.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec17">7.6.2 <span class="docEmphasis">if/else</span> 
Statements</h4>
<p class="docText">The <span class="docEmphasis">if/else</span> statement allows 
a two-way decision. If the expression after the <span class="docEmphasis">if</span> 
keyword is true, the block of statements associated with that expression are 
executed. If the first expression evaluates to false or zero, the block of 
statements after the <span class="docEmphasis">else</span> keyword is executed. 
If multiple statements are to be included with the <span class="docEmphasis">if</span> 
or <span class="docEmphasis">else,</span> they must be blocked with curly 
braces.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>{if (expression) {
    statement; statement; ...
    }
else{
    statement; statement; ...
    }
}
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list42" class="docExampleTitle">Example 7.42 </h5>
<pre>1   % <span class="docEmphStrong">nawk '{if( $6 &gt; 50) print  $1 &quot; Too high&quot; ;\</span>
      <span class="docEmphStrong">else print &quot;Range is OK&quot;}' filename</span>
2   % <span class="docEmphStrong">nawk '{if ( $6 &gt; 50 ) { count++; print $3 } \</span>
      <span class="docEmphStrong">else { x+5; print $2 } }' filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the first expression is true, that is, the sixth 
      field (<span class="docEmphasis">$6</span>) is greater than
      <span class="docEmphasis">50,</span> the <span class="docEmphasis">print</span> 
      function prints the first field and <span class="docEmphasis">Too high;</span> 
      otherwise, the statement after the <span class="docEmphasis">else,</span>
      <span class="docEmphasis">Range is OK,</span> is printed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the first expression is true, that is, the sixth 
      field (<span class="docEmphasis">$6</span>) is greater than
      <span class="docEmphasis">50,</span> the block of statements is executed; 
      otherwise, the block of statements after the <span class="docEmphasis">
      else</span> is executed. Note that the blocks are enclosed in curly 
      braces.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec18">7.6.3 <span class="docEmphasis">if/else</span> and
<span class="docEmphasis">else if</span> Statements</h4>
<p class="docText">The <span class="docEmphasis">if/else</span> and
<span class="docEmphasis">else if</span> statements allow a multiway decision. 
If the expression following the keyword <span class="docEmphasis">if</span> is 
true, the block of statements associated with that expression is executed and 
control starts again after the last closing curly brace associated with the 
final <span class="docEmphasis">else.</span> Otherwise, control goes to the
<span class="docEmphasis">else if</span> and that expression is tested. When the 
first <span class="docEmphasis">else if</span> condition is true, the statements 
following the expression are executed. If none of the conditional expressions 
test true, control goes to the <span class="docEmphasis">else</span> statements. 
The <span class="docEmphasis">else</span> is called the default action because 
if none of the other statements are true, the <span class="docEmphasis">else</span> 
block is executed.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>{if (expression) {
    statement; statement; ...
    }
else if (expression){
    statement; statement; ...
    }
else if (expression){
    statement; statement; ...
    }
else{
    statement
    }
}
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list43" class="docExampleTitle">Example 7.43 </h5>
<pre>(In the Script)
1   {if ( $3 &gt; 89 &amp;&amp; $3 &lt; 101 ) Agrade++
2   else if ( $3 &gt; 79 ) Bgrade++
3   else if ( $3 &gt; 69 ) Cgrade++
4   else if ( $3 &gt; 59 ) Dgrade++
5   else Fgrade++
    }
    END{print &quot;The number of failures is&quot; Fgrade }
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">if</span> statement is an 
      action and must be enclosed in curly braces. The expression is evaluated 
      from left to right. If the first expression is false, the whole expression 
      is false; if the first expression is true, the expression after the 
      logical <span class="docEmphasis">and</span> (<span class="docEmphasis">&amp;&amp;</span>) 
      is evaluated. If it is true, the variable <span class="docEmphasis">Agrade</span> 
      is incremented by one.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the first expression following the
      <span class="docEmphasis">if</span> keyword evaluates to false (0), the
      <span class="docEmphasis">else if</span> expression is tested. If it 
      evaluates to true, the statement following the expression is executed; 
      that is, if the third field (<span class="docEmphasis">$3</span>) is 
      greater than <span class="docEmphasis">79,</span>
      <span class="docEmphasis">Bgrade</span> is incremented by one.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the first two statements are false, the
      <span class="docEmphasis">else if</span> expression is tested, and if the 
      third field (<span class="docEmphasis">$3</span>) is greater than
      <span class="docEmphasis">69,</span> <span class="docEmphasis">Cgrade</span> 
      is incremented.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the first three statements are false, the
      <span class="docEmphasis">else if</span> expression is tested, and if the 
      third field is greater than <span class="docEmphasis">59,</span>
      <span class="docEmphasis">Dgrade</span> is incremented.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If none of the expressions tested above is true, the
      <span class="docEmphasis">else</span> block is executed. The curly brace 
      ends the action block. <span class="docEmphasis">Fgrade</span> is 
      incremented.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec8">7.7 Loops</h3>
<p class="docText">Loops are used to repeatedly execute the statements following 
the test expression if a condition is true. Loops are often used to iterate 
through the fields within a record and to loop through the elements of an array 
in the <span class="docEmphasis">END</span> block. <span class="docEmphasis">Awk</span> 
has three types of loops: the <span class="docEmphasis">while</span> loop, the
<span class="docEmphasis">for</span> loop, and the special
<span class="docEmphasis">for</span> loop, which will be discussed later when 
working with <span class="docEmphasis">awk</span> arrays.</p>
<h4 class="docSection2Title" id="ch07lev2sec19">7.7.1 <span class="docEmphasis">while</span> Loop</h4>
<p class="docText">The first step in using a <span class="docEmphasis">while</span> 
loop is to set a variable to an initial value. The value is then tested in the
<span class="docEmphasis">while</span> expression. If the expression evaluates 
to true (nonzero), the body of the loop is entered and the statements within 
that body are executed. If there is more than one statement within the body of 
the loop, those statements must be enclosed in curly braces. Before ending the 
loop block, the variable controlling the loop expression must be updated or the 
loop will continue forever. In the following example, the variable is 
reinitialized each time a new record is processed.</p>
<p class="docText">The <span class="docEmphasis">do/while</span> loop is similar 
to the <span class="docEmphasis">while</span> loop, except that the expression 
is not tested until the body of the loop is executed at least once.</p>
<h5 id="ch07list44" class="docExampleTitle">Example 7.44 </h5>
<pre>% <span class="docEmphStrong">nawk '{ i  = 1; while ( i &lt;= NF ) { print NF, $i ; i++ } }' filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The variable <span class="docEmphasis">i</span> is 
    initialized to one; while <span class="docEmphasis">i</span> is less than or 
    equal to the number of fields (<span class="docEmphasis">NF</span>) in the 
    record, the <span class="docEmphasis">print</span> statement will be 
    executed, then <span class="docEmphasis">i</span> will be incremented by 
    one. The expression will then be tested again, until the variable
    <span class="docEmphasis">i</span> is greater than the value of
    <span class="docEmphasis">NF.</span> The variable <span class="docEmphasis">
    i</span> is not reinitialized until <span class="docEmphasis">awk</span> 
    starts processing the next record.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec20">7.7.2 <span class="docEmphasis">for</span> Loop</h4>
<p class="docText">The <span class="docEmphasis">for</span> loop and
<span class="docEmphasis">while</span> loop are essentially the same, except the
<span class="docEmphasis">for</span> loop requires three expressions within the 
parentheses: the initialization expression, the test expression, and the 
expression to update the variables within the test expression. In
<span class="docEmphasis">awk,</span> the first statement within the parentheses 
of the <span class="docEmphasis">for</span> loop can perform only one 
initialization. (In C, you can have multiple initializations separated by 
commas.)</p>
<h5 id="ch07list45" class="docExampleTitle">Example 7.45 </h5>
<pre>% <span class="docEmphStrong">nawk '{ for( i = 1; i &lt;= NF; i++) print NF,$i }' filex</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The variable <span class="docEmphasis">i</span> is 
    initialized to one and tested to see whether it is less than or equal to the 
    number of fields (<span class="docEmphasis">NF</span>) in the record. If so, 
    the <span class="docEmphasis">print</span> function prints the value of
    <span class="docEmphasis">NF</span> and the value of
    <span class="docEmphasis">$i</span> (the <span class="docEmphasis">$</span> 
    preceding the <span class="docEmphasis">i</span> is the number of the
    <span class="docEmphasis">i</span>th field), then <span class="docEmphasis">
    i</span> is incremented by one. (Frequently the <span class="docEmphasis">
    for</span> loop is used with arrays in an <span class="docEmphasis">END</span> 
    action to loop through the elements of an array.) See &quot;<a class="docLink" href="#ch07lev1sec10">Arrays</a>&quot;.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec21">7.7.3 Loop Control</h4>
<p class="docText"><span class="docEmphStrong"><span class="docEmphasis">break</span> 
and <span class="docEmphasis">continue</span> Statements.</span> The
<span class="docEmphasis">break</span> statement lets you break out of a loop if 
a certain condition is true. The <span class="docEmphasis">continue</span> 
statement causes the loop to skip any statements that follow if a certain 
condition is true, and returns control to the top of the loop, starting at the 
next iteration.</p>
<h5 id="ch07list46" class="docExampleTitle">Example 7.46 </h5>
<pre>(In the Script)
1   {for ( x = 3; x &lt;= NF; x++ )
        if ( $x &lt; 0 ){ print &quot;Bottomed out!&quot;; <span class="docEmphStrong">break</span>}
        <span class="docEmphasis"># breaks out of for loop</span>
    }

2   {for ( x = 3; x &lt;= NF; x++ )
        if ( $x == 0 ) { print &quot;Get next item&quot;; <span class="docEmphStrong">continue</span>}
        <span class="docEmphasis"># starts next iteration of  the for loop</span>
    }</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the value of the field <span class="docEmphasis">$x</span> 
      is less than zero, the <span class="docEmphasis">break</span> statement 
      causes control to go to the statement after the closing curly brace of the 
      loop body; i.e., it breaks out of the loop.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the value of the field <span class="docEmphasis">$x</span> 
      is equal to zero, the <span class="docEmphasis">continue</span> statement 
      causes control to start at the top of the loop and start execution, in the 
      third expression at the <span class="docEmphasis">for</span> loop at
      <span class="docEmphasis">x++.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec9">7.8 Program Control Statements</h3>
<h4 class="docSection2Title" id="ch07lev2sec22">7.8.1 <span class="docEmphasis">next</span> 
Statement</h4>
<p class="docText">The <span class="docEmphasis">next</span> statement gets the 
next line of input from the input file, restarting execution at the top of the
<span class="docEmphasis">awk</span> script.</p>
<h5 id="ch07list47" class="docExampleTitle">Example 7.47 </h5>
<pre>(In Script)
{ if ($1 ~ /Peter/){next}
    else {print}
}
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the first field contains <span class="docEmphasis">
    Peter,</span> <span class="docEmphasis">awk</span> skips over this line and 
    gets the next line from the input file. The script resumes execution at the 
    beginning.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec23">7.8.2 <span class="docEmphasis">exit</span> 
Statement</h4>
<p class="docText">The <span class="docEmphasis">exit</span> statement is used 
to terminate the <span class="docEmphasis">awk</span> program. It stops 
processing records, but does not skip over an <span class="docEmphasis">END</span> 
statement. If the <span class="docEmphasis">exit</span> statement is given a 
value between 0 and 255 as an argument (exit 1), this value can be printed at 
the command line to indicate success or failure by typing:</p>
<h5 id="ch07list48" class="docExampleTitle">Example 7.48 </h5>
<pre>(In Script)
   {exit (1) }

(The Command Line)
% <span class="docEmphStrong">echo $status</span>     <span class="docEmphasis">(csh)</span>
<span class="docEmphasis">1</span>

$ <span class="docEmphStrong">echo $?</span>    <span class="docEmphasis">(sh/ksh)</span>
<span class="docEmphasis">1</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">An exit status of zero indicates success, and an exit 
    value of nonzero indicates failure (a convention in UNIX). It is up to the 
    programmer to provide the exit status in a program. The exit value returned 
    in this example is 1.</td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec10">7.9 Arrays</h3>
<p class="docText">Arrays in <span class="docEmphasis">awk</span> are called
<span class="docEmphasis">associative arrays</span> because the subscripts can 
be either numbers or strings. The subscript is often called the key and is 
associated with the value assigned to the corresponding array element. The keys 
and values are stored internally in a table where a hashing algorithm is applied 
to the value of the key in question. Due to the techniques used for hashing, the 
array elements are not stored in a sequential order, and when the contents of 
the array are displayed, they may not be in the order you expected.</p>
<p class="docText">An array, like a variable, is created by using it, and
<span class="docEmphasis">awk</span> can infer whether it is used to store 
numbers or strings. Array elements are initialized with numeric value zero and 
string value null, depending on the context. You do not have to declare the size 
of an <span class="docEmphasis">awk</span> array. <span class="docEmphasis">Awk</span> 
arrays are used to collect information from records and may be used for 
accumulating totals, counting words, tracking the number of times a pattern 
occurred, and so forth.</p>
<h4 class="docSection2Title" id="ch07lev2sec24">7.9.1 Subscripts for Associative Arrays</h4>
<p class="docText"><span class="docEmphStrong">Using Variables as Array Indexes</span></p>
<h5 id="ch07list49" class="docExampleTitle">Example 7.49 </h5>
<pre>(The Input File)
% <span class="docEmphStrong">cat employees</span>
<span class="docEmphasis">Tom Jones      4424   5/12/66   543354</span>
<span class="docEmphasis">Mary Adams     5346   11/4/63   28765</span>
<span class="docEmphasis">Sally Chang    1654   7/22/54   650000</span>
<span class="docEmphasis">Billy Black    1683   9/23/44   336500</span>

(The Command Line)
1  % <span class="docEmphStrong">nawk '{name[x++]=$2};END{for(i=0; i&lt;NR; i++)\</span>
     <span class="docEmphStrong">print i, name[i]}' employees</span>
   <span class="docEmphasis">0 Jones</span>
   <span class="docEmphasis">1 Adams</span>
   <span class="docEmphasis">2 Chang</span>
   <span class="docEmphasis">3 Black</span>

2  % <span class="docEmphStrong">nawk '{id[NR]=$3};END{for(x = 1; x &lt;= NR; x++)\</span>
     <span class="docEmphStrong">print id[x]}' employees</span>
   <span class="docEmphasis">4424</span>
   <span class="docEmphasis">5346</span>
   <span class="docEmphasis">1654</span>
   <span class="docEmphasis">1683</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The subscript in array <span class="docEmphasis">name</span> 
      is a user-defined variable, <span class="docEmphasis">x.</span> The
      <span class="docEmphasis">++</span> indicates a numeric context.
      <span class="docEmphasis">Awk</span> initializes <span class="docEmphasis">
      x</span> to zero and increments <span class="docEmphasis">x</span> by one
      <span class="docEmphasis">after</span> (post-increment operator) it is 
      used. The value of the second field is assigned to each element of the
      <span class="docEmphasis">name</span> array. In the
      <span class="docEmphasis">END</span> block, the <span class="docEmphasis">
      for</span> loop is used to loop through the array, printing the value that 
      was stored there, starting at subscript zero. Since the subscript is just 
      a key, it does not have to start at zero. It can start at any value, 
      either a number or a string.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">awk</span> variable
      <span class="docEmphasis">NR</span> contains the number of the current 
      record. By using <span class="docEmphasis">NR</span> as a subscript, the 
      value of the third field is assigned to each element of the array for each 
      record. At the end, the <span class="docEmphasis">for</span> loop will 
      loop through the array, printing out the values that were stored there.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The Special
<span class="docEmphasis">for</span> Loop.</span> The special
<span class="docEmphasis">for</span> loop is used to read through an associative 
array in cases where the <span class="docEmphasis">for</span> loop is not 
practical; that is, when strings are used as subscripts or the subscripts are 
not consecutive numbers. The special <span class="docEmphasis">for</span> loop 
uses the subscript as a key into the value associated with it.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>{for(item in arrayname){
    print arrayname[item]
    }
}
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list50" class="docExampleTitle">Example 7.50 </h5>
<pre>(The Input File)
% <span class="docEmphStrong">cat db</span>
<span class="docEmphasis">Tom Jones</span>
<span class="docEmphasis">Mary Adams</span>
<span class="docEmphasis">Sally Chang</span>
<span class="docEmphasis">Billy Black</span>
<span class="docEmphasis">Tom Savage</span>
<span class="docEmphasis">Tom Chung</span>
<span class="docEmphasis">Reggie Steel</span>
<span class="docEmphasis">Tommy Tucker</span>

(The Command Line, <span class="docEmphasis">for</span> Loop)
1  % <span class="docEmphStrong">nawk '/^Tom/{name[NR]=$1};\</span>
     <span class="docEmphStrong">END{for( i = 1; i &lt;= NR; i++ )print name[i]}' db</span>
   <span class="docEmphasis">Tom</span>



   <span class="docEmphasis">Tom</span>
   <span class="docEmphasis">Tom</span>

   <span class="docEmphasis">Tommy</span>

(The Command Line, Special <span class="docEmphasis">for</span> Loop)
2  % <span class="docEmphStrong">nawk '/^Tom/{name[NR]=$1};\</span>
     <span class="docEmphStrong">END{for(i in name){print name[i]}}' db</span>
   <span class="docEmphasis">Tom</span>
   <span class="docEmphasis">Tommy</span>
   <span class="docEmphasis">Tom</span>
   <span class="docEmphasis">Tom</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If the regular expression <span class="docEmphasis">Tom</span> 
      is matched against an input line, the <span class="docEmphasis">name</span> 
      array is assigned a value. Since the subscript used is
      <span class="docEmphasis">NR,</span> the number of the current record, the 
      subscripts in the array will not be in numeric order. Therefore, when 
      printing the array with the traditional <span class="docEmphasis">for</span> 
      loop, there will be null values printed where an array element has no 
      value.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The special <span class="docEmphasis">for</span> loop 
      iterates through the array, printing only values where there was a 
      subscript associated with that value. The order of the printout is random 
      because of the way the associative arrays are stored (hashed).</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><b>Using Strings as Array Subscripts.</b> A subscript may 
consist of a variable containing a string or literal string. If the string is a 
literal, it must be enclosed in double quotes.</p>
<h5 id="ch07list51" class="docExampleTitle">Example 7.51 </h5>
<pre>(The Input File)
% <span class="docEmphStrong">cat datafile3</span>
<span class="docEmphasis">tom</span>
<span class="docEmphasis">mary</span>
<span class="docEmphasis">sean</span>
<span class="docEmphasis">tom</span>
<span class="docEmphasis">mary</span>
<span class="docEmphasis">mary</span>
<span class="docEmphasis">bob</span>
<span class="docEmphasis">mary</span>
<span class="docEmphasis">alex</span>

(The Script)
    <span class="docEmphasis"># awk.sc script</span>
1   <span class="docEmphStrong">/tom/ { count[&quot;tom&quot;]++ }</span>
2   <span class="docEmphStrong">/mary/ { count[&quot;mary&quot;]++ }</span>
3   END{print &quot;There are &quot; <span class="docEmphStrong">count[&quot;tom&quot;]</span> &quot; Toms in the file and
       &quot; <span class="docEmphStrong">count[&quot;mary&quot;]</span>&quot; Marys in the file.&quot;}
(The Command Line)
   % <span class="docEmphStrong">nawk -f awk.sc datafile3</span>
   <span class="docEmphasis">There are 2 Toms in the file and 4 Marys in the file.</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">An array called <span class="docEmphasis">count</span> 
      consists of two elements, <span class="docEmphasis">count[&quot;tom&quot;]</span> 
      and <span class="docEmphasis">count[&quot;mary&quot;].</span> The initial value of 
      each of the array elements is zero. Every time <span class="docEmphasis">
      tom</span> is matched, the value of the array is incremented by one.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The same procedure applies to <span class="docEmphasis">
      count[&quot;mary&quot;].</span> Note: Only one <span class="docEmphasis">tom</span> 
      is recorded for each line, even if there are multiple occurrences on the 
      line.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">END</span> pattern prints 
      the value stored in each of the array elements.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><b>Using Field Values as Array Subscripts.</b> Any expression 
can be used as a subscript in an array. Therefore, fields can be used. The 
program in <a class="docLink" href="#ch07list52">Example 7.52</a> counts the 
frequency of all names appearing in the second field and introduces a new form 
of the <span class="docEmphasis">for</span> loop.</p>
<h5 id="ch07list52" class="docExampleTitle">Example 7.52 </h5>
<pre>(The Input File)
% <span class="docEmphStrong">cat datafile4</span>
<span class="docEmphasis">4234  Tom    43</span>
<span class="docEmphasis">4567  Arch   45</span>
<span class="docEmphasis">2008  Eliza  65</span>
<span class="docEmphasis">4571  Tom    22</span>
<span class="docEmphasis">3298  Eliza  21</span>
<span class="docEmphasis">4622  Tom    53</span>
<span class="docEmphasis">2345  Mary   24</span>

(The Command Line)
% <span class="docEmphStrong">nawk '{count[$2]++}END{for(name in count)print name,count[name] }'\</span>
  <span class="docEmphStrong">datafile4</span>
<span class="docEmphasis">Tom 3</span>
<span class="docEmphasis">Arch 1</span>
<span class="docEmphasis">Eliza 2</span>
<span class="docEmphasis">Mary 1</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">awk</span> statement first 
    will use the second field as an index in the <span class="docEmphasis">count</span> 
    array. The index varies as the second field varies, thus the first index in 
    the <span class="docEmphasis">count</span> array is
    <span class="docEmphasis">Tom</span> and the value stored in
    <span class="docEmphasis">count[&quot;Tom&quot;]</span> is one.</p>
    <p class="docText">Next, <span class="docEmphasis">count[&quot;Arch&quot;]</span> is 
    set to one, <span class="docEmphasis">count[&quot;Eliza&quot;]</span> to one, and
    <span class="docEmphasis">count[&quot;Mary&quot;</span>] to one. When
    <span class="docEmphasis">awk</span> finds the next occurrence of
    <span class="docEmphasis">Tom</span> in the second field,
    <span class="docEmphasis">count[&quot;Tom&quot;]</span> is incremented, now containing 
    the value <span class="docEmphasis">2.</span> The same thing happens for 
    each occurrence of <span class="docEmphasis">Arch,</span>
    <span class="docEmphasis">Eliza,</span> and <span class="docEmphasis">Mary.</span></td>
  </tr>
</table>
<center>
<h5 id="ch07fig01" class="docFigureTitle">Figure 7.1. Using strings as subscripts in an array (<a class="docLink" href="#ch07list51">Example 
7.51</a>).</h5>
<p class="docText">
<img alt="graphics/07fig01.gif" src="07fig01.gif" border="0" width="500" height="90"></p>
</center>
<pre>for( index_value in array ) statement
</pre>
<p class="docText">The <span class="docEmphasis">for</span> loop found in the
<span class="docEmphasis">END</span> block of the previous example works as 
follows: The variable <span class="docEmphasis">name</span> is set to the index 
value of the <span class="docEmphasis">count</span> array. After each iteration 
of the <span class="docEmphasis">for</span> loop, the <span class="docEmphasis">
print</span> action is performed, first printing the <span class="docEmphasis">
value of the index,</span> and then the <span class="docEmphasis">value stored</span> 
in that element. <span class="docEmphasis">(The order of the printout is not 
guaranteed.)</span></p>
<h5 id="ch07list53" class="docExampleTitle">Example 7.53 </h5>
<pre>(The Input File)
% <span class="docEmphStrong">cat datafile4</span>
<span class="docEmphasis">4234  Tom    43</span>
<span class="docEmphasis">4567  Arch   45</span>
<span class="docEmphasis">2008  Eliza  65</span>
<span class="docEmphasis">4571  Tom    22</span>
<span class="docEmphasis">3298  Eliza  21</span>
<span class="docEmphasis">4622  Tom    53</span>
<span class="docEmphasis">2345  Mary   24</span>

(The Command Line)
% <span class="docEmphStrong">nawk  '{dup[$2]++; if (dup[$2] &gt; 1){name[$2]++ }}\</span>
  <span class="docEmphStrong">END{print &quot;The duplicates were&quot;\</span>
  <span class="docEmphStrong">for (i in name){print i, name[i]}}' datafile4</span>

(The Output)
<span class="docEmphasis">Tom 2</span>
<span class="docEmphasis">Eliza 2</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The subscript for the <span class="docEmphasis">dup</span> 
    array is the value in the second field, that is, the name of a person. The 
    value stored there is initially zero, and it is incremented by one each time 
    a new record is processed. If the name is a duplicate, the value stored for 
    that subscript will go up to two, and so forth. If the value in the
    <span class="docEmphasis">dup</span> array is greater than one, a new array 
    called <span class="docEmphasis">name</span> also uses the second field as a 
    subscript and keeps track of the number of names greater than one.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">Arrays and the
<span class="docEmphasis">split</span> Function.</span>
<span class="docEmphasis">Awk</span>'s built-in <span class="docEmphasis">split</span> 
function allows you to split a string into words and store them in an array. You 
can define the field separator or use the value currently stored in
<span class="docEmphasis">FS.</span></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>split(string, array, field separator)
split (string, array)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list54" class="docExampleTitle">Example 7.54 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">nawk BEGIN{ split( &quot;3/15/2001&quot;, date, &quot;/&quot;);\</span>
  <span class="docEmphStrong">print &quot;The month is &quot; date[1] &quot;and the year is &quot;date[3]&quot;} \</span>
  <span class="docEmphStrong">filename</span>

(The Output)
<span class="docEmphasis">The month is 3 and the year is 2001.</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The string <span class="docEmphasis">3/15/2001</span> is 
    stored in the array <span class="docEmphasis">date,</span> using the forward 
    slash as the field separator. Now <span class="docEmphasis">date[1]</span> 
    contains <span class="docEmphasis">3,</span> <span class="docEmphasis">
    date[2]</span> contains <span class="docEmphasis">15,</span> and
    <span class="docEmphasis">date[3]</span> contains <span class="docEmphasis">
    2001.</span> The field separator is specified in the third argument; if not 
    specified, the value of <span class="docEmphasis">FS</span> is used as the 
    separator.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
delete</span> Function.</span> The <span class="docEmphasis">delete</span> 
function removes an array element.</p>
<h5 id="ch07list55" class="docExampleTitle">Example 7.55 </h5>
<pre>% <span class="docEmphStrong">nawk '{line[x++]=$2}END{for(x in line) delete(line[x])}'\</span>
  <span class="docEmphStrong">filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The value assigned to the array <span class="docEmphasis">
    line</span> is the value of the second field. After all the records have 
    been processed, the special <span class="docEmphasis">for</span> loop will 
    go through each element of the array, and the <span class="docEmphasis">
    delete</span> function will in turn remove each element.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">Multidimensional Arrays
<span class="docEmphasis">(nawk)</span>.</span> Although
<span class="docEmphasis">awk</span> does not officially support 
multidimensional arrays, a syntax is provided that gives the appearance of a 
multidimensional array. This is done by concatenating the indices into a string 
separated by the value of a special built-in variable, <span class="docEmphasis">
SUBSEP.</span> The <span class="docEmphasis">SUBSEP</span> variable contains the 
value <span class="docEmphasis">&quot;\034,&quot;</span> an unprintable character that is 
so unusual that it is unlikely to be found as an index character. The expression
<span class="docEmphasis">matrix[2,8]</span> is really the array
<span class="docEmphasis">matrix[2 SUBSEP 8],</span> which evaluates to
<span class="docEmphasis">matrix[&quot;2\0348&quot;].</span> The index becomes a unique 
string for an associative array.</p>
<h5 id="ch07list56" class="docExampleTitle">Example 7.56 </h5>
<pre>(The Input File)
1 2 3 4 5
2 3 4 5 6
6 7 8 9 10

(The Script)
1   {nf=NF
2   for(x = 1; x &lt;= NF; x++ ){
3      <span class="docEmphStrong">matrix[NR, x] = $x</span>
       }
    }
4   END { for (x=1; x &lt;= NR; x++ ){
        for (y = 1; y &lt;= nf; y++ )
           <span class="docEmphStrong">printf &quot;%d &quot;, matrix[x,y]</span>
    printf&quot;\n&quot;
       }
    }

(The Output)
<span class="docEmphasis">1 2 3 4 5</span>
<span class="docEmphasis">2 3 4 5 6</span>
<span class="docEmphasis">6 7 8 9 10</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The variable <span class="docEmphasis">nf</span> is 
      assigned the value of <span class="docEmphasis">NF,</span> the number of 
      fields. (This program assumes a fixed number of five fields per record.)</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">for</span> loop is 
      entered, storing the number of each field on the line in the variable
      <span class="docEmphasis">x.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">matrix</span> array is a 
      two-dimensional array. The two indices, <span class="docEmphasis">NR</span> 
      (number of the current record) and <span class="docEmphasis">x,</span> are 
      assigned the value of each field.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">END</span> block, the 
      two <span class="docEmphasis">for</span> loops are used to iterate through 
      the <span class="docEmphasis">matrix</span> array, printing out the values 
      stored there. This example does nothing more than demonstrate that 
      multidimensional arrays can be simulated.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec25">7.9.2 Processing Command Arguments
<span class="docEmphasis">(nawk)</span></h4>
<p class="docText"><span class="docEmphStrong"><span class="docEmphasis">ARGV.</span></span> 
Command line arguments are available to <span class="docEmphasis">nawk</span> 
(the new version of <span class="docEmphasis">awk</span>) with the built-in 
array called <span class="docEmphasis">ARGV.</span> These arguments include the 
command <span class="docEmphasis">nawk,</span> but not any of the options passed 
to <span class="docEmphasis">nawk.</span> The index of the
<span class="docEmphasis">ARGV</span> array starts at zero. (This works only for
<span class="docEmphasis">nawk.</span>)</p>
<p class="docText"><span class="docEmphStrong"><span class="docEmphasis">ARGC.</span></span>
<span class="docEmphasis">ARGC</span> is a built-in variable that contains the 
number of command line arguments.</p>
<h5 id="ch07list57" class="docExampleTitle">Example 7.57 </h5>
<pre>(The Script)
<span class="docEmphasis"># This script is called argvs</span>
BEGIN{
    for  ( i=0; i &lt; <span class="docEmphStrong">ARGC;</span> i++ ){
        printf(&quot;argv[%d] is %s\n&quot;, i, <span class="docEmphStrong">ARGV[i])</span>
        }
    printf(&quot;The number of arguments, ARGC=%d\n&quot;, ARGC)
}

(The Output)
% <span class="docEmphStrong">nawk –f argvs datafile</span>
<span class="docEmphasis">argv[0] is nawk</span>
<span class="docEmphasis">argv[1] is datafile</span>
<span class="docEmphasis">The number of arguments, ARGC=2</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">In the <span class="docEmphasis">for</span> loop,
    <span class="docEmphasis">i</span> is set to zero, <span class="docEmphasis">
    i</span> is tested to see if it is less than the number of command line 
    arguments (<span class="docEmphasis">ARGC),</span> and the
    <span class="docEmphasis">printf</span> function displays each argument 
    encountered, in turn. When all of the arguments have been processed, the 
    last <span class="docEmphasis">printf</span> statement outputs the number of 
    arguments, <span class="docEmphasis">ARGC.</span> The example demonstrates 
    that <span class="docEmphasis">awk</span> does not count command line 
    options as arguments.</td>
  </tr>
</table>
<h5 id="ch07list58" class="docExampleTitle">Example 7.58 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">nawk –f argvs datafile &quot;Peter Pan&quot; 12</span>
<span class="docEmphasis">argv[0] is nawk</span>
<span class="docEmphasis">argv[1] is datafile</span>
<span class="docEmphasis">argv[2] is Peter Pan</span>
<span class="docEmphasis">argv[3] is 12</span>
<span class="docEmphasis">The number of arguments, ARGC=4</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">As in the last example, each of the arguments is printed. 
    The <span class="docEmphasis">nawk</span> command is considered the first 
    argument, whereas the <span class="docEmphasis">–f</span> option and script 
    name, <span class="docEmphasis">argvs,</span> are excluded.</td>
  </tr>
</table>
<h5 id="ch07list59" class="docExampleTitle">Example 7.59 </h5>
<pre>(The Datafile)
% <span class="docEmphStrong">cat datafile5</span>
<span class="docEmphasis">Tom Jones:123:03/14/56</span>
<span class="docEmphasis">Peter Pan:456:06/22/58</span>
<span class="docEmphasis">Joe Blow:145:12/12/78</span>
<span class="docEmphasis">Santa Ana:234:02/03/66</span>
<span class="docEmphasis">Ariel Jones:987:11/12/66</span>

(The Script)
% <span class="docEmphStrong">cat arging.sc</span>
<span class="docEmphasis"># This script is called arging.sc</span>
1   <span class="docEmphStrong">BEGIN{FS=&quot;:&quot;; name=ARGV[2]</span>
2      <span class="docEmphStrong">print &quot;ARGV[2] is &quot;ARGV[2]</span>
    <span class="docEmphStrong">}</span>
    <span class="docEmphStrong">$1  ~ name { print $0 }</span>

(The Command Line)
% <span class="docEmphStrong">nawk –f arging.sc datafile5 &quot;Peter Pan&quot;</span>
<span class="docEmphasis">ARGV[2] is Peter Pan</span>
<span class="docEmphasis">Peter Pan:456:06/22/58</span>
<span class="docEmphasis">nawk: can't open Peter Pan</span>
<span class="docEmphasis">input record number 5, file Peter Pan</span>
<span class="docEmphasis">source line number 2</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">BEGIN</span> block, 
      the variable <span class="docEmphasis">name</span> is assigned the value 
      of <span class="docEmphasis">ARGV[2],</span> <span class="docEmphasis">
      Peter Pan.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList"><span class="docEmphasis">Peter Pan</span> is printed, 
      but then <span class="docEmphasis">awk</span> tries to open
      <span class="docEmphasis">Peter Pan</span> as an input file after it has 
      processed and closed the <span class="docEmphasis">datafile.</span>
      <span class="docEmphasis">Awk</span> treats arguments as input files.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h5 id="ch07list60" class="docExampleTitle">Example 7.60 </h5>
<pre>(The Script)
% <span class="docEmphStrong">cat arging2.sc</span>
BEGIN{FS=&quot;:&quot;; name=ARGV[2]
   print &quot;ARGV[2] is &quot; ARGV[2]
   <span class="docEmphStrong">delete ARGV[2]</span>
}
$1  ~ name { print $0 }

(The Command Line)
% <span class="docEmphStrong">nawk –f arging2.sc datafile &quot;Peter Pan&quot;</span>
<span class="docEmphasis">ARGV[2] is Peter Pan</span>
<span class="docEmphasis">Peter Pan:456:06/22/58</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText"><span class="docEmphasis">Awk</span> treats the elements 
    of the <span class="docEmphasis">ARGV</span> array as input files; after an 
    argument is used, it is shifted to the left and the next one is processed, 
    until the <span class="docEmphasis">ARGV</span> array is empty. If the 
    argument is deleted immediately after it is used, it will not be processed 
    as the next input file.</td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec11">7.10 <span class="docEmphasis">awk</span> Built-In 
Functions</h3>
<h4 class="docSection2Title" id="ch07lev2sec26">7.10.1 String Functions</h4>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">sub</span> 
and <span class="docEmphasis">gsub</span> Functions.</span> The
<span class="docEmphasis">sub</span> function matches the regular expression for 
the largest and leftmost substring in the record, and then replaces that 
substring with the substitution string. If a target string is specified, the 
regular expression is matched for the largest and leftmost substring in the 
target string, and the substring is replaced with the substitution string. If a 
target string is not specified, the entire record is used.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>sub (regular expression, substitution string);
sub (regular expression, substitution string, target string)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list61" class="docExampleTitle">Example 7.61 </h5>
<pre>1  % <span class="docEmphStrong">nawk '{sub(/Mac/, &quot;MacIntosh&quot;); print}' filename</span>
2  % <span class="docEmphStrong">nawk '{sub(/Mac/, &quot;MacIntosh&quot;, $1); print}' filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The first time the regular expression
      <span class="docEmphasis">Mac</span> is matched in the record ($0), it 
      will be replaced with the string <span class="docEmphasis">MacIntosh.</span> 
      The replacement is made only on the first occurrence of a match on the 
      line. (See <span class="docEmphasis">gsub</span> for multiple 
      occurrences.)</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The first time the regular expression
      <span class="docEmphasis">Mac</span> is matched in the first field of the 
      record, it will be replaced with the string <span class="docEmphasis">
      MacIntosh.</span> The replacement is made only on the first occurrence of 
      a match on the line for the target string. The <span class="docEmphasis">
      gsub</span> function substitutes a regular expression with a string 
      globally, that is, for every occurrence where the regular expression is 
      matched in each record ($0).</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p>&nbsp;</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>gsub(regular expression, substitution string)
gsub(regular expression, substitution string, target string)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list62" class="docExampleTitle">Example 7.62 </h5>
<pre>1  % <span class="docEmphStrong">nawk '{ gsub(/CA/, &quot;California&quot;); print }' datafile</span>
2  % <span class="docEmphStrong">nawk '{ gsub(/[Tt]om/, &quot;Thomas&quot;, $1 ); print }' filename</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Everywhere the regular expression
      <span class="docEmphasis">CA</span> is found in the record ($0), it will 
      be replaced with the string <span class="docEmphasis">California.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Everywhere the regular expression
      <span class="docEmphasis">Tom</span> or <span class="docEmphasis">tom</span> 
      is found in the first field, it will be replaced with the string
      <span class="docEmphasis">Thomas.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
index</span> Function.</span> The <span class="docEmphasis">index</span> 
function returns the first position where a substring is found in a string. 
Offset starts at position 1.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>index(string, substring)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list63" class="docExampleTitle">Example 7.63 </h5>
<pre>% <span class="docEmphStrong">nawk '{ print index(&quot;hollow&quot;, &quot;low&quot;) }' filename</span>
<span class="docEmphasis">4</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The number returned is the <span class="docEmphasis">
    position</span> where the substring <span class="docEmphasis">low</span> is 
    found in <span class="docEmphasis">hollow,</span> with the offset starting 
    at one.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
length</span> Function.</span> The <span class="docEmphasis">length</span> 
function returns the number of characters in a string<span class="docEmphasis">.</span> 
Without an argument, the <span class="docEmphasis">length</span> function 
returns the number of characters in a record.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>length ( string )
length
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list64" class="docExampleTitle">Example 7.64 </h5>
<pre>% <span class="docEmphStrong">nawk '{ print length(&quot;hello&quot;) }' filename</span>
<span class="docEmphasis">5</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">length</span> function 
    returns the number of characters in the string <span class="docEmphasis">
    hello.</span></td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
substr</span> Function.</span> The <span class="docEmphasis">substr</span> 
function returns the substring of a string starting at a position where the 
first position is one. If the length of the substring is given, that part of the 
string is returned. If the specified length exceeds the actual string, the 
string is returned.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>substr(string, starting position)
substr(string, starting position, length of string)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list65" class="docExampleTitle">Example 7.65 </h5>
<pre>% <span class="docEmphStrong">nawk ' { print substr(&quot;Santa Claus&quot;, 7, 6 )} ' filename</span>
<span class="docEmphasis">Claus</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">In the string <span class="docEmphasis">Santa Claus,</span> 
    print the substring starting at position <span class="docEmphasis">7</span> 
    with a length of <span class="docEmphasis">6</span> characters.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
match</span> Function.</span> The <span class="docEmphasis">match</span> 
function returns the index where the regular expression is found in the string, 
or zero if not found. The <span class="docEmphasis">match</span> function sets 
the built-in variable <span class="docEmphasis">RSTART</span> to the starting 
position of the substring within the string, and <span class="docEmphasis">
RLENGTH</span> to the number of characters to the end of the substring. These 
variables can be used with the <span class="docEmphasis">substr</span> function 
to extract the pattern. (Works only with <span class="docEmphasis">nawk.</span>)</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>match(string, regular expression)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list66" class="docExampleTitle">Example 7.66 </h5>
<pre>% <span class="docEmphStrong">nawk 'END{start=match(&quot;Good ole USA&quot;, /[A–Z]+$/); print start}'\</span>
  <span class="docEmphStrong">filename</span>
<span class="docEmphasis">10</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The regular expression /[A–Z]+$/ says search for 
    consecutive uppercase letters at the end of the string. The substring
    <span class="docEmphasis">USA</span> is found starting at the tenth 
    character of the string <span class="docEmphasis">Good ole USA.</span> If 
    the string cannot be matched, <span class="docEmphasis">0</span> is 
    returned.</td>
  </tr>
</table>
<h5 id="ch07list67" class="docExampleTitle">Example 7.67 </h5>
<pre>1   % <span class="docEmphStrong">nawk 'END{start=match(&quot;Good ole USA&quot;, /[A–Z]+$/);\</span>
      print RSTART, RLENGTH}' filename
    <span class="docEmphasis">10 3</span>
2   % <span class="docEmphStrong">nawk 'BEGIN{ line=&quot;Good ole USA&quot;}; \</span>
      END{ match( line, /[A–Z]+$/);\
      print substr(line, RSTART,RLENGTH)}' filename
    <span class="docEmphasis">USA</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">RSTART</span> variable is 
      set by the <span class="docEmphasis">match</span> function to the starting 
      position of the regular expression matched. The <span class="docEmphasis">
      RLENGTH</span> variable is set to the length of the substring.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">substr</span> function is 
      used to find a substring in the variable <span class="docEmphasis">line,</span> 
      and uses the <span class="docEmphasis">RSTART</span> and
      <span class="docEmphasis">RLENGTH</span> values (set by the
      <span class="docEmphasis">match</span> function) as the beginning position 
      and length of the substring.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
split</span> Function.</span> The <span class="docEmphasis">split</span> 
function splits a string into an array using whatever field separator is 
designated as the third parameter. If the third parameter is not provided,
<span class="docEmphasis">awk</span> will use the current value of
<span class="docEmphasis">FS.</span></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>split (string, array, field separator)
split (string, array)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list68" class="docExampleTitle">Example 7.68 </h5>
<pre>% <span class="docEmphStrong">awk 'BEGIN{split(&quot;12/25/2001&quot;,date,&quot;/&quot;);print date[2]}' filename</span>
<span class="docEmphasis">25</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">split</span> function 
    splits the string <span class="docEmphasis">12/25/</span>2001 into an array, 
    called <span class="docEmphasis">date,</span> using the forward slash as the 
    separator. The array subscript starts at <span class="docEmphasis">1.</span> 
    The second element of the <span class="docEmphasis">date</span> array is 
    printed.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
sprintf</span> Function.</span> The <span class="docEmphasis">sprintf</span> 
function returns an expression in a specified format. It allows you to apply the 
format specifications of the <span class="docEmphasis">printf</span> function.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>variable=sprintf(&quot;string with format specifiers &quot;, expr1, expr2, \
... , expr2)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch07list69" class="docExampleTitle">Example 7.69 </h5>
<pre>% <span class="docEmphStrong">awk '{line = sprintf ( &quot;%–15s %6.2f &quot;, $1 , $3 );\</span>
  print line}'  filename
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The first and third fields are formatted according to the
    <span class="docEmphasis">printf</span> specifications (a left-justified,
    <span class="docEmphasis">15</span>-space string and a right-justified,
    <span class="docEmphasis">6</span>-character floating point number). The 
    result is assigned to the user-defined variable <span class="docEmphasis">
    line.</span> See &quot;<a class="docLink" href="#ch07lev2sec12">The 
    printf Function</a>&quot;.</td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec12">7.11 Built-In Arithmetic Functions</h3>
<p class="docText"><a class="docLink" href="#ch07table03">Table 7.3</a> lists 
the built-in arithmetic functions, where <span class="docEmphasis">x</span> and
<span class="docEmphasis">y</span> are arbitrary expressions.</p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch07table03" class="docTableTitle">Table 7.3. Arithmetic Functions</h5>
  </caption>
  <colgroup span="2" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">Name</span>
    </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Value Returned</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">atan2(x,y)</span>
    </td>
    <td class="docTableCell" vAlign="top">Arctangent of
    <span class="docEmphasis">y/x</span> in the range. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">cos(x)</span>
    </td>
    <td class="docTableCell" vAlign="top">Cosine of <span class="docEmphasis">x,</span> 
    with <span class="docEmphasis">x</span> in radians. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">exp(x)</span>
    </td>
    <td class="docTableCell" vAlign="top">Exponential function of
    <span class="docEmphasis">x, e.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">int(x)</span>
    </td>
    <td class="docTableCell" vAlign="top">Integer part of
    <span class="docEmphasis">x;</span> truncated toward 0 when
    <span class="docEmphasis">x</span> &gt; 0. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">log(x)</span>
    </td>
    <td class="docTableCell" vAlign="top">Natural (base
    <span class="docEmphasis">e</span>) logarithm of <span class="docEmphasis">
    x.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">rand( )</span>
    </td>
    <td class="docTableCell" vAlign="top">Random number
    <span class="docEmphasis">r,</span> where 0 &lt; <span class="docEmphasis">r</span> 
    &lt; 1. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sin(x)</span>
    </td>
    <td class="docTableCell" vAlign="top">Sine of <span class="docEmphasis">x,</span> 
    with <span class="docEmphasis">x</span> in radians. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sqrt(x)</span>
    </td>
    <td class="docTableCell" vAlign="top">Square root of
    <span class="docEmphasis">x.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">srand(x)</span>
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">x</span> is 
    a new seed for <span class="docEmphasis">rand( ).</span><sup class="docFootnote"><a class="docLink" href="#ch07tabfn01">[a]</a></sup>
    </td>
  </tr>
</table>
<blockquote>
  <p class="docFootnote"><sup><a name="ch07tabfn01">[a]</a></sup> From Alfred V. 
  Aho, Brian W. Kernighan, and Peter J. Weinberger, <i>The AWK Programming 
  Language</i> (Boston: Addison-Wesley, 1988).© 1988 Bell Telephone 
  Laboratories, Inc. Reprinted by permission of Pearson Education, Inc.</p>
</blockquote>
<h4 class="docSection2Title" id="ch07lev2sec27">7.11.1 Integer Function</h4>
<p class="docText">The <span class="docEmphasis">int</span> function truncates 
any digits to the right of the decimal point to create a whole number. There is 
no rounding off.</p>
<h5 id="ch07list70" class="docExampleTitle">Example 7.70 </h5>
<pre>1   % <span class="docEmphStrong">awk 'END{print 31/3}' filename</span>
    <span class="docEmphasis">10.3333</span>
2   % <span class="docEmphStrong">awk 'END{print int(31/3})' filename</span>
    <span class="docEmphasis">10</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">END</span> block, the 
      result of the division is to print a floating point number.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">END</span> block, the
      <span class="docEmphasis">int</span> function causes the result of the 
      division to be truncated at the decimal point. A whole number is 
      displayed.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec28">7.11.2 Random Number Generator</h4>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
rand</span> Function.</span> The <span class="docEmphasis">rand</span> function 
generates a pseudorandom floating point number greater than or equal to zero and 
less than one.</p>
<h5 id="ch07list71" class="docExampleTitle">Example 7.71 </h5>
<pre>% <span class="docEmphStrong">nawk '{print rand()}' filename</span>
<span class="docEmphasis">0.513871</span>
<span class="docEmphasis">0.175726</span>
<span class="docEmphasis">0.308634</span>

% <span class="docEmphStrong">nawk '{print rand()}' filename</span>
<span class="docEmphasis">0.513871</span>
<span class="docEmphasis">0.175726</span>
<span class="docEmphasis">0.308634</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Each time the program runs, the same set of numbers is 
    printed. The <span class="docEmphasis">srand</span> function can be used to 
    seed the <span class="docEmphasis">rand</span> function with a new starting 
    value. Otherwise, as in this example, the same sequence is repeated each 
    time <span class="docEmphasis">rand</span> is called.</td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">The <span class="docEmphasis">
srand</span> Function.</span> The <span class="docEmphasis">srand</span> 
function without an argument uses the time of day to generate the seed for the
<span class="docEmphasis">rand</span> function. <span class="docEmphasis">
Srand(x)</span> uses <span class="docEmphasis">x</span> as the seed. Normally,
<span class="docEmphasis">x</span> should vary during the run of the program.</p>
<h5 id="ch07list72" class="docExampleTitle">Example 7.72 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{srand()};{print rand()}' filename</span>
<span class="docEmphasis">0.508744</span>
<span class="docEmphasis">0.639485</span>
<span class="docEmphasis">0.657277</span>

% <span class="docEmphStrong">nawk 'BEGIN{srand()};{print rand()}' filename</span>
<span class="docEmphasis">0.133518</span>
<span class="docEmphasis">0.324747</span>
<span class="docEmphasis">0.691794</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">srand</span> function sets 
    a new seed for <span class="docEmphasis">rand.</span> The starting point is 
    the time of day. Each time <span class="docEmphasis">rand</span> is called, 
    a new sequence of numbers is printed.</td>
  </tr>
</table>
<h5 id="ch07list73" class="docExampleTitle">Example 7.73 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{srand()};{print 1 + int(rand() * 25)}' filename</span>
<span class="docEmphasis">6</span>
<span class="docEmphasis">24</span>
<span class="docEmphasis">14</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">srand</span> function sets 
    a new seed for <span class="docEmphasis">rand.</span> The starting point is 
    the time of day. The <span class="docEmphasis">rand</span> function selects 
    a random number between 0 and 25 and casts it to an integer value.</td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec13">7.12 User-Defined Functions
<span class="docEmphasis">(nawk)</span></h3>
<p class="docText">A user-defined function can be placed anywhere in the script 
that a pattern action rule can.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>function name ( parameter, parameter, parameter, ... ) {
   statements
   return expression
<span class="docEmphasis">(The return statement and expression are optional)</span>
}
</pre>
    </td>
  </tr>
</table>
<p class="docText">Variables are passed by value and are local to the function 
where they are used. Only copies of the variables are used. Arrays are passed by 
address or by reference, so array elements can be directly changed within the 
function. Any variable used within the function that has
<span class="docEmphasis">not</span> been passed in the parameter list is 
considered a global variable; that is, it is visible to the entire
<span class="docEmphasis">awk</span> program, and if changed in the function, is 
changed throughout the program. The only way to provide local variables within a 
function is to include them in the parameter list. Such parameters are usually 
placed at the end of the list. If there is not a formal parameter provided in 
the function call, the parameter is initially set to null. The return statement 
returns control and possibly a value to the caller.</p>
<h5 id="ch07list74" class="docExampleTitle">Example 7.74 </h5>
<pre>(The Command Line Display of <span class="docEmphasis">grades</span> File before Sort)
% <span class="docEmphStrong">cat  grades</span>
<span class="docEmphasis">44 55 66 22 77 99</span>
<span class="docEmphasis">100 22 77 99 33 66</span>
<span class="docEmphasis">55 66 100 99 88 45</span>

(The Script)
% <span class="docEmphStrong">cat sorter.sc</span>
    <span class="docEmphasis"># Script is called sorter</span>
    <span class="docEmphasis"># It sorts numbers in ascending order</span>
1   <span class="docEmphStrong">function sort ( scores, num_elements, temp, i, j )</span> {
        <span class="docEmphasis"># temp, i, and j will be local and private,</span>
        <span class="docEmphasis"># with an initial value of null.</span>
2       for( i = 2; i &lt;= num_elements ; ++i ) {
3          for ( j = i; scores [j–1] &gt; scores[j]; ––j ){
              temp = scores[j]
              scores[j] = scores[j–1]
              scores[j–1] = temp
           }
4       }
5   }
6   {for ( i = 1; i &lt;= NF; i++)
       grades[i]=$i
7   <span class="docEmphStrong">sort(grades, NF)</span>    <span class="docEmphasis"># Two arguments are passed</span>
8   for( j = 1; j &lt;= NF; ++j )
       printf( &quot;%d &quot;, grades[j] )
       printf(&quot;\n&quot;)
    }

(After the Sort)
% <span class="docEmphStrong">nawk –f sorter.sc grades</span>
<span class="docEmphasis">22 44 55 66 77 99</span>
<span class="docEmphasis">22 33 66 77 99 100</span>
<span class="docEmphasis">45 55 66 88 99 100</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The function called <span class="docEmphasis">sort</span> 
      is defined. The function can be defined anywhere in the script. All 
      variables, except those passed as parameters, are global in scope. If 
      changed in the function, they will be changed throughout the
      <span class="docEmphasis">awk</span> script. Arrays are passed by 
      reference. Five formal arguments are enclosed within the parentheses. The 
      array <span class="docEmphasis">scores</span> will be passed by reference, 
      so that if any of the elements of the array are modified within the 
      function, the original array will be modified. The variable
      <span class="docEmphasis">num_elements</span> is a local variable, a copy 
      of the original. The variables <span class="docEmphasis">temp, i,</span> 
      and <span class="docEmphasis">j</span> are local variables in the 
      function.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The outer <span class="docEmphasis">for</span> loop 
      will iterate through an array of numbers, as long as there are at least 
      two numbers to compare.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The inner <span class="docEmphasis">for</span> loop 
      will compare the current number with the previous number,
      <span class="docEmphasis">scores[j –1]</span>). If the previous array 
      element is larger than the current one, <span class="docEmphasis">temp</span> 
      will be assigned the value of the current array element, and the current 
      array element will be assigned the value of the previous element.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The outer loop block ends.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">This is the end of the function definition.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The first action block of the script starts here. The
      <span class="docEmphasis">for</span> loop iterates through each field of 
      the current record, creating an array of numbers.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">sort</span> function is 
      called, passing the array of numbers from the current record and the 
      number of fields in the current record.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">When the <span class="docEmphasis">sort</span> function 
      has completed, program control starts here. The <span class="docEmphasis">
      for</span> loop prints the elements in the sorted array.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec14">7.13 Review</h3>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list75" class="docExampleTitle">Example 7.75 </h5>
<pre>% <span class="docEmphStrong">nawk '{if ( $8 &gt; 15 ){ print $3 &quot; has a high rating&quot;}\</span>
  <span class="docEmphStrong">else print $3 &quot;---NOT A COMPETITOR---&quot;}' datafile</span>

<span class="docEmphasis">Joel---NOT A COMPETITOR---</span>
<span class="docEmphasis">Sharon has a high rating</span>
<span class="docEmphasis">Chris has a high rating</span>
<span class="docEmphasis">May---NOT A COMPETITOR---</span>
<span class="docEmphasis">Derek has a high rating</span>
<span class="docEmphasis">Susan has a high rating</span>
<span class="docEmphasis">TJ---NOT A COMPETITOR---</span>
<span class="docEmphasis">Val---NOT A COMPETITOR---</span>
<span class="docEmphasis">Sheri---NOT A COMPETITOR---</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">if</span> statement is an 
    action statement. If there is more than one statement following the 
    expression, it must be enclosed in curly braces. (Curly braces are not 
    required in this example, since there is only one statement following the 
    expression.) The expression reads—<span class="docEmphasis">if</span> the 
    eighth field is greater than <span class="docEmphasis">15,</span> print the 
    third field and the string <span class="docEmphasis">has a high rating;</span>
    <span class="docEmphasis">else</span> print the third field and
    <span class="docEmphasis">---NOT A COMPETITOR---.</span></td>
  </tr>
</table>
<h5 id="ch07list76" class="docExampleTitle">Example 7.76 </h5>
<pre>% <span class="docEmphStrong">nawk '{i=1; while(i&lt;=NF &amp;&amp; NR &lt; 2){print $i; i++}}' datafile</span>
<span class="docEmphasis">northwest</span>
<span class="docEmphasis">NW</span>
<span class="docEmphasis">Joel</span>
<span class="docEmphasis">Craig</span>
<span class="docEmphasis">3.0</span>
<span class="docEmphasis">.98</span>
<span class="docEmphasis">3</span>
<span class="docEmphasis">4</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The user-defined variable <span class="docEmphasis">i</span> 
    is assigned <span class="docEmphasis">1.</span> The
    <span class="docEmphasis">while</span> loop is entered and the expression 
    tested. If the expression evaluates true, the <span class="docEmphasis">
    print</span> statement is executed; the value of the
    <span class="docEmphasis">i</span>th field is printed. The value of
    <span class="docEmphasis">i</span> is printed, next the value is incremented 
    by <span class="docEmphasis">1,</span> and the loop is reentered. The loop 
    expression will become false when the value of <span class="docEmphasis">i</span> 
    is greater than <span class="docEmphasis">NF</span> and the value of
    <span class="docEmphasis">NR</span> is two or more. The variable
    <span class="docEmphasis">i</span> will not be reinitialized until the next 
    record is entered.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list77" class="docExampleTitle">Example 7.77 </h5>
<pre>% <span class="docEmphStrong">nawk '{ for( i=3 ; i &lt;= NF &amp;&amp; NR == 3 ; i++ ){ print $i }}' datafile</span>
<span class="docEmphasis">Chris</span>
<span class="docEmphasis">Foster</span>
<span class="docEmphasis">2.7</span>
<span class="docEmphasis">.8</span>
<span class="docEmphasis">2</span>
<span class="docEmphasis">18</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">This is similar to the <span class="docEmphasis">while</span> 
    loop in functionality. The initialization, test, and loop control statements 
    are all in one expression. The value of <span class="docEmphasis">i (i = 3)</span> 
    is initialized once for the current record. The expression is then tested. 
    If <span class="docEmphasis">i</span> is less than or equal to
    <span class="docEmphasis">NF,</span> and <span class="docEmphasis">NR</span> 
    is equal to <span class="docEmphasis">3,</span> the
    <span class="docEmphasis">print</span> block is executed. After the value of 
    the <span class="docEmphasis">i</span>th field is printed, control is 
    returned to the loop expression. The value of <span class="docEmphasis">i</span> 
    is incremented and the test is repeated.</td>
  </tr>
</table>
<h5 id="ch07list78" class="docExampleTitle">Example 7.78 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">cat nawk.sc4</span>
<span class="docEmphasis"># Awk script illustrating arrays</span>
BEGIN{OFS=&quot;\t&quot;}
<span class="docEmphStrong">{ list[NR] = $1 }</span>   <span class="docEmphasis"># The array is called list. The index in the</span>
                    <span class="docEmphasis"># number of the current record. The value of the</span>
                    <span class="docEmphasis"># first field is assigned to the array element.</span>
END{ <span class="docEmphStrong">for( n = 1; n &lt;= NR; n++){</span>
         <span class="docEmphStrong">print list[n]}</span> <span class="docEmphasis"># for loop is used to loop</span>
                        <span class="docEmphasis"># through the array.</span>
}
(The Command Line)
% <span class="docEmphStrong">nawk -f nawk.sc4 datafile</span>
<span class="docEmphasis">northwest</span>
<span class="docEmphasis">western</span>
<span class="docEmphasis">southwest</span>
<span class="docEmphasis">southern</span>
<span class="docEmphasis">southeast</span>
<span class="docEmphasis">eastern</span>
<span class="docEmphasis">northeast</span>
<span class="docEmphasis">north</span>
<span class="docEmphasis">central</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The array, <span class="docEmphasis">list,</span> uses NR 
    as an index value. Each time a line of input is processed, the first field 
    is assigned to the <span class="docEmphasis">list</span> array. In the
    <span class="docEmphasis">END</span> block, the <span class="docEmphasis">
    for</span> loop iterates through each element of the array.</td>
  </tr>
</table>
<h5 id="ch07list79" class="docExampleTitle">Example 7.79 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">cat nawk.sc5</span>
<span class="docEmphasis"># Awk script with special for loop</span>
/north/{name[count++]=$3}
END{ print &quot;The number living in a northern district: &quot; count
     print &quot;Their names are: &quot;
     for ( i in name )       <span class="docEmphasis"># Special nawk for loop is used to</span>
           print name[i]     <span class="docEmphasis"># iterate through the array.</span>
}
% <span class="docEmphStrong">nawk -f nawk.sc5 datafile</span>
<span class="docEmphasis">The number living in a northern district: 3</span>
<span class="docEmphasis">Their names are:</span>
<span class="docEmphasis">Joel</span>
<span class="docEmphasis">TJ</span>
<span class="docEmphasis">Val</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Each time the regular expression
    <span class="docEmphasis">north</span> appears on the line, the
    <span class="docEmphasis">name</span> array is assigned the value of the 
    third field. The index <span class="docEmphasis">count</span> is incremented 
    each time a new record is processed, thus producing another element in the 
    array. In the <span class="docEmphasis">END</span> block, the special
    <span class="docEmphasis">for</span> loop is used to iterate through the 
    array.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list80" class="docExampleTitle">Example 7.80 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">cat nawk.sc6</span>
<span class="docEmphasis"># Awk and the special for loop</span>
{region[$1]++}   <span class="docEmphasis"># The index is the first field of each record</span>

END{for(item in region){
        print region[item], item
    }
}

% <span class="docEmphStrong">nawk -f nawk.sc6 datafile</span>
<span class="docEmphasis">1 central</span>
<span class="docEmphasis">1 northwest</span>
<span class="docEmphasis">1 western</span>
<span class="docEmphasis">1 southeast</span>
<span class="docEmphasis">1 north</span>
<span class="docEmphasis">1 southern</span>
<span class="docEmphasis">1 northeast</span>
<span class="docEmphasis">1 southwest</span>
<span class="docEmphasis">1 eastern</span>

% <span class="docEmphStrong">nawk -f nawk.sc6 datafile3</span>
<span class="docEmphasis">4 Mary</span>
<span class="docEmphasis">2 Tom</span>
<span class="docEmphasis">1 Alax</span>
<span class="docEmphasis">1 Bob</span>
<span class="docEmphasis">1 Sean</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">region</span> array uses 
    the first field as an index. The value stored is the number of times each 
    region was found. The <span class="docEmphasis">END</span> block uses the 
    special <span class="docEmphasis">awk for</span> loop to iterate through the 
    array called <span class="docEmphasis">region.</span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec15">UNIX TOOLS LAB EXERCISE</h3>
<h4 class="docSection2Title" id="ch07lev2sec29">Lab 6: <span class="docEmphasis">nawk</span> 
Exercise</h4>
<p class="docText">Mike Harrington:(510) 548-1278:250:100:175</p>
<p class="docText">Christian Dobbins:(408) 538-2358:155:90:201</p>
<p class="docText">Susan Dalsass:(206) 654-6279:250:60:50</p>
<p class="docText">Archie McNichol:(206) 548-1348:250:100:175</p>
<p class="docText">Jody Savage:(206) 548-1278:15:188:150</p>
<p class="docText">Guy Quigley:(916) 343-6410:250:100:175</p>
<p class="docText">Dan Savage:(406) 298-7744:450:300:275</p>
<p class="docText">Nancy McNeil:(206) 548-1278:250:80:75</p>
<p class="docText">John Goldenrod:(916) 348-4278:250:100:175</p>
<p class="docText">Chet Main:(510) 548-5258:50:95:135</p>
<p class="docText">Tom Savage:(408) 926-3456:250:168:200</p>
<p class="docText">Elizabeth Stachelin:(916) 440-1763:175:75:300</p>
<p class="docText">(Refer to the database called <span class="docEmphasis">
lab6.data</span> on the CD.)</p>
<p class="docText">The database above contains the names, phone numbers, and 
money contributions to the party campaign for the past three months.</p>
<p class="docText">1. Write a <tt>nawk</tt> script that will produce the 
following report:</p>
<pre>                      ***FIRST QUARTERLY REPORT***
                    ***CAMPAIGN 1998 CONTRIBUTIONS***
----------------------------------------------------------------------
   NAME                 PHONE     Jan  |  Feb  |  Mar  |  Total Donated
----------------------------------------------------------------------
Mike Harrington     (510) 548-1278  250.00  100.00  175.00   525.00
Christian Dobbins   (408) 538-2358  155.00   90.00  201.00   446.00
Susan Dalsass       (206) 654-6279  250.00   60.00   50.00   360.00
Archie McNichol     (206) 548-1348  250.00  100.00  175.00   525.00
Jody Savage         (206) 548-1278   15.00  188.00  150.00   353.00
Guy Quigley         (916) 343-6410  250.00  100.00  175.00   525.00
Dan Savage          (406) 298-7744  450.00  300.00  275.00  1025.00
Nancy McNeil        (206) 548-1278  250.00   80.00   75.00   405.00
John Goldenrod      (916) 348-4278  250.00  100.00  175.00   525.00
Chet Main           (510) 548-5258   50.00   95.00  135.00   280.00
Tom Savage          (408) 926-3456  250.00  168.00  200.00   618.00
Elizabeth Stachelin (916) 440-1763  175.00   75.00  300.00   550.00
----------------------------------------------------------------------
                                    SUMMARY
----------------------------------------------------------------------
The campaign received a total of $6137.00 for this quarter.
The average donation for the 12 contributors was $511.42.
The highest total contribution was $1025.00 made by Dan Savage.
                      ***THANKS Dan***
The following people donated over $500 to the campaign.
They are eligible for the quarterly drawing!!
Listed are their names (sorted by last names) and phone numbers:
   John Goldenrod--(916) 348-4278
   Mike Harrington--(510) 548-1278
   Archie McNichol--(206) 548-1348
   Guy Quigley--(916) 343-6410
   Dan Savage--(406) 298-7744
   Tom Savage--(408) 926-3456
   Elizabeth Stachelin--(916) 440-1763
      Thanks to all of you for your continued support!!</pre>

<h3 class="docSection1Title" id="ch07lev1sec16">7.14 Odds and Ends</h3>
<p class="docText">Some data (e.g., that read in from tape or from a 
spreadsheet) may not have obvious field separators but may instead have 
fixed-width columns. To preprocess this type of data, the
<span class="docEmphasis">substr</span> function is useful.</p>
<h4 class="docSection2Title" id="ch07lev2sec30">7.14.1 Fixed Fields</h4>
<p class="docText">In the following example, the fields are of a fixed width, 
but are not separated by a field separator. The <span class="docEmphasis">substr</span> 
function is used to create fields.</p>
<h5 id="ch07list81" class="docExampleTitle">Example 7.81 </h5>
<pre>% <span class="docEmphStrong">cat fixed</span>
<span class="docEmphasis">031291ax5633(408)987–0124</span>
<span class="docEmphasis">021589bg2435(415)866–1345</span>
<span class="docEmphasis">122490de1237(916)933–1234</span>
<span class="docEmphasis">010187ax3458(408)264–2546</span>
<span class="docEmphasis">092491bd9923(415)134–8900</span>
<span class="docEmphasis">112990bg4567(803)234–1456</span>
<span class="docEmphasis">070489qr3455(415)899–1426</span>

% <span class="docEmphStrong">nawk '{printf substr($0,1,6)&quot; &quot;;printf substr($0,7,6)&quot; &quot;;\</span>
  <span class="docEmphStrong">print substr($0,13,length)}' fixed</span>
<span class="docEmphasis">031291  ax5633  (408)987–0124</span>
<span class="docEmphasis">021589  bg2435  (415)866–1345</span>
<span class="docEmphasis">122490  de1237  (916)933–1234</span>
<span class="docEmphasis">010187  ax3458  (408)264–2546</span>
<span class="docEmphasis">092491  bd9923  (415)134–8900</span>
<span class="docEmphasis">112990  bg4567  (803)234–1456</span>
<span class="docEmphasis">070489  qr3455  (415)899–1426</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The first field is obtained by getting the substring of 
    the entire record, starting at the first character, offset by
    <span class="docEmphasis">6</span> places. Next, a space is printed. The 
    second field is obtained by getting the substring of the record, starting at 
    position <span class="docEmphasis">7,</span> offset by
    <span class="docEmphasis">6</span> places, followed by a space. The last 
    field is obtained by getting the substring of the entire record, starting at 
    position <span class="docEmphasis">13</span> to the position represented by 
    the length of the line. (The length function returns the length of the 
    current line, <span class="docEmphasis">$0,</span> if it does not have an 
    argument.)</td>
  </tr>
</table>
<p class="docText"><b>Empty Fields.</b> If the data is stored in fixed-width 
fields, it is possible that some of the fields are empty. In the following 
example, the <span class="docEmphasis">substr</span> function is used to 
preserve the fields, regardless of whether they contain data.</p>
<h5 id="ch07list82" class="docExampleTitle">Example 7.82 </h5>
<pre>1   % <span class="docEmphStrong">cat db</span>
    <span class="docEmphasis">xxx xxx</span>
    <span class="docEmphasis">xxx abc xxx</span>
    <span class="docEmphasis">xxx a   bbb</span>
    <span class="docEmphasis">xxx     xx</span>

    % <span class="docEmphStrong">cat awkfix</span>
    <span class="docEmphasis"># Preserving empty fields. Field width is fixed.</span>
    {
2   f[1]=substr($0,1,3)
3   f[2]=substr($0,5,3)
4   f[3]=substr($0,9,3)
5   line=sprintf(&quot;%-4s%-4s%-4s\n&quot;, f[1],f[2], f[3])
6   print line
    }
    % <span class="docEmphStrong">nawk –f awkfix db</span>
    <span class="docEmphasis">xxx xxx</span>
    <span class="docEmphasis">xxx abc xxx</span>
    <span class="docEmphasis">xxx a   bbb</span>
    <span class="docEmphasis">xxx     xx</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The contents of the file <span class="docEmphasis">db</span> 
      are printed. There are empty fields in the file.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The first element of the <span class="docEmphasis">f</span> 
      array is assigned the substring of the record, starting at position
      <span class="docEmphasis">1</span> and offset by <span class="docEmphasis">
      3.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The second element of the <span class="docEmphasis">f</span> 
      array is assigned the substring of the record, starting at position
      <span class="docEmphasis">5</span> and offset by <span class="docEmphasis">
      3.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The third element of the <span class="docEmphasis">f</span> 
      array is assigned the substring of the record, starting at position
      <span class="docEmphasis">9</span> and offset by <span class="docEmphasis">
      3.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The elements of the array are assigned to the 
      user-defined variable <span class="docEmphasis">line</span> after being 
      formatted by the <span class="docEmphasis">sprintf</span> function.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The value of <span class="docEmphasis">line</span> is 
      printed and the empty fields are preserved.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<p class="docText"><span class="docEmphStrong">Numbers with
<span class="docEmphasis">$</span>, Commas, or Other Characters.</span> In the 
following example, the price field contains a dollar sign and comma. The script 
must eliminate these characters to add up the prices to get the total cost. This 
is done using the <span class="docEmphasis">gsub</span> function.</p>
<h5 id="ch07list83" class="docExampleTitle">Example 7.83 </h5>
<pre>% <span class="docEmphStrong">cat vendor</span>
<span class="docEmphasis">access tech:gp237221:220:vax789:20/20:11/01/90:$1,043.00</span>
<span class="docEmphasis">alisa systems:bp262292:280:macintosh:new updates:06/30/91:$456.00</span>
<span class="docEmphasis">alisa systems:gp262345:260:vax8700:alisa talk:02/03/91:$1,598.50</span>
<span class="docEmphasis">apple computer:zx342567:240:macs:e–mail:06/25/90:$575.75</span>
<span class="docEmphasis">caci:gp262313:280:sparc station:network11.5:05/12/91:$1,250.75</span>
<span class="docEmphasis">datalogics:bp132455:260:microvax2:pagestation maint:07/01/90:$1,200.00</span>
<span class="docEmphasis">dec:zx354612:220:microvax2:vms sms:07/20/90:$1,350.00</span>

% <span class="docEmphStrong">nawk –F: '{gsub(/\$/,&quot;&quot;);gsub(/,/,&quot;&quot;); cost +=$7};\</span>

<span class="docEmphStrong">END{print &quot;The total is $&quot; cost}' vendor</span>
<span class="docEmphasis">$7474</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The first <span class="docEmphasis">gsub</span> function 
    globally substitutes the literal dollar sign (<span class="docEmphasis">\$</span>) 
    with the null string, and the second <span class="docEmphasis">gsub</span> 
    function substitutes commas with a null string. The user-defined
    <span class="docEmphasis">cost</span> variable is then totalled by adding 
    the seventh field to <span class="docEmphasis">cost</span> and assigning the 
    result back to <span class="docEmphasis">cost.</span> In the
    <span class="docEmphasis">END</span> block, the string
    <span class="docEmphasis">The total cost is $</span> is printed, followed by 
    the value of <span class="docEmphasis">cost.</span><span id="ENB7-1"><a class="docLink" href="#EN7-1"><sup>[1]</sup></a></span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec31">7.14.2 Bundling and Unbundling Files</h4>
<p class="docText"><b>The Bundle Program.</b> In <i>The AWK Programming Language</i>, 
the program to bundle files together is very short and to the point. We are 
trying to combine several files into one file to save disk space, to send files 
through electronic mail, and so forth. The following <span class="docEmphasis">
awk</span> command will print every line of each file, preceded with the 
filename.</p>
<h5 id="ch07list84" class="docExampleTitle">Example 7.84 </h5>
<pre>% <span class="docEmphStrong">nawk '{ print FILENAME, $0 }' file1 file2 file3 &gt; bundled</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The name of the current input file,
    <span class="docEmphasis">FILENAME,</span> is printed, followed by the 
    record (<span class="docEmphasis">$0</span>) for each line of input in
    <span class="docEmphasis">file1.</span> After <span class="docEmphasis">
    file1</span> has reached the end of file, <span class="docEmphasis">awk</span> 
    will open the next file, <span class="docEmphasis">file2,</span> and do the 
    same thing, and so on. The output is redirected to a file called
    <span class="docEmphasis">bundled.</span></td>
  </tr>
</table>
<p class="docText"><b>Unbundle.</b> The following example displays how to 
unbundle files, or put them back into separate files.</p>
<h5 id="ch07list85" class="docExampleTitle">Example 7.85 </h5>
<pre>%  <span class="docEmphStrong">nawk '$1 != previous { close(previous); previous=$1};\</span>
   <span class="docEmphStrong">{print substr($0, index($0, &quot; &quot;) + 1) &gt; $1}' bundled</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The first field is the name of the file. If the name of 
    the file is not equal to the value of the user-defined variable
    <span class="docEmphasis">previous</span> (initially null), the action block 
    is executed. The file assigned to <span class="docEmphasis">previous</span> 
    is closed, and <span class="docEmphasis">previous</span> is assigned the 
    value of the first field. Then the <span class="docEmphasis">substr</span> 
    of the record, the starting position returned from the index function (the 
    position of the first space + 1), is redirected to the filename contained in 
    the first field.</p>
    <p class="docText">To bundle the files so that the filename appears on a 
    line by itself, above the contents of the file use, the following command:</p>
    <pre><span class="docEmphStrong">% nawk '{if(FNR==1){print FILENAME;print $0}\</span>
  <span class="docEmphStrong">else print $0}'  file1 file2 file3 &gt; bundled</span>
</pre>
    <p class="docText">The following command will unbundle the files:</p>
    <pre><span class="docEmphStrong">% nawk 'NF==1{filename=$NF} ;\</span>
  <span class="docEmphStrong">NF != 1{print $0 &gt; filename}' bundled</span>
</pre>
    </td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec32">7.14.3 Multiline Records</h4>
<p class="docText">In the sample data files used so far, each record is on a 
line by itself. In the following sample datafile, called
<span class="docEmphasis">checkbook,</span> the records are separated by blank 
lines and the fields are separated by newlines. To process this file, the record 
separator (<span class="docEmphasis">RS</span>) is assigned a value of null, and 
the field separator (<span class="docEmphasis">FS</span>) is assigned the 
newline.</p>
<h5 id="ch07list86" class="docExampleTitle">Example 7.86 </h5>
<pre>(The Input File)
% <span class="docEmphStrong">cat checkbook</span>
<span class="docEmphasis">1/1/01</span>
<span class="docEmphasis">#125</span>
<span class="docEmphasis">–695.00</span>
<span class="docEmphasis">Mortgage</span>

<span class="docEmphasis">1/1/01</span>
<span class="docEmphasis">#126</span>
<span class="docEmphasis">–56.89</span>
<span class="docEmphasis">PG&amp;E</span>
<span class="docEmphasis">1/2/01</span>
<span class="docEmphasis">#127</span>
<span class="docEmphasis">–89.99</span>
<span class="docEmphasis">Safeway</span>

<span class="docEmphasis">1/3/01</span>
<span class="docEmphasis">+750.00</span>
<span class="docEmphasis">Pay Check</span>

<span class="docEmphasis">1/4/01</span>
<span class="docEmphasis">#128</span>
<span class="docEmphasis">–60.00</span>
<span class="docEmphasis">Visa</span>

(The Script)
   % <span class="docEmphStrong">cat awkchecker</span>
1  BEGIN{RS=&quot;&quot;; FS=&quot;\n&quot;;ORS=&quot;\n\n&quot;}
2  {print  NR, $1,$2,$3,$4}

(The Output)
% <span class="docEmphStrong">nawk –f awkchecker checkbook</span>
<span class="docEmphasis">1 1/1/01  #125  –695.00  Mortgage</span>

<span class="docEmphasis">2 1/1/01  #126  –56.89  PG&amp;E</span>

<span class="docEmphasis">3 1/2/01  #127  –89.99  Safeway</span>

<span class="docEmphasis">4 1/3/01  +750.00  Pay Check</span>

<span class="docEmphasis">5 1/4/01  #128  –60.00  Visa</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">BEGIN</span> block, 
      the record separator (<span class="docEmphasis">RS</span>) is assigned 
      null, the field separator (<span class="docEmphasis">FS</span>) is 
      assigned a newline, and the output record separator (<span class="docEmphasis">ORS</span>) 
      is assigned two newlines. Now each line is a field and each output record 
      is separated by two newlines.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The number of the record is printed, followed by each 
      of the fields.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec33">7.14.4 Generating Form Letters</h4>
<p class="docText">The following example is modified from a program in <i>The 
AWK Programming Language</i>.<span id="ENB7-2"><a class="docLink" href="#EN7-2"><sup>[2]</sup></a></span> 
The tricky part of this is keeping track of what is actually being processed. 
The input file is called <span class="docEmphasis">data.form.</span> It contains 
just the data. Each field in the input file is separated by colons. The other 
file is called <span class="docEmphasis">form.letter.</span> It is the actual 
form that will be used to create the letter. This file is loaded into
<span class="docEmphasis">awk</span>'s memory with the <span class="docEmphasis">
getline</span> function. Each line of the form letter is stored in an array. The 
program gets its data from <span class="docEmphasis">data.form,</span> and the 
letter is created by substituting real data for the special strings preceded by
<span class="docEmphasis">#</span> and <span class="docEmphasis">@</span> found 
in <span class="docEmphasis">form.letter.</span> A temporary variable,
<span class="docEmphasis">temp,</span> holds the actual line that will be 
displayed after the data has been substituted. This program allows you to create 
personalized form letters for each person listed in <span class="docEmphasis">
data.form.</span></p>
<h5 id="ch07list87" class="docExampleTitle">Example 7.87 </h5>
<pre>(The <span class="docEmphasis">Awk</span> Script)
% <span class="docEmphStrong">cat form.awk</span>
<span class="docEmphasis"># form.awk is an awk script that requires access to 2 files: The</span>
<span class="docEmphasis"># first file is called &quot;form.letter.&quot; This file contains the</span>
<span class="docEmphasis"># format for a form letter. The awk script uses another file,</span>
<span class="docEmphasis"># &quot;data.form,&quot; as its input file. This file contains the</span>
<span class="docEmphasis"># information that will be substituted into the form letters in</span>
<span class="docEmphasis"># the place of the numbers preceded by pound signs. Today's date</span>
<span class="docEmphasis"># is substituted in the place of &quot;@date&quot; in &quot;form.letter.&quot;</span>
1   BEGIN{ FS=&quot;:&quot;; n=1
2   while(<span class="docEmphStrong">getline &lt; &quot;form.letter&quot; &gt;  0</span>)
3       <span class="docEmphStrong">form[n++] = $0</span>   <span class="docEmphasis"># Store lines from form.letter in an array</span>
4   &quot;date&quot; | getline d; split(d, today, &quot; &quot;)
        <span class="docEmphasis">#</span> <span class="docEmphasis">Output of date is Fri Mar 2 14:35:50</span>   <span class="docEmphasis">PST 2001</span>
5   thisday=today[2]&quot;. &quot;today[3]&quot;, &quot;today[6]
6   }
7   { for( i = 1; i &lt; n; i++ ){
8       <span class="docEmphStrong">temp=form[i]</span>
9       for ( j = 1; j &lt;=NF; j++ ){
           <span class="docEmphStrong">gsub(&quot;@date&quot;, thisday, temp)</span>
10         <span class="docEmphStrong">gsub(&quot;#&quot; j, $j , temp )</span>
        }
11  print temp
    }
    }

% <span class="docEmphStrong">cat form.letter</span>
   The <span class="docEmphStrong">form letter,</span> <span class="docEmphasis">form.letter,</span> looks like this:
*********************************************************
   Subject: Status Report for Project &quot;#1&quot;
   To: #2
   From: #3
   Date: @date
   This letter is to tell you, #2, that project &quot;#1&quot; is up to
   date.
   We expect that everything will be completed and ready for
   shipment as scheduled on #4.

   Sincerely,

   #3
**********************************************************
The file, <span class="docEmphasis">data.form,</span> is awk's <span class="docEmphStrong">input file</span> containing the data that will
replace the #1–4 and the @date in <span class="docEmphasis">form.letter.</span>

% <span class="docEmphStrong">cat data.form</span>
   Dynamo:John Stevens:Dana Smith, Mgr:4/12/2001
   Gallactius:Guy Sterling:Dana Smith, Mgr:5/18/2001

(The Command Line)

   % <span class="docEmphStrong">nawk  –f form.awk  data.form</span>
   *********************************************************
   <span class="docEmphasis">Subject: Status Report for Project &quot;Dynamo&quot;</span>
   <span class="docEmphasis">To: John Stevens</span>
   <span class="docEmphasis">From: Dana Smith, Mgr</span>
   <span class="docEmphasis">Date: Mar. 2, 2001</span>
   <span class="docEmphasis">This letter is to tell you, John Stevens, that project</span>
   <span class="docEmphasis">&quot;Dynamo&quot; is up to date.</span>
   <span class="docEmphasis">We expect that everything will be completed and ready for</span>
   <span class="docEmphasis">shipment as scheduled on 4/12/2001.</span>

   <span class="docEmphasis">Sincerely,</span>

   <span class="docEmphasis">Dana Smith, Mgr</span>
   <span class="docEmphasis">Subject: Status Report for Project &quot;Gallactius&quot;</span>
   <span class="docEmphasis">To: Guy Sterling</span>
   <span class="docEmphasis">From: Dana Smith, Mgr</span>
   <span class="docEmphasis">Date: Mar. 2, 2001</span>
   <span class="docEmphasis">This letter is to you, Guy Sterling, that project &quot;Gallactius&quot;</span>
   <span class="docEmphasis">is up to date.</span>
   <span class="docEmphasis">We expect that everything will be completed and ready for</span>
   <span class="docEmphasis">shipment as scheduled on 5/18/2001.</span>

   <span class="docEmphasis">Sincerely,</span>

   <span class="docEmphasis">Dana Smith, Mgr</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">BEGIN</span> block, 
      the field separator (<span class="docEmphasis">FS</span>) is assigned a 
      colon; a user-defined variable <span class="docEmphasis">n</span> is 
      assigned 1.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">while</span> loop, the
      <span class="docEmphasis">getline</span> function reads a line at a time 
      from the file called <span class="docEmphasis">form.letter.</span> If
      <span class="docEmphasis">getline</span> fails to find the file, it 
      returns a –1. When it reaches the end of file, it returns zero. Therefore, 
      by testing for a return value of greater than one, we know that the 
      function has read in a line from the input file.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Each line from <span class="docEmphasis">form.letter</span> 
      is assigned to an array called <span class="docEmphasis">form.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The output from the UNIX <span class="docEmphasis">date</span> 
      command is piped to the <span class="docEmphasis">getline</span> function 
      and assigned to the user-defined variable <span class="docEmphasis">d.</span> 
      The <span class="docEmphasis">split</span> function then splits up the 
      variable <span class="docEmphasis">d</span> with whitespace, creating an 
      array called <span class="docEmphasis">today.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The user-defined variable <span class="docEmphasis">
      thisday</span> is assigned the month, day, and year.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">BEGIN</span> block ends.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">for</span> loop will loop
      <span class="docEmphasis">n</span> times.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The user-defined variable <span class="docEmphasis">
      temp</span> is assigned a line from the <span class="docEmphasis">form</span> 
      array.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The nested <span class="docEmphasis">for</span> loop is 
      looping through a line from the input file, <span class="docEmphasis">
      data.form,</span> <span class="docEmphasis">NF</span> number of times. 
      Each line stored in the <span class="docEmphasis">temp</span> variable is 
      checked for the string <span class="docEmphasis">@date.</span> If
      <span class="docEmphasis">@date</span> is matched, the
      <span class="docEmphasis">gsub</span> function replaces it with today's 
      date (the value stored in <span class="docEmphasis">this day</span>).</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">If a <span class="docEmphasis">#</span> and a number 
      are found in the line stored in <span class="docEmphasis">temp,</span> the
      <span class="docEmphasis">gsub</span> function will replace the
      <span class="docEmphasis">#</span> and number with the value of the 
      corresponding field in the input file, <span class="docEmphasis">data.form.</span> 
      For example, if the first line stored is being tested,
      <span class="docEmphasis">#1</span> would be replaced with
      <span class="docEmphasis">Dynamo,</span> <span class="docEmphasis">#2</span> 
      with <span class="docEmphasis">John Stevens,</span>
      <span class="docEmphasis">#3</span> with <span class="docEmphasis">Dana 
      Smith,</span> <span class="docEmphasis">#4</span> with
      <span class="docEmphasis">4/12/2001,</span> and so forth<span class="docEmphasis">.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The line stored in <span class="docEmphasis">temp</span> 
      is printed after the substitutions.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec34">7.14.5 Interaction with the Shell</h4>
<p class="docText">Now that you have seen how <span class="docEmphasis">awk</span> 
works, you will find that <span class="docEmphasis">awk</span> is a very 
powerful utility when writing shell scripts. You can embed one-line
<span class="docEmphasis">awk</span> commands or <span class="docEmphasis">awk</span> 
scripts within your shell scripts. The following is a sample of a Korn shell 
program embedded with <span class="docEmphasis">awk</span> commands.</p>
<h5 id="ch07list88" class="docExampleTitle">Example 7.88 </h5>
<pre>!#/bin/ksh
<span class="docEmphasis"># This korn shell script will collect data for awk to use in</span>
<span class="docEmphasis"># generating form letter(s). See above.</span>
print &quot;Hello $LOGNAME. &quot;
print &quot;This report is for the month and year:&quot;
1   <span class="docEmphStrong">cal | nawk 'NR==1{print $0}'</span>

    if [[ –f data.form  || –f formletter? ]]
    then
       rm data.form formletter?  2&gt; /dev/null
    fi
    integer num=1
    while true
    do
       print &quot;Form letter #$num:&quot;
       read project?&quot;What is the name of the project? &quot;
       read sender?&quot;Who is the status report from? &quot;
       read recipient?&quot;Who is the status report to? &quot;
       read due_date?&quot;What is the completion date scheduled? &quot;
       echo $project:$recipient:$sender:$due_date &gt; data.form
       print –n &quot;Do you wish to generate another form letter? &quot;
       read answer
       if [[ &quot;$answer&quot; != [Yy]* ]]
       then
              break
       else
2             <span class="docEmphStrong">nawk –f form.awk  data.form  &gt; formletter$num</span>
       fi
       (( num+=1 ))
    done
    <span class="docEmphStrong">nawk –f form.awk data.form &gt; formletter$num</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The UNIX <span class="docEmphasis">cal</span> command 
      is piped to <span class="docEmphasis">awk.</span> The first line that 
      contains the current month and year is printed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">nawk</span> script
      <span class="docEmphasis">form.awk</span> generates form letters, which 
      are redirected to a UNIX file.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec17">7.15 Review</h3>
<h4 class="docSection2Title" id="ch07lev2sec35">7.15.1 String Functions</h4>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list89" class="docExampleTitle">Example 7.89 </h5>
<pre>% <span class="docEmphStrong">nawk 'NR==1{gsub(/northwest/,&quot;southeast&quot;, $1) ;print}' datafile</span>
southeast     NW     Joel Craig         3.0  .98  3   4
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If this is the first record <span class="docEmphasis">(NR 
    == 1),</span> <span class="docEmphStrong">globally substitute</span> the 
    regular expression <span class="docEmphasis">northwest</span> with
    <span class="docEmphasis">southeast,</span> if <span class="docEmphasis">
    northwest</span> is found in the first field.</td>
  </tr>
</table>
<h5 id="ch07list90" class="docExampleTitle">Example 7.90 </h5>
<pre>% <span class="docEmphStrong">nawk 'NR==1{print substr($3, 1, 3)}' datafile</span>
<span class="docEmphasis">Joe</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If this is the first record, display the
    <span class="docEmphStrong">substring</span> of the third field, starting at 
    the first character, and extracting a length of <span class="docEmphasis">3</span> 
    characters. The substring <span class="docEmphasis">Joe</span> is printed.</td>
  </tr>
</table>
<h5 id="ch07list91" class="docExampleTitle">Example 7.91 </h5>
<pre>% <span class="docEmphStrong">nawk 'NR==1{print length($1)}' datafile</span>
<span class="docEmphasis">9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If this is the first record, the
    <span class="docEmphStrong">length</span> (number of characters) in the 
    first field is printed.</td>
  </tr>
</table>
<h5 id="ch07list92" class="docExampleTitle">Example 7.92 </h5>
<pre>% <span class="docEmphStrong">nawk 'NR==1{print index($1,&quot;west&quot;)}' datafile</span>
<span class="docEmphasis">6</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If this is the first record, print the first position 
    where the substring <span class="docEmphasis">west</span> is found in the 
    first field. The string <span class="docEmphasis">west</span> starts at the 
    sixth position (<span class="docEmphStrong">index</span>) in the string
    <span class="docEmphasis">northwest.</span></td>
  </tr>
</table>
<h5 id="ch07list93" class="docExampleTitle">Example 7.93 </h5>
<pre>% <span class="docEmphStrong">nawk '{if(match($1,/^no/)){print substr($1,RSTART,RLENGTH)}}'\</span>
  <span class="docEmphStrong">datafile</span>
<span class="docEmphasis">no</span>
<span class="docEmphasis">no</span>
<span class="docEmphasis">no</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the <span class="docEmphasis">match</span> function 
    finds the regular expression <span class="docEmphasis">/^no/</span> in the 
    first field, the index position of the leftmost character is returned. The 
    built-in variable <span class="docEmphasis">RSTART</span> is set to the 
    index position and the <span class="docEmphasis">RLENGTH</span> variable is 
    set to the length of the matched substring. The <span class="docEmphasis">
    substr</span> function returns the string in the first field starting at 
    position <span class="docEmphasis">RSTART,</span> <span class="docEmphasis">
    RLENGTH</span> number of characters.</td>
  </tr>
</table>
<h5 id="ch07list94" class="docExampleTitle">Example 7.94 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{split(&quot;10/14/01&quot;,now,&quot;/&quot;);print now[1],now[2],now[3]}'</span>
<span class="docEmphasis">10 14</span> 01
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The string <span class="docEmphasis">10/14/01</span> is
    <span class="docEmphStrong">split</span> into an array called
    <span class="docEmphasis">now.</span> The delimiter is the forward slash. 
    The elements of the array are printed, starting at the first element of the 
    array.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile2</span>
<span class="docEmphasis">Joel Craig:northwest:NW:3.0:.98:3:4</span>
<span class="docEmphasis">Sharon Kelly:western:WE:5.3:.97:5:23</span>
<span class="docEmphasis">Chris Foster:southwest:SW:2.7:.8:2:18</span>
<span class="docEmphasis">May Chin:southern:SO:5.1:.95:4:15</span>
<span class="docEmphasis">Derek Johnson:southeast:SE:4.0:.7:4:17</span>
<span class="docEmphasis">Susan Beal:eastern:EA:4.4:.84:5:20</span>
<span class="docEmphasis">TJ Nichols:northeast:NE:5.1:.94:3:13</span>
<span class="docEmphasis">Val Shultz:north:NO:4.5:.89:5:9</span>
<span class="docEmphasis">Sheri Watson:central:CT:5.7:.94:5:13</span>
</pre>
<h5 id="ch07list95" class="docExampleTitle">Example 7.95 </h5>
<pre>% <span class="docEmphStrong">nawk -F: '/north/{split($1, name, &quot; &quot;);\</span>
  <span class="docEmphStrong">print &quot;First name: &quot;name[1];\</span>
  <span class="docEmphStrong">print &quot;Last name: &quot; name[2];\</span>
  <span class="docEmphStrong">print &quot;\n--------------------&quot;}' datafile2</span>

<span class="docEmphasis">First name: Joel</span>
<span class="docEmphasis">Last name: Craig</span>
<span class="docEmphasis">--------------------</span>
<span class="docEmphasis">First name: TJ</span>
<span class="docEmphasis">Last name: Nichols</span>
<span class="docEmphasis">--------------------</span>
<span class="docEmphasis">First name: Val</span>
<span class="docEmphasis">last name: Shultz</span>
<span class="docEmphasis">--------------------</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The input field separator is set to a colon (<span class="docEmphasis">–F:</span>). 
    If the record contains the regular expression <span class="docEmphasis">
    north,</span> the first field is <span class="docEmphStrong">split</span> 
    into an array called <span class="docEmphasis">name,</span> where a space is 
    the delimiter. The elements of the array are printed.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h5 id="ch07list96" class="docExampleTitle">Example 7.96 </h5>
<pre>% <span class="docEmphStrong">nawk '{line=sprintf(&quot;%10.2f%5s\n&quot;,$7,$2); print line}' datafile</span>
<span class="docEmphasis">3.00   NW</span>
<span class="docEmphasis">5.00   WE</span>
<span class="docEmphasis">2.00   SW</span>
<span class="docEmphasis">4.00   SO</span>
<span class="docEmphasis">4.00   SE</span>
<span class="docEmphasis">5.00   EA</span>
<span class="docEmphasis">3.00   NE</span>
<span class="docEmphasis">5.00   NO</span>
<span class="docEmphasis">5.00   CT</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">sprintf</span> function 
    formats the seventh and the second fields (<span class="docEmphasis">$7,</span>
    <span class="docEmphasis">$2</span>) using the formatting conventions of the
    <span class="docEmphasis">printf</span> function. The formatted string is 
    returned and assigned to the user-defined variable <span class="docEmphasis">
    line</span> and printed.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec36">7.15.2 Command Line Arguments</h4>
<h5 id="ch07list97" class="docExampleTitle">Example 7.97 </h5>
<pre>% <span class="docEmphStrong">cat argvs.sc</span>
<span class="docEmphasis"># Testing command line arguments with ARGV and ARGC using a for loop.</span>

BEGIN{
    for(i=0;i &lt; ARGC;i++)
       printf(&quot;argv[%d] is %s\n&quot;, i, ARGV[i])
       printf(&quot;The number of arguments, ARGC=%d\n&quot;, ARGC)
}

% <span class="docEmphStrong">nawk -f argvs.sc datafile</span>
<span class="docEmphasis">argv[0] is nawk</span>
<span class="docEmphasis">argv[1] is datafile</span>
<span class="docEmphasis">The number of arguments, ARGC=2</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">BEGIN</span> block contains 
    a <span class="docEmphasis">for</span> loop to process the
    <span class="docEmphStrong">command line arguments.</span>
    <span class="docEmphasis">ARGC</span> is the number of arguments and
    <span class="docEmphasis">ARGV</span> is an array that contains the actual 
    arguments. <span class="docEmphasis">Nawk</span> does not count options as 
    arguments. The only valid arguments in this example are the
    <span class="docEmphasis">nawk</span> command and the input file, datafile.</td>
  </tr>
</table>
<h5 id="ch07list98" class="docExampleTitle">Example 7.98 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{name=ARGV[1]};\</span>
  <span class="docEmphStrong">$0 ~ name {print $3 , $4}'  &quot;Derek&quot; datafile</span>
<span class="docEmphasis">nawk: can't open Derek</span>
<span class="docEmphasis">source line number 1</span>


% <span class="docEmphStrong">nawk 'BEGIN{name=ARGV[1]; delete ARGV[1]};\</span>
  <span class="docEmphStrong">$0 ~ name {print $3, $4}'  &quot;Derek&quot; datafile</span>
<span class="docEmphasis">Derek Johnson</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The name &quot;<span class="docEmphasis">Derek&quot;</span> was 
      set to the variable <span class="docEmphasis">name</span> in the
      <span class="docEmphasis">BEGIN</span> block. In the pattern-action block,
      <span class="docEmphasis">nawk</span> attempted to open &quot;<span class="docEmphasis">Derek&quot;</span> 
      as an input file and failed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">After assigning &quot;<span class="docEmphasis">Derek&quot;</span> 
      to the variable <span class="docEmphasis">name,</span>
      <span class="docEmphasis">ARGV[1]</span> is deleted. When starting the 
      pattern-action block, <span class="docEmphasis">nawk</span> does not try 
      to open &quot;<span class="docEmphasis">Derek&quot;</span> as the input file, but 
      opens <span class="docEmphasis">datafile</span> instead.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h4 class="docSection2Title" id="ch07lev2sec37">7.15.3 Reading Input <span class="docEmphasis">(getline)</span></h4>
<h5 id="ch07list99" class="docExampleTitle">Example 7.99 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{ &quot;date&quot; | getline d; print d}' datafile</span>
<span class="docEmphasis">Mon Jan 15 11:24:24 PST 2001</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The UNIX <span class="docEmphasis">date</span> command is 
    piped to the <span class="docEmphasis">getline</span> function. The results 
    are stored in the variable <span class="docEmphasis">d</span> and printed.</td>
  </tr>
</table>
<h5 id="ch07list10" class="docExampleTitle">Example 7.100 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{ &quot;date &quot; | getline d; split( d, mon) ;print mon[2]}'\</span>
  <span class="docEmphStrong">datafile</span>
<span class="docEmphasis">Jan</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The UNIX <span class="docEmphasis">date</span> command is 
    piped to the <span class="docEmphasis">getline</span> function and the 
    results are stored in <span class="docEmphasis">d.</span> The
    <span class="docEmphasis">split</span> function splits the string
    <span class="docEmphasis">d</span> into an array called
    <span class="docEmphasis">mon.</span> The second element of the array is 
    printed.</td>
  </tr>
</table>
<h5 id="ch07list10" class="docExampleTitle">Example 7.101 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{ printf &quot;Who are you looking for?&quot; ; \</span>
  <span class="docEmphStrong">getline name &lt; &quot;/dev/tty&quot;};\</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Input is read from the terminal,
    <span class="docEmphasis">/dev/tty,</span> and stored in the array called
    <span class="docEmphasis">name.</span></td>
  </tr>
</table>
<h5 id="ch07list10" class="docExampleTitle">Example 7.102 </h5>
<pre>% <span class="docEmphStrong">nawk 'BEGIN{while(getline &lt; &quot;/etc/passwd&quot;  &gt; 0 ){lc++}; print lc}'\</span>
  <span class="docEmphStrong">datafile</span>
<span class="docEmphasis">16</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">while</span> loop is used 
    to loop through the <span class="docEmphasis">/etc/passwd</span> file one 
    line at a time. Each time the loop is entered, a line is read by
    <span class="docEmphasis">getline</span> and the value of the variable
    <span class="docEmphasis">lc</span> is incremented. When the loop exits, the 
    value of <span class="docEmphasis">lc</span> is printed, i.e., the number of 
    lines in the <span class="docEmphasis">/etc/passwd</span> file. As long as 
    the return value from <span class="docEmphasis">getline</span> is not
    <span class="docEmphasis">0,</span> i.e., a line has been read, the looping 
    continues.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch07lev2sec38">7.15.4 Control Functions</h4>
<h5 id="ch07list10" class="docExampleTitle">Example 7.103 </h5>
<pre>% <span class="docEmphStrong">nawk '{if ( $5 &gt; 4.5) next; print $1}' datafile</span>
<span class="docEmphasis">northwest</span>
<span class="docEmphasis">southwest</span>
<span class="docEmphasis">southeast</span>
<span class="docEmphasis">eastern</span>
<span class="docEmphasis">north</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the fifth field is greater than
    <span class="docEmphasis">4.5,</span> the next line is read from the input 
    file (<span class="docEmphasis">datafile</span>) and processing starts at 
    the beginning of the <span class="docEmphasis">awk</span> script (after the
    <span class="docEmphasis">BEGIN</span> block). Otherwise, the first field is 
    printed.</td>
  </tr>
</table>
<h5 id="ch07list10" class="docExampleTitle">Example 7.104 </h5>
<pre>% <span class="docEmphStrong">nawk '{if ($2 ~ /S/){print ; exit 0}}' datafile</span>
<span class="docEmphasis">southwest       SW      Chris   Foster  2.7     .8      2       18</span>

% <span class="docEmphStrong">echo $status</span> <span class="docEmphasis">( csh ) or</span> <span class="docEmphBoldItalic">echo $?</span> <span class="docEmphasis">(sh or ksh)</span>
<span class="docEmphasis">0</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the second field contains an <span class="docEmphasis">
    S,</span> the record is printed and the <span class="docEmphasis">awk</span> 
    program exits. The C shell status variable contains the exit value. If using 
    the Bourne or Korn shells, the <span class="docEmphasis">$?</span> variable 
    contains the exit status.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Joel Craig          3.0    .98    3    4</span>
<span class="docEmphasis">western            WE   Sharon Kelly        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Chris Foster        2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   May Chin            5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Derek Johnson       4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   Susan Beal          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   TJ Nichols          5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Val Shultz          4.5    .89    5    9</span>
<span class="docEmphasis">central            CT   Sheri Watson        5.7    .94    5    13</span>
</pre>
<h4 class="docSection2Title" id="ch07lev2sec39">7.15.5 User-Defined Functions</h4>
<h5 id="ch07list10" class="docExampleTitle">Example 7.105 </h5>
<pre>(The Command Line)
% <span class="docEmphStrong">cat nawk.sc7</span>
1  BEGIN{largest=0}
2  {maximum=max($5)}

3  <span class="docEmphStrong">function max ( num ) {</span>
4     if ( num &gt; largest){ largest=num }
      return largest
5  <span class="docEmphStrong">}</span>
6  END{ print &quot;The maximum is &quot; maximum &quot;.&quot;}

% <span class="docEmphStrong">nawk -f nawk.sc7 datafile</span>
<span class="docEmphasis">The maximum is 5.7.</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the <span class="docEmphasis">BEGIN</span> block, 
      the user-defined variable <span class="docEmphasis">largest</span> is 
      initialized to zero.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">For each line in the file, the variable
      <span class="docEmphasis">maximum</span> is assigned the value returned 
      from the function <span class="docEmphasis">max.</span> The function
      <span class="docEmphasis">max</span> is given <span class="docEmphasis">$5</span> 
      as its argument.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The user-defined function <span class="docEmphasis">max</span> 
      is defined. The function statements are enclosed in curly braces. Each 
      time a new record is read from the input file, <span class="docEmphasis">
      datafile,</span> the function <span class="docEmphasis">max</span> will be 
      called.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">It will compare the values in <span class="docEmphasis">
      num</span> and <span class="docEmphasis">largest</span> and return the 
      larger of the two numbers.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The function definition block ends.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">END</span> block prints 
      the final value in <span class="docEmphasis">maximum.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch07lev1sec18">UNIX TOOLS LAB EXERCISE</h3>
<h4 class="docSection2Title" id="ch07lev2sec40">Lab 7: <span class="docEmphasis">nawk</span> 
Exercise</h4>
<p class="docText">Mike Harrington:(510) 548-1278:250:100:175</p>
<p class="docText">Christian Dobbins:(408) 538-2358:155:90:201</p>
<p class="docText">Susan Dalsass:(206) 654-6279:250:60:50</p>
<p class="docText">Archie McNichol:(206) 548-1348:250:100:175</p>
<p class="docText">Jody Savage:(206) 548-1278:15:188:150</p>
<p class="docText">Guy Quigley:(916) 343-6410:250:100:175</p>
<p class="docText">Dan Savage:(406) 298-7744:450:300:275</p>
<p class="docText">Nancy McNeil:(206) 548-1278:250:80:75</p>
<p class="docText">John Goldenrod:(916) 348-4278:250:100:175</p>
<p class="docText">Chet Main:(510) 548-5258:50:95:135</p>
<p class="docText">Tom Savage:(408) 926-3456:250:168:200</p>
<p class="docText">Elizabeth Stachelin:(916) 440-1763:175:75:300</p>
<p class="docText">(Refer to the database called <span class="docEmphasis">
lab7.data</span> on the CD.)</p>
<p class="docText">The database above contains the names, phone numbers, and 
money contributions to the party campaign for the past three months.</p>
<table cellSpacing="16" cellpadding="5" border="0">
  <tr vAlign="top">
    <td class="docText" align="right"><b>1:</b></td>
    <td>
    <p class="docText">Write a user-defined function to return the average of 
    all the contributions for a given month. The month will be passed in at the 
    command line.</td>
  </tr>
</table>
<blockquote>
<p class="docFootnote" id="EN7-1"><a class="docLink" href="#ENB7-1">[1]</a>&nbsp;&nbsp;For details on 
  how commas are added back into the program, see Alfred V. Aho, Brian W. 
  Kernighan, and Peter J. Weinberger, <i>The AWK Programming Language</i> 
  (Boston: Addison-Wesley, 1988), p. 72.</p><p class="docFootnote" id="EN7-2"><a class="docLink" href="#ENB7-2">[2]</a>&nbsp;&nbsp;&nbsp;Alfred V. Aho, 
  Brian W. Kernighan, and Peter J. Weinberger, <i>The AWK Programming Language</i> 
  (Boston: Addison-Wesley, 1988). © 1988 Bell Telephone Laboratories, Inc. 
  Reprinted by permission of Pearson Education, Inc.</p></blockquote>
<table width="100%" border="1" bgcolor="#EBEBFF"><tr><td width="5%" align="left" valign="middle"><a href="_chapter 6.htm"><img src="Larrow.gif" width="17" height="19" border="0"></a></td><td align="center" valign="middle"><a class="docLink" href="Front matter.htm">CONTENTS</a></td><td width="5%" align="right" valign="middle"><a href="_chapter 8.htm"><img src="Rarrow.gif" width="17" height="19" border="0"></a></td></tr></table></body>

</html>