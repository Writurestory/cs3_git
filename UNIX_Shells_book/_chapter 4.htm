<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>Chapter 4</title>
<link rel="stylesheet" type="text/css" href="docsafari.css">
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body><table width="100%" border="1" bgcolor="#EBEBFF"><tr><td width="5%" align="left" valign="middle"><a href="_chapter 3.htm"><img src="Larrow.gif" width="17" height="19" border="0"></a></td><td align="center" valign="middle"><a class="docLink" href="Front matter.htm">CONTENTS</a></td><td width="5%" align="right" valign="middle"><a href="_chapter 5.htm"><img src="Rarrow.gif" width="17" height="19" border="0"></a></td></tr></table>


<h2 class="docChapterTitle">Chapter 4. <span class="docEmphasis">sed,</span> the
Streamlined Editor</h2><ul><li>&nbsp;<a class="docLink" href="#ch04lev1sec1">4.1 What Is <span class="docEmphasis">sed?</span></a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec2">4.2 How Does <span class="docEmphasis">sed</span> Work?</a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec3">4.3 Addressing</a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec4">4.4 Commands and Options</a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec5">4.5 Error Messages and Exit Status</a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec6">4.6 <span class="docEmphasis">sed</span> Examples</a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec7">4.7 <span class="docEmphasis">sed</span> Scripting</a></li>
<li>&nbsp;<a class="docLink" href="#ch04lev1sec8">UNIX TOOLS LAB EXERCISE</a></li>
</ul>
<p class="docText" align="left">
<img alt="graphics/ch04.gif" src="ch04.gif" border="0" width="500" height="350"></p>
<h3 class="docSection1Title" id="ch04lev1sec1">4.1 What Is <span class="docEmphasis">sed?</span></h3>
<p class="docText">S<span class="docEmphasis">ed</span> is a streamlined,
noninteractive editor. It allows you to perform the same kind of editing tasks
used in the <span class="docEmphasis">vi</span> and <span class="docEmphasis">ex</span>
editors. Instead of working interactively with the editor, the
<span class="docEmphasis">sed</span> program lets you type your editing commands
at the command line, name the file, and then see the output of the editing
command on the screen. The <span class="docEmphasis">sed</span> editor is
nondestructive. It does not change your file unless you save the output with
shell redirection. All lines are printed to the screen by default.</p>
<p class="docText">The <span class="docEmphasis">sed</span> editor is useful in
shell scripts, where using interactive editors such as <span class="docEmphasis">
vi</span> or <span class="docEmphasis">ex</span> would require the user of the
script to have familiarity with the editor and would expose the user to making
unwanted modifications to the open file. You can also put
<span class="docEmphasis">sed</span> commands in a file called a
<span class="docEmphasis">sed</span> script, if you need to perform multiple
edits or do not like worrying about quoting the <span class="docEmphasis">sed</span>
commands at the shell command line.<span id="ENB4-1"><a class="docLink" href="#EN4-1"><sup>[1]</sup></a></span></p>
<h3 class="docSection1Title" id="ch04lev1sec2">4.2 How Does <span class="docEmphasis">sed</span>
Work?</h3>
<p class="docText">The <span class="docEmphasis">sed</span> editor processes a
file (or input) one line at a time and sends its output to the screen. Its
commands are those you may recognize from the <span class="docEmphasis">vi</span>
and <span class="docEmphasis">ed/ex</span> editors. <span class="docEmphasis">
Sed</span> stores the line it is currently processing in a temporary buffer
called a <span class="docEmphasis">pattern space.</span> Once
<span class="docEmphasis">sed</span> is finished processing the line in the
pattern space (i.e., executing <span class="docEmphasis">sed</span> commands on
that line), the line in the pattern space is sent to the screen (unless the
command was to delete the line or suppress its printing). After the line has
been processed, it is removed from the pattern space and the next line is then
read into the pattern space, processed, and displayed. <span class="docEmphasis">
Sed</span> ends when the last line of the input file has been processed. By
storing each line in a temporary buffer and performing edits on that line, the
original file is never altered or destroyed.</p>
<h3 class="docSection1Title" id="ch04lev1sec3">4.3 Addressing</h3>
<p class="docText">You can use addressing to decide which lines you want to
edit. The addresses can be in the form of numbers or regular expressions, or a
combination of both. Without specifying an address, <span class="docEmphasis">
sed</span> processes all lines of the input file.</p>
<p class="docText">When an address consists of a number, the number represents a
line number. A dollar sign can be used to represent the last line of the input
file. If a comma separates two line numbers, the addresses that will be
processed are within that range of lines, including the first and last line in
the range. The range may be numbers, regular expressions, or a combination of
numbers and regular expressions.</p>
<p class="docText">S<span class="docEmphasis">ed</span> commands tell
<span class="docEmphasis">sed</span> what to do with the line: print it, remove
it, change it, and so forth.</p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">FORMAT</h2>
    <pre>sed 'command' filename(s)
</pre>
    </td>
  </tr>
</table>
<h5 id="ch04list01" class="docExampleTitle">Example 4.1 </h5>
<pre>1  % <span class="docEmphStrong">sed '1,3p' myfile</span>
2  % <span class="docEmphStrong">sed -n '/[Jj]ohn/p' datafile</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Lines 1 through 3 of <span class="docEmphasis">myfile</span>
      are printed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Only lines matching the pattern
      <span class="docEmphasis">John</span> or <span class="docEmphasis">john</span>
      in <span class="docEmphasis">myfile</span> are printed.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch04lev1sec4">4.4 Commands and Options</h3>
<p class="docText"><span class="docEmphasis">Sed</span> commands tell
<span class="docEmphasis">sed</span> how to process each line of input specified
by an address. If an address is not given, <span class="docEmphasis">sed</span>
processes every line of input. (The % is the csh prompt.) See
<a class="docLink" href="#ch04table01">Table 4.1</a> for a list of
<span class="docEmphasis">sed</span> commands and what they do, and see
<a class="docLink" href="#ch04table02">Table 4.2</a> for a list of options and
how they control <span class="docEmphasis">sed</span>'s behavior.</p>
<h5 id="ch04list02" class="docExampleTitle">Example 4.2 </h5>
<pre>% <span class="docEmphStrong">sed '1,3d' file</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText"><span class="docEmphasis">Sed</span> will delete lines 1
    through 3.</td>
  </tr>
</table>
<p>&nbsp;</p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch04table01" class="docTableTitle">Table 4.1. <span class="docEmphasis">sed</span>
  Commands</h5>
  </caption>
  <colgroup span="2" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Command</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Function</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">a\</span>
    </td>
    <td class="docTableCell" vAlign="top">Appends one or more lines of text to
    the current line. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">c\</span>
    </td>
    <td class="docTableCell" vAlign="top">Changes (replaces) text in the current
    line with new text. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">d</span>
    </td>
    <td class="docTableCell" vAlign="top">Deletes lines. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">i\</span>
    </td>
    <td class="docTableCell" vAlign="top">Inserts text above the current line.
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">h</span>
    </td>
    <td class="docTableCell" vAlign="top">Copies the contents of the pattern
    space to a holding buffer. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">H</span>
    </td>
    <td class="docTableCell" vAlign="top">Appends the contents of the pattern
    space to a holding buffer. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">g</span>
    </td>
    <td class="docTableCell" vAlign="top">Gets what is in the holding buffer and
    copies it into the pattern buffer, overwriting what was there. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">G</span>
    </td>
    <td class="docTableCell" vAlign="top">Gets what is in the holding buffer and
    copies it into the pattern buffer, appending to what was there. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">l</span>
    </td>
    <td class="docTableCell" vAlign="top">Lists nonprinting characters. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">p</span>
    </td>
    <td class="docTableCell" vAlign="top">Prints lines. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">n</span>
    </td>
    <td class="docTableCell" vAlign="top">Reads the next input line and starts
    processing the newline with the next command rather than the first command.
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">q</span>
    </td>
    <td class="docTableCell" vAlign="top">Quits or exits
    <span class="docEmphasis">sed.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">r</span>
    </td>
    <td class="docTableCell" vAlign="top">Reads lines from a file. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">!</span>
    </td>
    <td class="docTableCell" vAlign="top">Applies the command to all lines
    <span class="docEmphasis">except</span> the selected ones. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">s</span>
    </td>
    <td class="docTableCell" vAlign="top">Substitutes one string for another.
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top" colSpan="2">
    <span class="docEmphBoldItalic">Substitution Flags:</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">g</span>
    </td>
    <td class="docTableCell" vAlign="top">Globally substitutes on a line. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">p</span>
    </td>
    <td class="docTableCell" vAlign="top">Prints lines. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">w</span>
    </td>
    <td class="docTableCell" vAlign="top">Writes lines out to a file. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">x</span>
    </td>
    <td class="docTableCell" vAlign="top">Exchanges contents of the holding
    buffer with the pattern space. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">y</span>
    </td>
    <td class="docTableCell" vAlign="top">Translates one character to another
    (cannot use regular expression metacharacters with <span class="docEmphasis">
    y</span>). </td>
  </tr>
</table>
<p>&nbsp;</p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch04table02" class="docTableTitle">Table 4.2. <span class="docEmphasis">sed</span>
  Options</h5>
  </caption>
  <colgroup span="2" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Options</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Function</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">-e</span>
    </td>
    <td class="docTableCell" vAlign="top">Allows multiple edits. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">-f</span>
    </td>
    <td class="docTableCell" vAlign="top">Precedes a <span class="docEmphasis">
    sed</span> script filename. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">-n</span>
    </td>
    <td class="docTableCell" vAlign="top">Suppresses default output. </td>
  </tr>
</table>
<p class="docText">When multiple commands are used or addresses need to be
nested within a range of addresses, the commands are enclosed in curly braces
and each command is either on a separate line or terminated with semicolons.</p>
<p class="docText">The exclamation point (!) can be used to negate a command.
For example,</p>
<pre>% <span class="docEmphStrong">sed '/Tom/d' file</span></pre>
<p class="docText">tells <span class="docEmphasis">sed</span> to delete all
lines containing the pattern <span class="docEmphasis">Tom,</span> whereas</p>
<pre>% <span class="docEmphStrong">sed '/Tom/!d' file</span>
</pre>
<p class="docText">tells <span class="docEmphasis">sed</span> to delete lines
not containing <span class="docEmphasis">Tom.</span></p>
<p class="docText">The <span class="docEmphasis">sed</span> options are
<span class="docEmphasis">-e, -f,</span> and, <span class="docEmphasis">-n.</span>
The <span class="docEmphasis">-e</span> is used for multiple edits at the
command line, the <span class="docEmphasis">-f</span> precedes a
<span class="docEmphasis">sed</span> script filename, and the
<span class="docEmphasis">-n</span> suppresses printing output.</p>
<h3 class="docSection1Title" id="ch04lev1sec5">4.5 Error Messages and Exit Status</h3>
<p class="docText">When <span class="docEmphasis">sed</span> encounters a syntax
error, it sends a pretty straightforward error message to standard error, but if
it cannot figure out what you did wrong, <span class="docEmphasis">sed</span>
gets &quot;garbled,&quot; which we could guess means confused. The exit status that
<span class="docEmphasis">sed</span> returns to the shell, if its syntax is
error-free, is a zero for success and a nonzero integer for failure.<span id="ENB4-2"><a class="docLink" href="#EN4-2"><sup>[2]</sup></a></span></p>
<h5 id="ch04list03" class="docExampleTitle">Example 4.3 </h5>
<pre>1   % <span class="docEmphStrong">sed '1,3v ' file</span>
    s<span class="docEmphasis">ed: Unrecognized command: 1,3v</span>
    % <span class="docEmphStrong">echo $status</span> (<span class="docEmphStrong">echo $?</span>  <span class="docEmphasis">if using Korn or Bourne shell</span>)
    <span class="docEmphasis">2</span>

2   % <span class="docEmphStrong">sed '/^John' file</span>
    <span class="docEmphasis">sed: Illegal or missing delimiter: /^John</span>

3   % <span class="docEmphStrong">sed 's/134345/g' file</span>
    <span class="docEmphasis">sed: Ending delimiter missing on substitution: s/134345/g</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The <span class="docEmphasis">v</span> command is
      unrecognized by <span class="docEmphasis">sed.</span> The exit status was
      2, indicating that <span class="docEmphasis">sed</span> exited with a
      syntax problem.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The pattern <span class="docEmphasis">/^John</span> is
      missing the closing forward slash.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">The substitution command, <span class="docEmphasis">s,</span>
      contains the search string but not the replacement string.</span></li>
    </ol>
    </span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec1">4.5.1 Metacharacters</h4>
<p class="docText">Like <span class="docEmphasis">grep, sed</span> supports a
number of special metacharacters to control pattern searching. See
<a class="docLink" href="#ch04table03">Table 4.3</a></p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch04table03" class="docTableTitle">Table 4.3. <span class="docEmphasis">sed</span>'s
  Regular Expression Metacharacters.</h5>
  </caption>
  <colgroup span="4" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Metacharacter</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Function</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Example</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">What
    It Matches</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">^</span>
    </td>
    <td class="docTableCell" vAlign="top">Beginning-of-line anchor </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/^love/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches all lines beginning with
    <span class="docEmphasis">love.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">$</span>
    </td>
    <td class="docTableCell" vAlign="top">End-of-line anchor </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/love$/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches all lines ending with
    <span class="docEmphasis">love.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">.</span></td>
    <td class="docTableCell" vAlign="top">Matches one character, but not the
    newline character </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/l..e/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches lines containing an
    <span class="docEmphasis">l,</span> followed by two characters, followed by
    an <span class="docEmphasis">e.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">*</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches zero or more characters </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/ *love/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches lines with zero or more
    spaces, followed by the pattern <span class="docEmphasis">love.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">[ ]</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches one character in the set </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/[Ll]ove/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches lines containing
    <span class="docEmphasis">love</span> or <span class="docEmphasis">Love.</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">[^ ]</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches one character not in the set
    </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/[^A-KM-Z]ove/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches lines not containing
    <span class="docEmphasis">A</span> through <span class="docEmphasis">K</span>
    or <span class="docEmphasis">M</span> through <span class="docEmphasis">Z</span>
    followed by <span class="docEmphasis">ove.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">\(..\)</span>
    </td>
    <td class="docTableCell" vAlign="top">Saves matched characters </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">
    s/\(love\)able/\1er/</span> </td>
    <td class="docTableCell" vAlign="top">Tags marked portion and saves it as
    tag number 1. To reference later, use <span class="docEmphasis">\1</span> to
    reference the pattern. May use up to nine tags, starting with the first tag
    at the leftmost part of the pattern. For example, <span class="docEmphasis">
    love</span> is saved in register 1 and remembered in the replacement string.
    <span class="docEmphasis">lovable</span> is replaced with
    <span class="docEmphasis">lover.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">&amp;</span>
    </td>
    <td class="docTableCell" vAlign="top">Saves search string so it can be
    remembered in the replacement string </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">
    s/love/**&amp;**/</span> </td>
    <td class="docTableCell" vAlign="top">The ampersand represents the search
    string. The string <span class="docEmphasis">love</span> will be replaced
    with itself surrounded by asterisks; i.e., <span class="docEmphasis">love</span>
    will become <span class="docEmphasis">**love**.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">\&lt;</span>
    </td>
    <td class="docTableCell" vAlign="top">Beginning-of-word anchor </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/\&lt;love/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches lines containing a word that
    begins with <span class="docEmphasis">love.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">\&gt;</span>
    </td>
    <td class="docTableCell" vAlign="top">End-of-word anchor </td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/love\&gt;/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches lines containing a word that
    ends with <span class="docEmphasis">love.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top">
    <p class="docText"><span class="docEmphasis">x\{m\}</span></p>
    <p class="docText"><span class="docEmphasis">x\{m,\}</span></p>
    <p class="docText"><span class="docEmphasis">x\{m,n\}</span><sup class="docFootnote"><a class="docLink" href="#ch04tabfn01">[a]</a></sup></td>
    <td class="docTableCell" vAlign="top">
    <p class="docText">Repetition of character x: m times</p>
    <p class="docText">at least m times</p>
    <p class="docText">at least m and not more than n times</td>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">/o\{5\}/</span>
    </td>
    <td class="docTableCell" vAlign="top">Matches if line has 5 occurrences of
    <span class="docEmphasis">o,</span> at least 5 occurrences of
    <span class="docEmphasis">o,</span> or between 5 and 10 occurrences of
    <span class="docEmphasis">o.</span></td>
  </tr>
</table>
<blockquote>
  <p class="docFootnote"><sup><a name="ch04tabfn01">[a]</a></sup> Not dependable
  on all versions of UNIX or all pattern-matching utilities; usually works with
  <span class="docEmphasis">vi</span> and <span class="docEmphasis">grep.</span></p>
</blockquote>
<h3 class="docSection1Title" id="ch04lev1sec6">4.6 <span class="docEmphasis">sed</span> Examples</h3>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0    .98    3    43</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3    .97    5    23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7    .8     2    18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1    .95    4    15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0    .7     4    17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4    .84    5    20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1    .94    3    13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5    .89    5     9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7    .94    5    13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec2">4.6.1 Printing: The <span class="docEmphasis">p</span>
Command</h4>
<h5 id="ch04list04" class="docExampleTitle">Example 4.4 </h5>
<pre><span class="docEmphStrong">sed '/north/p' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main        3.0  .98   3   34</span>
<span class="docEmphasis">northwest     NW     Charles Main        3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray         5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass       2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin           5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway   4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage           4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.         5.1  .94   3   13</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.         5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber        4.5  .89   5   9</span>
<span class="docEmphasis">north         NO     Margot Weber        4.5  .89   5   9</span>
<span class="docEmphasis">central       CT     Ann Stephens        5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Prints all lines to standard output by default. If the
    pattern <span class="docEmphasis">north</span> is found,
    <span class="docEmphasis">sed</span> will print that line in addition to all
    the other lines.</td>
  </tr>
</table>
<h5 id="ch04list05" class="docExampleTitle">Example 4.5 </h5>
<pre><span class="docEmphStrong">sed -n '/north/p' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main        3.0  .98   3   34</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.         5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber        4.5  .89   5    9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">-n</span> option suppresses
    the default behavior of <span class="docEmphasis">sed</span> when used with
    the <span class="docEmphasis">p</span> command. Without the
    <span class="docEmphasis">-n</span> option, <span class="docEmphasis">sed</span>
    will print duplicate lines of output as shown in the preceding example. Only
    the lines containing the pattern <span class="docEmphasis">north</span> are
    printed when <span class="docEmphasis">-n</span> is used.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5    9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec3">4.6.2 Deleting: The <span class="docEmphasis">d</span>
Command</h4>
<h5 id="ch04list06" class="docExampleTitle">Example 4.6 </h5>
<pre><span class="docEmphStrong">sed '3d' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5    9</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Deletes the third line. All other lines are printed to
    the screen by default.</td>
  </tr>
</table>
<h5 id="ch04list07" class="docExampleTitle">Example 4.7 </h5>
<pre><span class="docEmphStrong">sed '3,$d' datafile</span>
<span class="docEmphasis">northwest      NW    Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western        WE    Sharon Gray        5.3  .97   5   23</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The third line through the last line are deleted. The
    remaining lines are printed. The dollar sign (<span class="docEmphasis">$</span>)
    represents the last line of the file. The comma is called the
    <span class="docEmphasis">range operato</span>r. In this example, the range
    of addresses starts at line 3 and ends at the last line, which is
    represented by the dollar sign (<span class="docEmphasis">$</span>).</td>
  </tr>
</table>
<h5 id="ch04list08" class="docExampleTitle">Example 4.8 </h5>
<pre><span class="docEmphStrong">sed '$d' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main        3.0  .98   3  34</span>
<span class="docEmphasis">western       WE     Sharon Gray         5.3  .97   5  23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass       2.7  .8    2  18</span>
<span class="docEmphasis">southern      SO     Suan Chin           5.1  .95   4  15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway   4.0  .7    4  17</span>
<span class="docEmphasis">eastern       EA     TB Savage           4.4  .84   5  20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.         5.1  .94   3  13</span>
<span class="docEmphasis">north         NO     Margot Weber        4.5  .89   5   9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Deletes the last line. The dollar sign (<span class="docEmphasis">$</span>)
    represents the last line. The default is to print all of the lines except
    those affected by the <span class="docEmphasis">d</span> command.</td>
  </tr>
</table>
<h5 id="ch04list09" class="docExampleTitle">Example 4.9 </h5>
<pre><span class="docEmphStrong">sed '/north/d' datafile</span>
<span class="docEmphasis">western       WE     Sharon Gray         5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass       2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin           5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway   4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage           4.4  .84   5   20</span>
<span class="docEmphasis">central       CT     Ann Stevens         5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">All lines containing the pattern
    <span class="docEmphasis">north</span> are deleted. The remaining lines are
    printed.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec4">4.6.3 Substitution: The <span class="docEmphasis">s</span>
Command</h4>
<h5 id="ch04list10" class="docExampleTitle">Example 4.10 </h5>
<pre><span class="docEmphStrong">sed 's/west/north/g' datafile</span>
<span class="docEmphasis">northnorth    NW     Charles Main        3.0  .98   3   34</span>
<span class="docEmphasis">northern      WE     Sharon Gray         5.3  .97   5   23</span>
<span class="docEmphasis">southnorth    SW     Lewis Dalsass       2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin           5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway   4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage           4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.         5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber        4.5  .89   5    9</span>
<span class="docEmphasis">central       CT     Ann Stephens        5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">s</span> command is for
    substitution. The <span class="docEmphasis">g</span> flag at the end of the
    command indicates that the substitution is global across the line; that is,
    if multiple occurrences of <span class="docEmphasis">west</span> are found,
    all of them will be replaced with <span class="docEmphasis">north.</span>
    Without the <span class="docEmphasis">g</span> command, only the first
    occurrence of <span class="docEmphasis">west</span> on each line would be
    replaced with <span class="docEmphasis">north.</span></td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5   9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h5 id="ch04list11" class="docExampleTitle">Example 4.11 </h5>
<pre><span class="docEmphStrong">sed -n 's/^west/north/p' datafile</span>
<span class="docEmphasis">northern      WE     Sharon Gray        5.3  .97   5   23</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">s</span> command is for
    substitution. The <span class="docEmphasis">-n</span> option with the
    <span class="docEmphasis">p</span> flag at the end of the command tells
    <span class="docEmphasis">sed</span> to print only those lines where the
    substitution occurred; that is, if <span class="docEmphasis">west</span> is
    found at the beginning of the line and is replaced with
    <span class="docEmphasis">north,</span> just those lines are printed.</td>
  </tr>
</table>
<h5 id="ch04list12" class="docExampleTitle">Example 4.12 </h5>
<pre><span class="docEmphStrong">sed 's/[0–9][0–9]$/&amp;.5/' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34.5</span>
<span class="docEmphasis">western       WE     Sharon Gray        5 3  .97   5   23.5</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18.5</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15.5</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17.5</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20.5</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13.5</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5   9</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7  .94   5   13.5</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The ampersand<span id="ENB4-3"><a class="docLink" href="#EN4-3"><sup>[3]</sup></a></span>
    (&amp;) in the replacement string represents exactly what was found in the
    search string. Each line that ends in two digits will be replaced by itself,
    and <span class="docEmphasis">.5</span> will be appended to it.</td>
  </tr>
</table>
<h5 id="ch04list13" class="docExampleTitle">Example 4.13 </h5>
<pre><span class="docEmphStrong">sed -n 's/Hemenway/Jones/gp' datafile</span>
<span class="docEmphasis">southeast     SE     Patricia Jones      4.0  .7   4     17</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">All occurrences of <span class="docEmphasis">Hemenway</span>
    are replaced with <span class="docEmphasis">Jones,</span> and only the lines
    that changed are printed. The <span class="docEmphasis">-n</span> option
    combined with the <span class="docEmphasis">p</span> command suppresses the
    default output. The <span class="docEmphasis">g</span> stands for global
    substitution across the line.</td>
  </tr>
</table>
<h5 id="ch04list14" class="docExampleTitle">Example 4.14 </h5>
<pre><span class="docEmphStrong">sed -n 's/\(Mar\)got/\1ianne/p' datafile</span>
<span class="docEmphasis">north         NO     Marianne Weber      4.5  .89   5    9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The pattern <span class="docEmphasis">Mar</span> is
    enclosed in parentheses and saved as tag 1 in a special register. It will be
    referenced in the replacement string as \1. <span class="docEmphasis">Margot</span>
    is then replaced with <span class="docEmphasis">Marianne.</span></td>
  </tr>
</table>
<h5 id="ch04list15" class="docExampleTitle">Example 4.15 </h5>
<pre><span class="docEmphStrong">sed 's#3#88#g' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       88.0  .98   88   884</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.88  .97    5   288</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7   .8     2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1   .95    4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0   .7     4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4   .84    5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1   .94   88   188</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5   .89    5   9</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7   .94    5   188</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The character after the <span class="docEmphasis">s</span>
    command is the delimiter between the search string and the replacement
    string. The delimiter character is a forward slash by default, but can be
    changed (only when the <span class="docEmphasis">s</span> command is used).
    Whatever character follows the <span class="docEmphasis">s</span> command is
    the new string delimiter. This technique can be useful when searching for
    patterns containing a forward slash, such as pathnames or birthdays.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3    34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5    23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2    18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4    15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4    17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5    20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3    13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5     9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5    13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec5">4.6.4 Range of Selected Lines: The Comma</h4>
<h5 id="ch04list16" class="docExampleTitle">Example 4.16 </h5>
<p class="docText">
<img height="103" alt="graphics/04prfig01.gif" src="04prfig01.gif" width="500" border="0"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">All lines in the range of patterns between
    <span class="docEmphasis">west</span> and <span class="docEmphasis">east</span>
    are printed. If <span class="docEmphasis">west</span> were to appear on a
    line after <span class="docEmphasis">east,</span> the lines from
    <span class="docEmphasis">west</span> to the next <span class="docEmphasis">
    east</span> or to the end of file, whichever comes first, would be printed.
    The arrows mark the range.</td>
  </tr>
</table>
<h5 id="ch04list17" class="docExampleTitle">Example 4.17 </h5>
<pre><span class="docEmphStrong">sed -n '5,/^northeast/p' datafile</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">Prints the lines from line <span class="docEmphasis">5</span>
    through the first line that begins with <span class="docEmphasis">northeast.</span></td>
  </tr>
</table>
<h5 id="ch04list18" class="docExampleTitle">Example 4.18 </h5>
<p class="docText">
<img height="156" alt="graphics/04prfig02.gif" src="04prfig02.gif" width="500" border="0"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">For lines in the range between the patterns
    <span class="docEmphasis">east</span> and <span class="docEmphasis">west,</span>
    the end of line (<span class="docEmphasis">$</span>) is replaced with the
    string <span class="docEmphasis">**VACA**.</span> The newline is moved over
    to the end of the new string. The arrows mark the range.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec6">4.6.5 Multiple Edits: The <span class="docEmphasis">
e</span> Command</h4>
<h5 id="ch04list19" class="docExampleTitle">Example 4.19 </h5>
<pre><span class="docEmphStrong">sed -e '1,3d' -e 's/Hemenway/Jones/' datafile</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Jones     4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main            5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5   9</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">-e</span> option allows
    multiple edits. The first edit removes lines <span class="docEmphasis">1</span>
    through <span class="docEmphasis">3.</span> The second edit substitutes
    <span class="docEmphasis">Hemenway</span> with <span class="docEmphasis">
    Jones.</span> Since both edits are done on a per-line basis (i.e., both
    commands are executed on the current line in the pattern space), the order
    of the edits may affect the outcome. For example, if both commands had
    performed substitutions on the line, the first substitution could affect the
    second substitution.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5    9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec7">4.6.6 Reading from Files: The
<span class="docEmphasis">r</span> Command</h4>
<h5 id="ch04list20" class="docExampleTitle">Example 4.20 </h5>
<pre>% <span class="docEmphStrong">cat newfile</span>
              ----------------------------------
              | ***SUAN HAS LEFT THE COMPANY*** |
              |_________________________________|
% <span class="docEmphStrong">sed '/Suan/r newfile' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
              -----------------------------------
              | <span class="docEmphasis">***SUAN HAS LEFT THE COMPANY***</span>   |
              |___________________________________|
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main            5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5   9</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">r</span> command reads
    specified lines from a file.The contents of <span class="docEmphasis">
    newfile</span> are read into the input file <span class="docEmphasis">
    datafile,</span> after the line where the pattern <span class="docEmphasis">
    Suan</span> is matched. If <span class="docEmphasis">Suan</span> had
    appeared on more than one line, the contents of <span class="docEmphasis">
    newfile</span> would have been read in under each occurrence.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec8">4.6.7 Writing to Files: The
<span class="docEmphasis">w</span> Command</h4>
<h5 id="ch04list21" class="docExampleTitle">Example 4.21 </h5>
<pre><span class="docEmphStrong">sed -n '/north/w newfile' datafile</span>
cat newfile
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3  34</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3  13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5   9</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">w</span> command writes
    specified lines to a file. All lines containing the pattern
    <span class="docEmphasis">north</span> are written to a file called
    <span class="docEmphasis">newfile.</span></td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec9">4.6.8 Appending: The <span class="docEmphasis">a</span>
Command</h4>
<h5 id="ch04list22" class="docExampleTitle">Example 4.22 </h5>
<pre><span class="docEmphStrong">sed '/^north  /a\\</span>
<span class="docEmphStrong">---&gt;THE NORTH SALES DISTRICT HAS MOVED&lt;---' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5   9</span>
<span class="docEmphasis">---&gt;THE NORTH SALES DISTRICT HAS MOVED&lt;---</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">a</span> command is the
    append command. The string <span class="docEmphasis">---&gt;THE NORTH SALES
    DISTRICT HAS MOVED&lt;---</span> is appended after lines beginning with the
    pattern <span class="docEmphasis">north,</span> when
    <span class="docEmphasis">north</span> is followed by a space. The text that
    will be appended must be on the line following the append command.</p>
    <p class="docText"><span class="docEmphasis">Sed</span> requires a backslash
    after the <span class="docEmphasis">a</span> command. The second backslash
    is used by the C shell to escape the newline so that its closing quote can
    be on the next line.<span id="ENB4-4"><a class="docLink" href="#EN4-4"><sup>[4]</sup></a></span>
    If more than one line is appended, each line, except the last one, must also
    end in a backslash.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5    9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec10">4.6.9 Inserting: The <span class="docEmphasis">i</span>
Command</h4>
<h5 id="ch04list23" class="docExampleTitle">Example 4.23 </h5>
<pre><span class="docEmphStrong">sed '/eastern/i\\</span>
<span class="docEmphStrong">NEW ENGLAND REGION\\</span>
<span class="docEmphStrong">-------------------------------------' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">NEW ENGLAND REGION</span>
-------------------------------------
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5   9</span>
<span class="docEmphasis">central       CT     Ann Stephens       5.7  .94   5   13</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">i</span> command is the
    insert command. If the pattern <span class="docEmphasis">eastern</span> is
    matched, the <span class="docEmphasis">i</span> command causes the text
    following the backslash to be inserted above the line containing
    <span class="docEmphasis">eastern.</span> A backslash is required after each
    line to be inserted, except the last one. (The extra backslash is for the C
    shell.)</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec11">4.6.10 Next: The <span class="docEmphasis">n</span>
Command</h4>
<h5 id="ch04list24" class="docExampleTitle">Example 4.24 </h5>
<p class="docText">
<img height="155" alt="graphics/04prfig03.gif" src="04prfig03.gif" width="500" border="0"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the pattern <span class="docEmphasis">eastern</span>
    is matched on a line, the <span class="docEmphasis">n</span> command causes
    <span class="docEmphasis">sed</span> to get the next line of input (the line
    with <span class="docEmphasis">AM Main Jr.</span>), replace the pattern
    space with this line, substitute (<span class="docEmphasis">s</span>)
    <span class="docEmphasis">AM</span> with <span class="docEmphasis">Archie,</span>
    print the line, and continue.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec12">4.6.11 Transform: The <span class="docEmphasis">y</span>
Command</h4>
<h5 id="ch04list25" class="docExampleTitle">Example 4.25 </h5>
<p class="docText">
<img alt="graphics/04prfig04.gif" src="04prfig04.gif" border="0" width="500" height="169"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">For lines <span class="docEmphasis">1</span> through
    <span class="docEmphasis">3,</span> the <span class="docEmphasis">y</span>
    command translates all lowercase letters to uppercase letters. Regular
    expression metacharacters do not work with this command.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5   9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec13">4.6.12 Quit: The <span class="docEmphasis">q</span>
Command</h4>
<h5 id="ch04list26" class="docExampleTitle">Example 4.26 </h5>
<pre><span class="docEmphStrong">sed '5q' datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">After the line <span class="docEmphasis">5</span> is
    printed, the <span class="docEmphasis">q</span> command causes the
    <span class="docEmphasis">sed</span> program to quit.</td>
  </tr>
</table>
<h5 id="ch04list27" class="docExampleTitle">Example 4.27 </h5>
<pre><span class="docEmphStrong">sed  '/Lewis/{ s/Lewis/Joseph/;q; }' datafile</span>
<span class="docEmphasis">northwest     NW      Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE      Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW      Joseph Dalsass     2.7  .8    2   18</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">When the pattern <span class="docEmphasis">Lewis</span>
    is matched on a line, first the substitution command (<span class="docEmphasis">s</span>)
    replaces <span class="docEmphasis">Lewis</span> with
    <span class="docEmphasis">Joseph,</span> and then the
    <span class="docEmphasis">q</span> command causes the
    <span class="docEmphasis">sed</span> program to quit.</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec14">4.6.13 Holding and Getting: The
<span class="docEmphasis">h</span> and <span class="docEmphasis">g</span>
Commands</h4>
<h5 id="ch04list28" class="docExampleTitle">Example 4.28 </h5>
<p class="docText">
<img height="169" alt="graphics/04prfig05.gif" src="04prfig05.gif" width="500" border="0"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">As <span class="docEmphasis">sed</span> processes the
    file, each line is stored in a temporary buffer called the pattern space.
    Unless the line is deleted or suppressed from printing, the line will be
    printed to the screen after it is processed. The pattern space is then
    cleared and the next line of input is stored there for processing. In this
    example, after the line containing the pattern <span class="docEmphasis">
    northeast</span> is found, it is placed in the pattern space and the
    <span class="docEmphasis">h</span> command copies it and places it into
    another special buffer called the <span class="docEmphasis">holding buffer.</span>
    In the second <span class="docEmphasis">sed</span> instruction, when the
    last line is reached (<span class="docEmphasis">$</span>) the
    <span class="docEmphasis">G</span> command tells <span class="docEmphasis">
    sed</span> to get the line from the holding buffer and put it back in the
    pattern space buffer, appending it to the line that is currently stored
    there, in this case, the last line. Simply stated: Any line containing the
    pattern <span class="docEmphasis">northeast</span> will be copied and
    appended to the end of the file. (See <a class="docLink" href="#ch04fig01">
    Figure 4.1</a>.)</p>
    <center>
    <h5 id="ch04fig01" class="docFigureTitle">Figure 4.1. The pattern space and holding buffer.
    See <a class="docLink" href="#ch04list31">Example 4.31</a>.</h5>
    <p class="docText">
    <img height="439" alt="graphics/04fig01.gif" src="04fig01.gif" width="500" border="0"></p>
    </center></td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5    9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h5 id="ch04list29" class="docExampleTitle">Example 4.29 </h5>
<p class="docText">
<img height="155" alt="graphics/04prfig06.gif" src="04prfig06.gif" width="500" border="0"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the pattern <span class="docEmphasis">WE</span> is
    found on a line, the <span class="docEmphasis">h</span> command causes the
    line to be copied from the pattern space into a holding buffer. When stored
    in the holding buffer, the line can be retrieved (<span class="docEmphasis">G</span>
    or <span class="docEmphasis">g</span> command) at a later time. In this
    example, when the pattern <span class="docEmphasis">WE</span> is found, the
    line in which it was found is stored in the pattern buffer first. The
    <span class="docEmphasis">h</span> command then puts a copy of the line in
    the holding buffer. The <span class="docEmphasis">d</span> command deletes
    the copy in the pattern buffer. The second command searches for
    <span class="docEmphasis">CT</span> in a line, and when it is found,
    <span class="docEmphasis">sed</span> gets (<span class="docEmphasis">G</span>)
    the line that was stored in the holding buffer and appends it to the line
    currently in the pattern space. Simply stated: The line containing
    <span class="docEmphasis">WE</span> is moved and appended after the line
    containing <span class="docEmphasis">CT.</span> (See &quot;<a class="docLink" href="#ch04lev2sec15">Holding
    and Exchanging: The h and x Commands</a>&quot;.)</td>
  </tr>
</table>
<h5 id="ch04list30" class="docExampleTitle">Example 4.30 </h5>
<p class="docText">
<img alt="graphics/04prfig07.gif" src="04prfig07.gif" border="0" width="500" height="155"></p>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">As <span class="docEmphasis">sed</span> processes the
    file, each line is stored in a temporary buffer called the pattern space.
    Unless the line is deleted or suppressed from printing, the line will be
    printed to the screen after it is processed. The pattern space is then
    cleared and the next line of input is stored there for processing. In this
    example, after the line containing the pattern <span class="docEmphasis">
    northeast</span> is found, it is placed in the pattern space. The
    <span class="docEmphasis">h</span> command takes a copy of it and places it
    in another special buffer called the holding buffer. In the second
    <span class="docEmphasis">sed</span> instruction, when the last line is
    reached (<span class="docEmphasis">$</span>), the <span class="docEmphasis">
    g</span> command tells <span class="docEmphasis">sed</span> to get the line
    from the holding buffer and put it back in the pattern space buffer,
    replacing the line that is currently stored there, in this case, the last
    line. Simply stated: The line containing the pattern
    <span class="docEmphasis">northeast</span> is copied and moved to overwrite
    the last line in the file.</td>
  </tr>
</table>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5   9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h5 id="ch04list31" class="docExampleTitle">Example 4.31 </h5>
<pre><span class="docEmphStrong">sed -e '/WE/{h; d; }' -e '/CT/{g; }' datafile</span>
<span class="docEmphasis">northwest     NW      Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">southwest     SW      Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO      Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE      Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA      TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE      AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">north         NO      Margot Weber       4.5  .89   5   9</span>
<span class="docEmphasis">western       WE      Sharon Gray        5.3  .97   5   23</span>
</pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">If the pattern <span class="docEmphasis">WE</span> is
    found, the <span class="docEmphasis">h</span> command copies the line into
    the holding buffer; the <span class="docEmphasis">d</span> command deletes
    the line in the pattern space. When the pattern <span class="docEmphasis">CT</span>
    is found, the <span class="docEmphasis">g</span> command gets the copy in
    the holding buffer and overwrites the line currently in the pattern space.
    Simply stated: Any line containing the pattern <span class="docEmphasis">WE</span>
    will be moved to overwrite lines containing <span class="docEmphasis">CT.</span>
    (See <a class="docLink" href="#ch04fig01">Figure 4.1</a>.)</td>
  </tr>
</table>
<h4 class="docSection2Title" id="ch04lev2sec15">4.6.14 Holding and Exchanging: The
<span class="docEmphasis">h</span> and <span class="docEmphasis">x</span>
Commands</h4>
<h5 id="ch04list32" class="docExampleTitle">Example 4.32 </h5>
<pre><span class="docEmphStrong">sed -e '/Patricia/h'  -e '/Margot/x' datafile</span>
<span class="docEmphasis">northwest     NW      Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE      Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW      Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southern      SO      Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE      Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA      TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE      AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">southeast     SE      Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">central       CT      Ann Stephens       5.7  .94   5   13</span></pre>
<table cellSpacing="0" width="90%" border="1" align="center">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <p class="docText">The <span class="docEmphasis">x</span> command exchanges
    (swaps) the contents of the holding buffer with the current pattern space.
    When the line containing the pattern <span class="docEmphasis">Patricia</span>
    is found, it will be stored in the holding buffer. When the line containing
    <span class="docEmphasis">Margot</span> is found, the pattern space will be
    exchanged for the line in the holding buffer. Simply stated: The line
    containing <span class="docEmphasis">Margot</span> will be replaced with the
    line containing <span class="docEmphasis">Patricia.</span></td>
  </tr>
</table>
<h3 class="docSection1Title" id="ch04lev1sec7">4.7 <span class="docEmphasis">sed</span> Scripting</h3>
<p class="docText">A <span class="docEmphasis">sed script</span> is a list of
<span class="docEmphasis">sed</span> commands in a file. To let
<span class="docEmphasis">sed</span> know your commands are in a file, when
invoking <span class="docEmphasis">sed</span> at the command line, use the
<span class="docEmphasis">-f</span> option followed by the name of the
<span class="docEmphasis">sed</span> script. <span class="docEmphasis">Sed</span>
is very particular about the way you type lines into the script. There cannot be
any trailing whitespace or text at the end of the command. If commands are not
placed on a line by themselves, they must be terminated with a semicolon. A line
from the input file is copied into the pattern buffer, and all commands in the
<span class="docEmphasis">sed</span> script are executed on that line. After the
line has been processed, the next line from the input file is placed in the
pattern buffer, and all commands in the script are executed on that line.
<span class="docEmphasis">Sed</span> gets &quot;garbled&quot; if your syntax is incorrect.</p>
<p class="docText">The nice thing about <span class="docEmphasis">sed</span>
scripts is that you don't have to worry about the shell's interaction as you do
when at the command line. Quotes are not needed to protect
<span class="docEmphasis">sed</span> commands from interpretation by the shell.
In fact, you cannot use quotes in a <span class="docEmphasis">sed</span> script
at all, unless they are part of a search pattern.</p>
<pre>% <span class="docEmphStrong">cat datafile</span>
<span class="docEmphasis">northwest          NW   Charles Main       3.0   .98   3   34</span>
<span class="docEmphasis">western            WE   Sharon Gray        5.3   .97   5   23</span>
<span class="docEmphasis">southwest          SW   Lewis Dalsass      2.7   .8    2   18</span>
<span class="docEmphasis">southern           SO   Suan Chin          5.1   .95   4   15</span>
<span class="docEmphasis">southeast          SE   Patricia Hemenway  4.0   .7    4   17</span>
<span class="docEmphasis">eastern            EA   TB Savage          4.4   .84   5   20</span>
<span class="docEmphasis">northeast          NE   AM Main Jr.        5.1   .94   3   13</span>
<span class="docEmphasis">north              NO   Margot Weber       4.5   .89   5    9</span>
<span class="docEmphasis">central            CT   Ann Stephens       5.7   .94   5   13</span>
</pre>
<h4 class="docSection2Title" id="ch04lev2sec16">4.7.1 <span class="docEmphasis">sed</span> Script
Examples</h4>
<h5 id="ch04list33" class="docExampleTitle">Example 4.33 </h5>
<pre>% <span class="docEmphStrong">cat sedding1</span> <span class="docEmphasis">(Look at the contents of the sed script.)</span>
1  <span class="docEmphasis"># My first sed script by Jack Sprat</span>
2  /Lewis/a\
3     Lewis is the TOP Salesperson for April!!\
      Lewis is moving to the southern district next month.\
4     CONGRATULATIONS!
5  /Margot/c\
      *******************\
      MARGOT HAS RETIRED\
      ********************
6  1i\
   EMPLOYEE DATABASE\
   ---------------------
7  $d

% <span class="docEmphStrong">sed -f sedding1 datafile</span>   <span class="docEmphasis">(Execute the sed script commands; the</span>
                               <span class="docEmphasis">input file is datafile.)</span>
<span class="docEmphasis">EMPLOYEE DATABASE</span>
<span class="docEmphasis">---------------------</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">Lewis is the TOP Salesperson for April!!</span>
<span class="docEmphasis">Lewis is moving to the southern district next month</span>
<span class="docEmphasis">CONGRATULATIONS!</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     TB Savage          4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">********************</span>
<span class="docEmphasis">MARGOT HAS RETIRED</span>
<span class="docEmphasis">*****************</span></pre>
<div align="center">
  <center>
  <table cellSpacing="0" width="90%" border="1" style="border-collapse: collapse" bordercolor="#111111" cellpadding="5">
    <tr>
      <td>
      <h2 class="docSidebarTitle">EXPLANATION</h2>
      <span style="FONT-WEIGHT: bold">
      <ol class="docList" type="1">
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">This line is a comment. Comments must be on lines by
        themselves and start with a pound sign (<span class="docEmphasis">#</span>).</span></li>
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">If a line contains the pattern
        <span class="docEmphasis">Lewis,</span> the next three lines are
        appended to that line.</span></li>
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">Each line being appended, except the last one, is
        terminated with a backslash. The backslash must be followed immediately
        with a newline. If there is any trailing text, even one space after the
        newline, <span class="docEmphasis">sed</span> will complain.</span></li>
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">The last line to be appended does not have the
        terminating backslash. This indicates to <span class="docEmphasis">sed</span>
        that this is the last line to be appended and that the next line is
        another command.</span></li>
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">Any lines containing the pattern
        <span class="docEmphasis">Margot</span> will be replaced (<span class="docEmphasis">c</span>
        command) with the next three lines of text.</span></li>
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">The next two lines will be inserted (<span class="docEmphasis">i</span>
        command) above line <span class="docEmphasis">1.</span></span></li>
        <li><span style="FONT-WEIGHT: normal">
        <p class="docList">The last line (<span class="docEmphasis">$</span>)
        will be deleted.</span></li>
      </ol>
      </span></td>
    </tr>
  </table>
  </center>
</div>
<h5 id="ch04list34" class="docExampleTitle">Example 4.34 </h5>
<pre>%  <span class="docEmphStrong">cat sedding2</span> <span class="docEmphasis">(Look at the contents of the sed script.)</span>
<span class="docEmphasis"># This script demonstrates the use of curly braces to nest addresses</span>
<span class="docEmphasis"># and commands. Comments are preceded by a pound sign(#) and must</span>
<span class="docEmphasis"># be on a line by themselves. Commands are terminated with a newline</span>
<span class="docEmphasis"># or semicolon.  If there is any text after a command, even one</span>
<span class="docEmphasis"># space, you receive an error message:</span>
<span class="docEmphasis">#</span>      <span class="docEmphBoldItalic">sed: Extra text at end of command:</span>

1  /western/, /southeast/{
      /^ *$/d
      /Suan/{ h; d; }
   }
2   /Ann/g
3   s/TB \(Savage\)/Thomas \1/

% <span class="docEmphStrong">sed -f sedding2 datafile</span>
<span class="docEmphasis">northwest     NW     Charles Main       3.0  .98   3   34</span>
<span class="docEmphasis">western       WE     Sharon Gray        5.3  .97   5   23</span>
<span class="docEmphasis">southwest     SW     Lewis Dalsass      2.7  .8    2   18</span>
<span class="docEmphasis">southeast     SE     Patricia Hemenway  4.0  .7    4   17</span>
<span class="docEmphasis">eastern       EA     Thomas Savage      4.4  .84   5   20</span>
<span class="docEmphasis">northeast     NE     AM Main Jr.        5.1  .94   3   13</span>
<span class="docEmphasis">north         NO     Margot Weber       4.5  .89   5    9</span>
<span class="docEmphasis">southern      SO     Suan Chin          5.1  .95   4   15</span></pre>
<div align="center">
  <center>
<table cellSpacing="0" width="90%" border="1" style="border-collapse: collapse" bordercolor="#111111" cellpadding="5">
  <tr>
    <td>
    <h2 class="docSidebarTitle">EXPLANATION</h2>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="1">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">In the range of lines starting at
      <span class="docEmphasis">western</span> and ending at
      <span class="docEmphasis">southeast,</span> blank lines are deleted, and
      lines matching <span class="docEmphasis">Suan</span> are copied from the
      pattern buffer into the holding buffer, then deleted from the pattern
      buffer.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">When the pattern <span class="docEmphasis">Ann</span>
      is matched, the <span class="docEmphasis">g</span> command copies the line
      in the holding buffer to the pattern buffer, overwriting what is in the
      pattern buffer.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">All lines containing the pattern
      <span class="docEmphasis">TB Savage</span> are replaced with
      <span class="docEmphasis">Thomas</span> and the pattern that was tagged,
      <span class="docEmphasis">Savage.</span> In the search string,
      <span class="docEmphasis">Savage</span> is enclosed in escaped
      parentheses, tagging the enclosed string so that it can be used again. It
      is tag number 1, referenced by \<span class="docEmphasis">1.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
  </center>
</div>
<h4 class="docSection2Title" id="ch04lev2sec17">4.7.2 Review</h4>
<p class="docText"><a class="docLink" href="#ch04table04">Table 4.4</a> lists
<span class="docEmphasis">sed</span> commands and what they do.</p>
<table cellSpacing="0" cellPadding="1" width="100%" border="1">
  <caption>
  <h5 id="ch04table04" class="docTableTitle">Table 4.4. <span class="docEmphasis">sed</span>
  Review</h5>
  </caption>
  <colgroup span="2" align="left">
  </colgroup>
  <tr>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">
    Command</span> </th>
    <th class="docTableHeader" vAlign="top"><span class="docEmphBoldItalic">What
    It Does</span> </th>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed -n
    '/sentimental/p' filex</span> </td>
    <td class="docTableCell" vAlign="top">Prints to the screen all lines
    containing <span class="docEmphasis">sentimental.</span> The file
    <span class="docEmphasis">filex</span> does not change. Without the
    <span class="docEmphasis">-n</span> option, all lines with
    <span class="docEmphasis">sentimental</span> will be printed twice. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed '1,3d'
    filex &gt; newfilex</span> </td>
    <td class="docTableCell" vAlign="top">Deletes lines 1, 2, and 3 from
    <span class="docEmphasis">filex</span> and saves changes in
    <span class="docEmphasis">newfilex.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed '/[Dd]aniel/d'
    filex</span> </td>
    <td class="docTableCell" vAlign="top">Deletes lines containing
    <span class="docEmphasis">Daniel</span> or <span class="docEmphasis">daniel.</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed -n
    '15,20p' filex</span> </td>
    <td class="docTableCell" vAlign="top">Prints only lines
    <span class="docEmphasis">15</span> through <span class="docEmphasis">20.</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed
    '1,10s/Montana/MT/g' filex</span> </td>
    <td class="docTableCell" vAlign="top">Substitutes <span class="docEmphasis">
    Montana</span> with <span class="docEmphasis">MT</span> globally in lines
    <span class="docEmphasis">1</span> through <span class="docEmphasis">10.</span>
    </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top">
    <pre><span class="docEmphasis">sed '/March/\!d' filex    (csh)
sed '/March/!d' filex      (sh)</span>
</pre>
    </td>
    <td class="docTableCell" vAlign="top">Deletes all lines not containing
    <span class="docEmphasis">March.</span> (The backslash is used only in the
    csh to escape the history character.) </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed
    '/report/s/5/8/' filex</span> </td>
    <td class="docTableCell" vAlign="top">Changes the first occurrence of
    <span class="docEmphasis">5</span> to <span class="docEmphasis">8</span> on
    all lines containing <span class="docEmphasis">report.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed 's/….//'
    filex</span> </td>
    <td class="docTableCell" vAlign="top">Deletes the first four characters of
    each line. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed 's/…$//'
    filex</span> </td>
    <td class="docTableCell" vAlign="top">Deletes the last three characters of
    each line. </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed
    '/east/,/west/s/North/South/' filex</span> </td>
    <td class="docTableCell" vAlign="top">For any lines falling in the range
    from <span class="docEmphasis">east</span> to <span class="docEmphasis">
    west,</span> substitutes <span class="docEmphasis">North</span> with
    <span class="docEmphasis">South.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed -n
    '/Time off/w timefile' filex</span> </td>
    <td class="docTableCell" vAlign="top">Writes all lines containing
    <span class="docEmphasis">Time off</span> to the file
    <span class="docEmphasis">timefile.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed 's/\([Oo]ccur\)ence/\1rence/'
    file</span> </td>
    <td class="docTableCell" vAlign="top">Substitutes either
    <span class="docEmphasis">Occurence</span> or <span class="docEmphasis">
    occurence</span> with <span class="docEmphasis">Occurrence</span> or
    <span class="docEmphasis">occurrence.</span> </td>
  </tr>
  <tr>
    <td class="docTableCell" vAlign="top"><span class="docEmphasis">sed -n 'l'
    filex</span> </td>
    <td class="docTableCell" vAlign="top">Prints all lines showing nonprinting
    characters as \nn, where nn is the octal value of the character, and showing
    tabs as &gt;. </td>
  </tr>
</table>

<h3 class="docSection1Title" id="ch04lev1sec8">UNIX TOOLS LAB EXERCISE</h3>
<h4 class="docSection2Title" id="ch04lev2sec18">Lab 2: <span class="docEmphasis">sed</span>
Exercise</h4>
<p class="docText">Steve Blenheim:238-923-7366:95 Latham Lane, Easton, PA
83755:11/12/56:20300</p>
<p class="docText">Betty Boop:245-836-8357:635 Cutesy Lane, Hollywood, CA
91464:6/23/23:14500</p>
<p class="docText">Igor Chevsky:385-375-8395:3567 Populus Place, Caldwell, NJ
23875:6/18/68:23400</p>
<p class="docText">Norma Corder:397-857-2735:74 Pine Street, Dearborn, MI
23874:3/28/45:245700</p>
<p class="docText">Jennifer Cowan:548-834-2348:583 Laurel Ave., Kingsville, TX
83745:10/1/35:58900</p>
<p class="docText">Jon DeLoach:408-253-3122:123 Park St., San Jose, CA
04086:7/25/53:85100</p>
<p class="docText">Karen Evich:284-758-2857:23 Edgecliff Place, Lincoln, NB
92743:7/25/53:85100</p>
<p class="docText">Karen Evich:284-758-2867:23 Edgecliff Place, Lincoln, NB
92743:11/3/35:58200</p>
<p class="docText">Karen Evich:284-758-2867:23 Edgecliff Place, Lincoln, NB
92743:11/3/35:58200</p>
<p class="docText">Fred Fardbarkle:674-843-1385:20 Parak Lane, DeLuth, MN
23850:4/12/23:780900</p>
<p class="docText">Fred Fardbarkle:674-843-1385:20 Parak Lane, DeLuth, MN
23850:4/12/23:780900</p>
<p class="docText">Lori Gortz:327-832-5728:3465 Mirlo Street, Peabody, MA
34756:10/2/65:35200</p>
<p class="docText">Paco Gutierrez:835-365-1284:454 Easy Street, Decatur, IL
75732:2/28/53:123500</p>
<p class="docText">Ephram Hardy:293-259-5395:235 CarltonLane, Joliet, IL
73858:8/12/20:56700</p>
<p class="docText">James Ikeda:834-938-8376:23445 Aster Ave., Allentown, NJ
83745:12/1/38:45000</p>
<p class="docText">Barbara Kertz:385-573-8326:832 Ponce Drive, Gary, IN
83756:12/1/46:268500</p>
<p class="docText">Lesley Kirstin:408-456-1234:4 Harvard Square, Boston, MA
02133:4/22/62:52600</p>
<p class="docText">William Kopf:846-836-2837:6937 Ware Road, Milton, PA
93756:9/21/46:43500</p>
<p class="docText">Sir Lancelot:837-835-8257:474 Camelot Boulevard, Bath, WY
28356:5/13/69:24500</p>
<p class="docText">Jesse Neal:408-233-8971:45 Rose Terrace, San Francisco, CA
92303:2/3/36:25000</p>
<p class="docText">Zippy Pinhead:834-823-8319:2356 Bizarro Ave., Farmount, IL
84357:1/1/67:89500</p>
<p class="docText">Arthur Putie:923-835-8745:23 Wimp Lane, Kensington, DL
38758:8/31/69:126000</p>
<p class="docText">Popeye Sailor:156-454-3322:945 Bluto Street, Anywhere, USA
29358:3/19/35:22350</p>
<p class="docText">Jose Santiago:385-898-8357:38 Fife Way, Abilene, TX
39673:1/5/58:95600</p>
<p class="docText">Tommy Savage:408-724-0140:1222 Oxbow Court, Sunnyvale, CA
94087:5/19/66:34200</p>
<p class="docText">Yukio Takeshida:387-827-1095:13 Uno Lane, Ashville, NC
23556:7/1/29:57000</p>
<p class="docText">Vinh Tranh:438-910-7449:8235 Maple Street, Wilmington, VM
29085:9/23/63:68900</p>
<p class="docText">(Refer to the database called <span class="docEmphasis">
datebook</span> on the CD.)</p>
<table cellSpacing="16" cellpadding="5" border="0">
  <tr vAlign="top">
    <td class="docText" align="right"><b>1:</b></td>
    <td>
    <p class="docText">Change <span class="docEmphasis">Jon</span>'s name to
    <span class="docEmphasis">Jonathan.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>2:</b></td>
    <td>
    <p class="docText">Delete the first three lines.</td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>3:</b></td>
    <td>
    <p class="docText">Print lines <span class="docEmphasis">5</span> through
    <span class="docEmphasis">10.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>4:</b></td>
    <td>
    <p class="docText">Delete lines containing <span class="docEmphasis">Lane.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>5:</b></td>
    <td>
    <p class="docText">Print all lines where the birthdays are in
    <span class="docEmphasis">November</span> or <span class="docEmphasis">
    December.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>6:</b></td>
    <td>
    <p class="docText">Append three stars to the end of lines starting with
    <span class="docEmphasis">Fred.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>7:</b></td>
    <td>
    <p class="docText">Replace the line containing <span class="docEmphasis">
    Jose</span> with <span class="docEmphasis">JOSE HAS RETIRED.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>8:</b></td>
    <td>
    <p class="docText">Change <span class="docEmphasis">Popeye's</span> birthday
    to <span class="docEmphasis">11/14/46.</span></td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>9:</b></td>
    <td>
    <p class="docText">Delete all blank lines.</td>
  </tr>
  <tr vAlign="top">
    <td class="docText" align="right"><b>10:</b></td>
    <td>
    <p class="docText">Write a <span class="docEmphasis">sed</span> script that
    will:</p>
    <span style="FONT-WEIGHT: bold">
    <ol class="docList" type="a">
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Insert above the first line the title
      <span class="docEmphasis">PERSONNEL FILE.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Remove the salaries ending in <span class="docEmphasis">
      500.</span></span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Print the contents of the file with the last names and
      first names reversed.</span></li>
      <li><span style="FONT-WEIGHT: normal">
      <p class="docList">Append at the end of the file <span class="docEmphasis">
      THE END.</span></span></li>
    </ol>
    </span></td>
  </tr>
</table>
<blockquote>
<p class="docFootnote" id="EN4-1"><a class="docLink" href="#ENB4-1">[1]</a>&nbsp;&nbsp;Remember, the
  shell will try to evaluate any metacharacters or whitespace when a command is
  typed at the command line; any characters in the <span class="docEmphasis">sed</span>
  command that could be interpreted by the shell must be quoted.</p><p class="docFootnote" id="EN4-2"><a class="docLink" href="#ENB4-2">[2]</a>&nbsp;&nbsp;For a complete
  list of diagnostics, see the UNIX man page for <span class="docEmphasis">sed.</span></p><p class="docFootnote" id="EN4-3"><a class="docLink" href="#ENB4-3">[3]</a>&nbsp;&nbsp;To represent a
  literal ampersand in the replacement string, it must be escaped: \&amp;.</p><p class="docFootnote" id="EN4-4"><a class="docLink" href="#ENB4-4">[4]</a>&nbsp;&nbsp;The Bourne and
  Korn shells do not require the second backslash to escape the newline because
  they do not require quotes to be matched on the same line, only that they
  match.</p></blockquote>
<table width="100%" border="1" bgcolor="#EBEBFF"><tr><td width="5%" align="left" valign="middle"><a href="_chapter 3.htm"><img src="Larrow.gif" width="17" height="19" border="0"></a></td><td align="center" valign="middle"><a class="docLink" href="Front matter.htm">CONTENTS</a></td><td width="5%" align="right" valign="middle"><a href="_chapter 5.htm"><img src="Rarrow.gif" width="17" height="19" border="0"></a></td></tr></table></body>

</html>